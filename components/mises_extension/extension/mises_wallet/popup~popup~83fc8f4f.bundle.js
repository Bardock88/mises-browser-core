(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1020:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(520),t),s(r(1021),t)},1021:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(333),s=r(521),n=r(1022);t.init=function(e,t){e.registerMessage(i.SetPersistentMemoryMsg),e.registerMessage(i.GetPersistentMemoryMsg),e.addHandler(s.ROUTE,n.getHandler(t))}},1022:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const i=r(333);t.getHandler=r=>(e,t)=>{switch(t.constructor){case i.SetPersistentMemoryMsg:return s(r)(e,t);case i.GetPersistentMemoryMsg:return r.get();default:throw new Error("Unknown msg type")}};const s=r=>(e,t)=>(r.set(t.data),{success:!0})},1023:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(522),t),s(r(1024),t)},1024:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(229),s=r(524),n=r(1025);t.init=function(e,t){e.registerMessage(i.GetChainInfosMsg),e.registerMessage(i.SuggestChainInfoMsg),e.registerMessage(i.RemoveSuggestedChainInfoMsg),e.addHandler(s.ROUTE,n.getHandler(t))}},1025:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const i=r(3),n=r(229);t.getHandler=r=>(e,t)=>{switch(t.constructor){case n.GetChainInfosMsg:return a(r)(e,t);case n.SuggestChainInfoMsg:return o(r)(e,t);case n.RemoveSuggestedChainInfoMsg:return c(r)(e,t);default:throw new i.KeplrError("chains",110,"Unknown msg type")}};const a=e=>()=>s(void 0,void 0,void 0,function*(){return{chainInfos:yield e.getChainInfos()}}),o=i=>(t,r)=>s(void 0,void 0,void 0,function*(){var e;(yield i.hasChainInfo(r.chainInfo.chainId))||((e=r.chainInfo).beta=!0,yield i.suggestChainInfo(t,e,r.origin))}),c=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.removeChainInfo(t.chainId),yield r.getChainInfos()})},1026:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(529),t),s(r(1042),t)},1027:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t},p=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Crypto=void 0;const f=n(r(196)),g=r(50),m=a(r(379)),y=r(4),v=r(3);t.Crypto=class{static encrypt(a,o,c,l,u,d,h){return p(this,void 0,void 0,function*(){var e=new Uint8Array(32);const t=y.Buffer.from(yield a.rng(e)).toString("hex"),r={salt:t,dklen:32,n:32768,r:8,p:1};var i=yield p(this,void 0,void 0,function*(){switch(o){case"scrypt":return yield a.scrypt(u,r);case"sha256":return g.Hash.sha256(y.Buffer.from(t+"/"+u));case"pbkdf2":return new Promise((r,i)=>{m.default.pbkdf2(u,t,4e3,32,"sha256",(e,t)=>{e?i(e):r(new Uint8Array(t))})});default:throw new v.KeplrError("keyring",220,"Unknown kdf")}}),s=y.Buffer.from(l),e=new Uint8Array(16),e=y.Buffer.from(yield a.rng(e)),n=new f.Counter(0),n=(n.setBytes(e),new f.default.ModeOfOperation.ctr(i,n)),n=y.Buffer.from(n.encrypt(s)),s=g.Hash.sha256(y.Buffer.concat([y.Buffer.from(i.slice(i.length/2)),n]));return{version:"1.2",type:c,coinTypeForChain:{},bip44HDPath:h,meta:d,crypto:{cipher:"aes-128-ctr",cipherparams:{iv:e.toString("hex")},ciphertext:n.toString("hex"),kdf:o,kdfparams:r,mac:y.Buffer.from(s).toString("hex")}}})}static decrypt(r,s,n){return p(this,void 0,void 0,function*(){var e=yield p(this,void 0,void 0,function*(){switch(s.crypto.kdf){case"scrypt":return yield r.scrypt(n,s.crypto.kdfparams);case"sha256":return g.Hash.sha256(y.Buffer.from(s.crypto.kdfparams.salt+"/"+n));case"pbkdf2":return new Promise((r,i)=>{m.default.pbkdf2(n,s.crypto.kdfparams.salt,4e3,32,"sha256",(e,t)=>{e?i(e):r(new Uint8Array(t))})});default:throw new v.KeplrError("keyring",220,"Unknown kdf")}}),t=new f.Counter(0),t=(t.setBytes(y.Buffer.from(s.crypto.cipherparams.iv,"hex")),new f.default.ModeOfOperation.ctr(e,t)),e=g.Hash.sha256(y.Buffer.concat([y.Buffer.from(e.slice(e.length/2)),y.Buffer.from(s.crypto.ciphertext,"hex")]));if(y.Buffer.from(e).equals(y.Buffer.from(s.crypto.mac,"hex")))return y.Buffer.from(t.decrypt(y.Buffer.from(s.crypto.ciphertext,"hex")));throw new v.KeplrError("keyring",222,"Unmatched mac")})}}},1028:function(t,e,r){!function(u){var d,e,h=r(22).Buffer,p=r(530),f=r(531),g=r(532),m=r(533),y=u.crypto&&u.crypto.subtle,v={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},b=[];function w(){return e=e||(u.process&&u.process.nextTick?u.process.nextTick:u.queueMicrotask||u.setImmediate||u.setTimeout)}function _(e,t,r,i,s){return y.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]).then(function(e){return y.deriveBits({name:"PBKDF2",salt:t,iterations:r,hash:{name:s}},e,i<<3)}).then(function(e){return h.from(e)})}t.exports=function(t,r,i,s,n,a){"function"==typeof n&&(a=n,n=void 0);var o,e,c,l=v[(n=n||"sha1").toLowerCase()];if(l&&"function"==typeof u.Promise){if(p(i,s),t=m(t,f,"Password"),r=m(r,f,"Salt"),"function"!=typeof a)throw new Error("No callback provided to pbkdf2");e=l,e=((!u.process||u.process.browser)&&y&&y.importKey&&y.deriveBits?void 0!==b[e]?b[e]:(c=_(d=d||h.alloc(8),d,10,128,e).then(function(){return!0}).catch(function(){return!1}),b[e]=c):Promise.resolve(!1)).then(function(e){return e?_(t,r,i,s,l):g(t,r,i,s,n)}),o=a,e.then(function(e){w()(function(){o(null,e)})},function(e){w()(function(){o(e)})})}else w()(function(){var e;try{e=g(t,r,i,s,n)}catch(e){return a(e)}a(null,e)})}}.call(this,r(11))},1040:function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.Migrator=void 0;t.Migrator=class{migrateData(){return n(this,void 0,void 0,function*(){var e=(yield browser.storage.local.get())["migrated"];return e&&e.data&&e.data.KeyringController||{vault:""}})}enCodeValut(r,i){return n(this,void 0,void 0,function*(){var e=s(630),t=r["vault"];return(yield e.decrypt(i,t)).filter(e=>["HD Key Tree","Simple Key Pair"].includes(e.type))})}clearCache(){return browser.storage.local.set({migrated:"done"})}}},1041:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.trimAminoSignDoc=void 0,i(r(41)));const s=i.default.object({chain_id:i.default.string().allow(""),account_number:i.default.string().allow(""),sequence:i.default.string().allow(""),fee:i.default.object({amount:i.default.array().items(i.default.object({denom:i.default.string().allow(""),amount:i.default.string().allow("")})),gas:i.default.string().allow(""),payer:i.default.string().allow(""),granter:i.default.string().allow(""),feePayer:i.default.string().allow("")}),msgs:i.default.array().items(i.default.any()),memo:i.default.string().allow(""),timeout_height:i.default.string().allow("")});t.trimAminoSignDoc=function(e){if((e=s.validate(e,{stripUnknown:!0})).error)throw e.error;return e.value}},1042:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(336),s=r(535),n=r(1043);t.init=function(e,t){e.registerMessage(i.RestoreKeyRingMsg),e.registerMessage(i.DeleteKeyRingMsg),e.registerMessage(i.UpdateNameKeyRingMsg),e.registerMessage(i.ShowKeyRingMsg),e.registerMessage(i.CreateMnemonicKeyMsg),e.registerMessage(i.AddMnemonicKeyMsg),e.registerMessage(i.CreatePrivateKeyMsg),e.registerMessage(i.AddPrivateKeyMsg),e.registerMessage(i.LockKeyRingMsg),e.registerMessage(i.UnlockKeyRingMsg),e.registerMessage(i.IsUnlockMsg),e.registerMessage(i.GetKeyMsg),e.registerMessage(i.RequestSignAminoMsg),e.registerMessage(i.RequestVerifyADR36AminoSignDoc),e.registerMessage(i.RequestSignDirectMsg),e.registerMessage(i.GetMultiKeyStoreInfoMsg),e.registerMessage(i.ChangeKeyRingMsg),e.registerMessage(i.GetIsKeyStoreCoinTypeSetMsg),e.registerMessage(i.SetKeyStoreCoinTypeMsg),e.registerMessage(i.CheckPasswordMsg),e.registerMessage(i.ExportKeyRingDatasMsg),e.registerMessage(i.RequestSignEIP712CosmosTxMsg_v0),e.registerMessage(i.AddAccountMsg),e.registerMessage(i.MigratorKeyRingMsg),e.registerMessage(i.RestoreKeyStoreMsg),e.addHandler(s.ROUTE,n.getHandler(t))}},1043:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const i=r(3),n=r(336),a=r(16),o=r(100),c=r(230);t.getHandler=r=>(e,t)=>{switch(t.constructor){case n.RestoreKeyRingMsg:return l(r)(e,t);case n.DeleteKeyRingMsg:return u(r)(e,t);case n.UpdateNameKeyRingMsg:return d(r)(e,t);case n.ShowKeyRingMsg:return h(r)(e,t);case n.CreateMnemonicKeyMsg:return p(r)(e,t);case n.AddMnemonicKeyMsg:return f(r)(e,t);case n.CreatePrivateKeyMsg:return g(r)(e,t);case n.AddPrivateKeyMsg:return m(r)(e,t);case n.LockKeyRingMsg:return y(r)(e,t);case n.UnlockKeyRingMsg:return v(r)(e,t);case n.IsUnlockMsg:return b(r)(e,t);case n.GetKeyMsg:return w(r)(e,t);case n.RequestSignAminoMsg:return _(r)(e,t);case n.RequestSignEIP712CosmosTxMsg_v0:return S(r)(e,t);case n.RequestVerifyADR36AminoSignDoc:return k(r)(e,t);case n.RequestSignDirectMsg:return M(r)(e,t);case n.GetMultiKeyStoreInfoMsg:return O(r)(e,t);case n.ChangeKeyRingMsg:return x(r)(e,t);case n.GetIsKeyStoreCoinTypeSetMsg:return E(r)(e,t);case n.SetKeyStoreCoinTypeMsg:return R(r)(e,t);case n.CheckPasswordMsg:return I(r)(e,t);case n.ExportKeyRingDatasMsg:return C(r)(e,t);case n.AddAccountMsg:return A(r)(e,t);case n.MigratorKeyRingMsg:return T(r)(e,t);case n.RestoreKeyStoreMsg:return P(r)(e,t);default:throw new i.KeplrError("keyring",221,"Unknown msg type")}};const l=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.restore()}),u=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.deleteKeyRing(t.index,t.password)}),d=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.updateNameKeyRing(t.index,t.name)}),h=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.showKeyRing(t.index,t.password)}),p=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.createMnemonicKey(t.kdf,t.mnemonic,t.password,t.meta,t.bip44HDPath)}),f=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.addMnemonicKey(t.kdf,t.mnemonic,t.meta,t.bip44HDPath)}),g=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.createPrivateKey(t.kdf,t.privateKey,t.password,t.meta)}),m=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.addPrivateKey(t.kdf,t.privateKey,t.meta)}),y=e=>()=>({status:e.lock()}),v=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return{status:yield r.unlock(t.password)}}),b=e=>()=>s(void 0,void 0,void 0,function*(){return e.keyRingStatus===c.KeyRingStatus.UNLOCKED}),w=i=>(t,r)=>s(void 0,void 0,void 0,function*(){yield i.permissionService.checkOrGrantBasicAccessPermission(t,r.chainId,r.origin);var e=yield i.getKey(r.chainId);return{name:i.getKeyStoreMeta("name"),algo:"secp256k1",pubKey:e.pubKey,address:e.address,bech32Address:new a.Bech32Address(e.address).toBech32((yield i.chainsService.getChainInfo(r.chainId)).bech32Config.bech32PrefixAccAddr),isNanoLedger:!1}}),_=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.permissionService.checkOrGrantBasicAccessPermission(e,t.chainId,t.origin),yield r.requestSignAmino(e,t.origin,t.chainId,t.signer,t.signDoc,t.signOptions)}),S=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.permissionService.checkOrGrantBasicAccessPermission(e,t.chainId,t.origin),yield r.requestSignEIP712CosmosTx_v0(e,t.origin,t.chainId,t.signer,t.eip712,t.signDoc,t.signOptions)}),k=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.permissionService.checkOrGrantBasicAccessPermission(e,t.chainId,t.origin),yield r.verifyADR36AminoSignDoc(t.chainId,t.signer,t.data,t.signature)}),M=i=>(t,r)=>s(void 0,void 0,void 0,function*(){yield i.permissionService.checkOrGrantBasicAccessPermission(t,r.chainId,r.origin);var e=o.SignDoc.fromPartial({bodyBytes:r.signDoc.bodyBytes,authInfoBytes:r.signDoc.authInfoBytes,chainId:r.signDoc.chainId,accountNumber:r.signDoc.accountNumber}),e=yield i.requestSignDirect(t,r.origin,r.chainId,r.signer,e,r.signOptions);return{signed:{bodyBytes:e.signed.bodyBytes,authInfoBytes:e.signed.authInfoBytes,chainId:e.signed.chainId,accountNumber:e.signed.accountNumber.toString()},signature:e.signature}}),O=e=>()=>({multiKeyStoreInfo:e.getMultiKeyStoreInfo()}),x=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.changeKeyStoreFromMultiKeyStore(t.index)}),E=r=>(e,t)=>r.getKeyStoreBIP44Selectables(t.chainId,t.paths),R=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.setKeyStoreCoinType(t.chainId,t.coinType),r.keyRingStatus}),I=r=>(e,t)=>r.checkPassword(t.password),C=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.exportKeyRingDatas(t.password)}),A=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.addAccount(t.name,t.bip44HDPath)}),T=r=>(e,t)=>s(void 0,void 0,void 0,function*(){return yield r.migratorKeyRing(t.password)}),P=e=>()=>s(void 0,void 0,void 0,function*(){return yield e.restoreKeyStore()})},1044:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(536),t),s(r(1045),t)},1045:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(337),s=r(537),n=r(1046);t.init=function(e,t){e.registerMessage(i.SendTxMsg),e.addHandler(s.ROUTE,n.getHandler(t))}},1046:function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const s=r(3),n=r(337);t.getHandler=r=>(e,t)=>{if(t.constructor!==n.SendTxMsg)throw new s.KeplrError("tx",110,"Unknown msg type");return a(r)(e,t)};const a=r=>(e,t)=>i(void 0,void 0,void 0,function*(){return yield r.permissionService.checkOrGrantBasicAccessPermission(e,t.chainId,t.origin),yield r.sendTx(t.chainId,t.tx,t.mode)})},1047:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(538),t),s(r(1048),t)},1048:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(338),s=r(539),n=r(1049);t.init=function(e,t){e.registerMessage(i.TryUpdateChainMsg),e.registerMessage(i.SetChainEndpointsMsg),e.registerMessage(i.ResetChainEndpointsMsg),e.addHandler(s.ROUTE,n.getHandler(t))}},1049:function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const s=r(3),n=r(338);t.getHandler=r=>(e,t)=>{switch(t.constructor){case n.TryUpdateChainMsg:return a(r)(e,t);case n.SetChainEndpointsMsg:return o(r)(e,t);case n.ResetChainEndpointsMsg:return c(r)(e,t);default:throw new s.KeplrError("updater",110,"Unknown msg type")}};const a=r=>(e,t)=>i(void 0,void 0,void 0,function*(){yield r.tryUpdateChain(t.chainId)}),o=r=>(e,t)=>i(void 0,void 0,void 0,function*(){return yield r.setChainEndpoints(t.chainId,t.rpc,t.rest)}),c=r=>(e,t)=>i(void 0,void 0,void 0,function*(){return yield r.resetChainEndpoints(t.chainId)})},1050:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(540),t),s(r(1052),t)},1051:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1052:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(231),s=r(542),n=r(1053);t.init=function(e,t){e.registerMessage(i.GetTokensMsg),e.registerMessage(i.SuggestTokenMsg),e.registerMessage(i.AddTokenMsg),e.registerMessage(i.RemoveTokenMsg),e.registerMessage(i.GetSecret20ViewingKey),e.addHandler(s.ROUTE,n.getHandler(t))}},1053:function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const s=r(3),n=r(231);t.getHandler=r=>(e,t)=>{switch(t.constructor){case n.GetTokensMsg:return a(r)(e,t);case n.SuggestTokenMsg:return o(r)(e,t);case n.AddTokenMsg:return c(r)(e,t);case n.RemoveTokenMsg:return l(r)(e,t);case n.GetSecret20ViewingKey:return u(r)(e,t);default:throw new s.KeplrError("tokens",120,"Unknown msg type")}};const a=r=>(e,t)=>i(void 0,void 0,void 0,function*(){return yield r.getTokens(t.chainId)}),o=r=>(e,t)=>i(void 0,void 0,void 0,function*(){yield r.permissionService.checkOrGrantBasicAccessPermission(e,t.chainId,t.origin),yield r.suggestToken(e,t.chainId,t.contractAddress,t.viewingKey)}),c=r=>(e,t)=>i(void 0,void 0,void 0,function*(){yield r.addToken(t.chainId,t.currency)}),l=r=>(e,t)=>i(void 0,void 0,void 0,function*(){yield r.removeToken(t.chainId,t.currency)}),u=r=>(e,t)=>i(void 0,void 0,void 0,function*(){return yield r.permissionService.checkOrGrantBasicAccessPermission(e,t.chainId,t.origin),yield r.getSecret20ViewingKey(t.chainId,t.contractAddress)})},1054:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(544),t),s(r(1059),t)},1055:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InteractionForegroundService=void 0;t.InteractionForegroundService=class{constructor(e){this.handler=e}pushData(e){this.handler.onInteractionDataReceived(e)}pushEvent(e){this.handler.onEventDataReceived(e)}}},1056:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1057:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.interactionForegroundInit=void 0;const i=r(340),s=r(546),n=r(1058);t.interactionForegroundInit=function(e,t){e.registerMessage(i.PushInteractionDataMsg),e.registerMessage(i.PushEventDataMsg),e.addHandler(s.ROUTE,n.getHandler(t))}},1058:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const i=r(3),s=r(340);t.getHandler=r=>(e,t)=>{switch(t.constructor){case s.PushInteractionDataMsg:return n(r)(e,t);case s.PushEventDataMsg:return a(r)(e,t);default:throw new i.KeplrError("interaction",110,"Unknown msg type")}};const n=r=>(e,t)=>r.pushData(t.data),a=r=>(e,t)=>r.pushEvent(t.data)},1059:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(341),s=r(547),n=r(1060);t.init=function(e,t){e.registerMessage(i.ApproveInteractionMsg),e.registerMessage(i.RejectInteractionMsg),e.addHandler(s.ROUTE,n.getHandler(t))}},1060:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const i=r(3),s=r(341);t.getHandler=r=>(e,t)=>{switch(t.constructor){case s.ApproveInteractionMsg:return n(r)(e,t);case s.RejectInteractionMsg:return a(r)(e,t);default:throw new i.KeplrError("interaction",100,"Unknown msg type")}};const n=r=>(e,t)=>r.approve(t.id,t.result),a=r=>(e,t)=>r.reject(t.id)},1061:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(526),t),s(r(1062),t)},1062:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(334),s=r(528),n=r(1063);t.init=function(e,t){e.registerMessage(i.EnableAccessMsg),e.registerMessage(i.GetPermissionOriginsMsg),e.registerMessage(i.GetOriginPermittedChainsMsg),e.registerMessage(i.AddPermissionOrigin),e.registerMessage(i.RemovePermissionOrigin),e.registerMessage(i.RemovePermissionsOrigin),e.addHandler(s.ROUTE,n.getHandler(t))}},1063:function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const s=r(334),n=r(3);t.getHandler=r=>(e,t)=>{switch(t.constructor){case s.EnableAccessMsg:return a(r)(e,t);case s.GetPermissionOriginsMsg:return o(r)(e,t);case s.GetOriginPermittedChainsMsg:return c(r)(e,t);case s.AddPermissionOrigin:return l(r)(e,t);case s.RemovePermissionOrigin:return u(r)(e,t);case s.RemovePermissionsOrigin:return d(r)(e,t);default:throw new n.KeplrError("permission",120,"Unknown msg type")}};const a=r=>(e,t)=>i(void 0,void 0,void 0,function*(){return yield r.checkOrGrantBasicAccessPermission(e,t.chainIds,t.origin)}),o=r=>(e,t)=>r.getPermissionOrigins(t.chainId,t.permissionType),c=r=>(e,t)=>r.getOriginPermittedChains(t.permissionOrigin,t.permissionType),l=r=>(e,t)=>i(void 0,void 0,void 0,function*(){yield r.addPermission([t.chainId],t.permissionType,[t.permissionOrigin])}),u=r=>(e,t)=>i(void 0,void 0,void 0,function*(){yield r.removePermission(t.chainId,t.permissionType,[t.permissionOrigin])}),d=r=>(e,t)=>i(void 0,void 0,void 0,function*(){yield r.removeAllPermissions(t.chainId)})},1064:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(548),t),s(r(1065),t)},1065:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(342),s=r(549),n=r(1066);t.init=function(e,t){e.registerMessage(i.GetAutoLockAccountDurationMsg),e.registerMessage(i.UpdateAutoLockAccountDurationMsg),e.registerMessage(i.StartAutoLockMonitoringMsg),e.registerMessage(i.LockMsg),e.addHandler(s.ROUTE,n.getHandler(t))}},1066:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const i=r(3),s=r(342);t.getHandler=r=>(e,t)=>{switch(t.constructor){case s.GetAutoLockAccountDurationMsg:return n(r)(e,t);case s.UpdateAutoLockAccountDurationMsg:return a(r)(e,t);case s.StartAutoLockMonitoringMsg:return o(r)(e,t);case s.LockMsg:return c(r)(e,t);default:throw new i.KeplrError("auto-lock-account",100,"Unknown msg type")}};const n=e=>()=>e.getAutoLockDuration(),a=r=>(e,t)=>{if(r.keyRingIsUnlocked)return r.setDuration(t.duration);throw new Error("Keyring is not unlocked")},o=e=>()=>e.startAppStateCheckTimer(),c=e=>()=>e.lock()},1067:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(343),t),s(r(1086),t)},1068:function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.Mises=void 0;const s=r(1069),n=r(232),a=r(319),o=r(265),c=r(236),l=r(343),u=r(1085);t.Mises=class{constructor(){this.config=s.MSdk.newConfig(),this.coinDefine=s.MSdk.newCoinDefine(),this.msgReader=s.MSdk.newMsgReader(),this.coinDefine.load(),this.config.setLCDEndpoint(n.MISES_POINT),this.misesSdk=s.MSdk.newSdk(this.config),this.misesUser=this.misesSdk.userMgr(),this.misesAppMgr=this.misesSdk.appMgr(),this.queryFetchClient=new c.QueryClient}queryFetchClientInit(){return i(this,void 0,void 0,function*(){this.stargateClient=yield this.queryFetchClient.fetchQuery("StargateClient",()=>o.StargateClient.connect(n.MISES_POINT),l.fetchConfig)})}makeClient(){return i(this,void 0,void 0,function*(){try{var e=yield a.Tendermint34Client.create(new u.HttpClient(n.MISES_POINT));return[o.QueryClient.withExtensions(e,o.setupStakingExtension,o.setupDistributionExtension,o.setupAuthExtension,o.setupTxExtension),e]}catch(e){return Promise.reject(e)}})}}},1085:function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpClient=void 0;const s=r(320),n=r(228),a=r(232);t.HttpClient=class{constructor(e){"string"==typeof e?this.url=n.hasProtocol(e)?e:"http://"+e:(this.url=e.url,this.headers=e.headers)}disconnect(){}execute(t){return i(this,void 0,void 0,function*(){var e=yield a.misesRequest({url:this.url,method:"POST",data:t?JSON.stringify(t):void 0,headers:Object.assign({"Content-Type":"application/json"},this.headers),timeout:5e3,isCustomRequest:!0});if(s.isJsonRpcErrorResponse(e))throw new Error(JSON.stringify(e.error));return e})}}},1086:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(347),s=r(557),n=r(1087);t.init=function(e,t){e.registerMessage(i.BalanceUMISMsg),e.registerMessage(i.MisesChainMsg),e.registerMessage(i.RecentTransactionsMsg),e.registerMessage(i.GetChainIdMsg),e.registerMessage(i.UnbondingDelegationsMsg),e.registerMessage(i.DelegationsMsg),e.registerMessage(i.RewardsMsg),e.registerMessage(i.AuthAccountsMsg),e.registerMessage(i.BroadcastTxMsg),e.registerMessage(i.SimulateMsg),e.registerMessage(i.MisesAccountMsg),e.registerMessage(i.HasWalletAccountMsg),e.registerMessage(i.DisconnectMsg),e.registerMessage(i.ConnectMsg),e.registerMessage(i.UserFollowMsg),e.registerMessage(i.UserUnFollowMsg),e.registerMessage(i.SetUserInfoMsg),e.registerMessage(i.StakingMsg),e.registerMessage(i.ActiveUserMsg),e.registerMessage(i.PortForTxMsg),e.registerMessage(i.SaveTranstionsMsg),e.registerMessage(i.OpenWalletMsg),e.addHandler(s.ROUTE,n.getHandler(t))}},1087:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const i=r(347);t.getHandler=r=>(e,t)=>{switch(t.constructor){case i.BalanceUMISMsg:return s(r)(e,t);case i.MisesChainMsg:return n(r)(e,t);case i.RecentTransactionsMsg:return a(r)(e,t);case i.GetChainIdMsg:return o(r)(e,t);case i.UnbondingDelegationsMsg:return c(r)(e,t);case i.DelegationsMsg:return l(r)(e,t);case i.RewardsMsg:return u(r)(e,t);case i.AuthAccountsMsg:return d(r)(e,t);case i.BroadcastTxMsg:return h(r)(e,t);case i.SimulateMsg:return p(r)(e,t);case i.MisesAccountMsg:return f(r)(e,t);case i.HasWalletAccountMsg:return g(r)(e,t);case i.DisconnectMsg:return m(r)(e,t);case i.ConnectMsg:return y(r)(e,t);case i.UserFollowMsg:return v(r)(e,t);case i.UserUnFollowMsg:return b(r)(e,t);case i.SetUserInfoMsg:return w(r)(e,t);case i.StakingMsg:return _(r)(e,t);case i.ActiveUserMsg:return S(r)(e,t);case i.PortForTxMsg:return k(r)(e,t);case i.SaveTranstionsMsg:return M(r)(e,t);case i.OpenWalletMsg:return O(r)(e,t);default:throw new Error("Unknown msg type")}};const s=e=>()=>e.getBalanceUMIS(),n=()=>(e,t)=>"mainnet"===t.chainId,a=e=>()=>e.recentTransactions(),o=e=>()=>e.getChainId(),c=r=>(e,t)=>r.unbondingDelegations(t.address),l=r=>(e,t)=>r.delegations(t.address),u=r=>(e,t)=>r.rewards(t.address),d=r=>(e,t)=>r.authAccounts(t.address),h=r=>(e,t)=>r.broadcastTx(t.tx),p=r=>(e,t)=>r.simulate(t.messages,t.memo,t.signer,t.sequence),f=e=>()=>e.misesAccount(),g=e=>()=>e.hasWalletAccount(),m=r=>(e,t)=>r.disconnect(t.params),y=r=>(e,t)=>r.connect(t.params),v=r=>(e,t)=>r.setFollow(t.toUid),b=r=>(e,t)=>r.setUnFollow(t.toUid),w=r=>(e,t)=>r.setUserInfo(t.params),_=r=>(e,t)=>r.staking(t.params),S=e=>()=>e.userInfo,k=r=>(e,t)=>r.pollForTx(t.txId),M=r=>(e,t)=>r.saveTranstions(t.transtions),O=e=>()=>e.openWallet()},1088:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(558),t),s(r(1089),t)},1089:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=r(348),s=r(559),n=r(1090);t.init=function(e,t){e.registerMessage(i.InitSafeMsg),e.registerMessage(i.VerifyDomainMsg),e.registerMessage(i.SetIsShouldVerifyMsg),e.registerMessage(i.GetIsShouldVerifyMsg),e.addHandler(s.ROUTE,n.getHandler(t))}},1090:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHandler=void 0;const i=r(348);t.getHandler=r=>(e,t)=>{switch(t.constructor){case i.InitSafeMsg:return s(r)(e,t);case i.VerifyDomainMsg:return n(r)(e,t);case i.GetIsShouldVerifyMsg:return a(r)(e,t);case i.SetIsShouldVerifyMsg:return o(r)(e,t);default:throw new Error("Unknown msg type")}};const s=r=>(e,t)=>{r.setIsShouldVerifyState(t.state)},n=r=>(e,t)=>r.initMessageClient(t),a=t=>e=>t.isShouldVerify,o=r=>(e,t)=>r.setIsShouldVerifyState(t.state)},1091:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(520),t),s(r(333),t)},1092:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(343),t),s(r(347),t)},1093:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(558),t),s(r(348),t)},1094:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(1095),t),s(r(1175),t)},1095:function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.SecretWasmService=void 0;const i=r(1096),n=r(50),s=r(27),o=r(16),c=r(3),l=r(4);t.SecretWasmService=class{constructor(e){this.kvStore=e,this.debouncerMap=new Map,this.cacheEnigmaUtils=new Map,this.onChainRemoved=()=>{this.cacheEnigmaUtils=new Map}}init(e,t,r){this.chainsService=e,this.keyRingService=t,this.permissionService=r,this.chainsService.addChainRemovedHandler(this.onChainRemoved)}getPubkey(r,i){return a(this,void 0,void 0,function*(){var e=yield this.chainsService.getChainInfo(i);if("none"===(yield this.keyRingService.getKeyRingType()))throw new c.KeplrError("secret-wasm",130,"Key ring is not initialized");var t=yield this.getSeed(r,e);return this.getEnigmaUtils(e,t).pubkey})}getTxEncryptionKey(r,i,s){return a(this,void 0,void 0,function*(){var e=yield this.chainsService.getChainInfo(i);if("none"===(yield this.keyRingService.getKeyRingType()))throw new c.KeplrError("secret-wasm",130,"Key ring is not initialized");var t=yield this.getSeed(r,e);return this.getEnigmaUtils(e,t).getTxEncryptionKey(s)})}encrypt(r,i,s,n){return a(this,void 0,void 0,function*(){var e=yield this.chainsService.getChainInfo(i);if("none"===(yield this.keyRingService.getKeyRingType()))throw new c.KeplrError("secret-wasm",130,"Key ring is not initialized");var t=yield this.getSeed(r,e);return yield this.getEnigmaUtils(e,t).encrypt(s,n)})}decrypt(r,i,s,n){return a(this,void 0,void 0,function*(){var e=yield this.chainsService.getChainInfo(i);if("none"===(yield this.keyRingService.getKeyRingType()))throw new c.KeplrError("secret-wasm",130,"Key ring is not initialized");var t=yield this.getSeed(r,e);return yield this.getEnigmaUtils(e,t).decrypt(s,n)})}getEnigmaUtils(e,t){var r=e.chainId+"-"+l.Buffer.from(t).toString("hex");return this.cacheEnigmaUtils.has(r)?this.cacheEnigmaUtils.get(r):(e=new i.EnigmaUtils(e.rest,t),this.cacheEnigmaUtils.set(r,e),e)}getSeed(r,i){return a(this,void 0,void 0,function*(){var e=yield this.keyRingService.getKey(i.chainId),e=new o.Bech32Address(e.address).toBech32(i.bech32Config.bech32PrefixAccAddr),t=`${r.isInternalMsg}/${i.chainId}/`+e;return this.debouncerMap.has(t)||this.debouncerMap.set(t,s.Debouncer.promise(this.getSeedInner.bind(this))),yield this.debouncerMap.get(t)(r,i,e)})}getSeedInner(r,i,s){return a(this,void 0,void 0,function*(){var e=`seed-${i.chainId}-`+s,t=yield this.kvStore.get(e);return t?l.Buffer.from(t,"hex"):(t=n.Hash.sha256(l.Buffer.from(yield this.keyRingService.sign(r,i.chainId,l.Buffer.from(JSON.stringify({account_number:0,chain_id:i.chainId,fee:[],memo:"Create Keplr Secret encryption key. Only approve requests by Keplr.",msgs:[],sequence:0}))))),yield this.kvStore.set(e,l.Buffer.from(t).toString("hex")),t)})}}},1175:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetTxEncryptionKeyMsg=t.RequestDecryptMsg=t.ReqeustEncryptMsg=t.GetPubkeyMsg=void 0;const i=r(3),s=r(1176);class n extends i.Message{constructor(e){super(),this.chainId=e}static type(){return"get-pubkey-msg"}validateBasic(){if(!this.chainId)throw new i.KeplrError("secret-wasm",100,"chain id not set")}approveExternal(){return!0}route(){return s.ROUTE}type(){return n.type()}}t.GetPubkeyMsg=n;class a extends i.Message{constructor(e,t,r){super(),this.chainId=e,this.contractCodeHash=t,this.msg=r}static type(){return"request-encrypt-msg"}validateBasic(){if(!this.chainId)throw new i.KeplrError("secret-wasm",100,"chain id not set");if(!this.contractCodeHash)throw new i.KeplrError("secret-wasm",103,"contract code hash not set");if(!this.msg)throw new i.KeplrError("secret-wasm",101,"msg not set")}approveExternal(){return!0}route(){return s.ROUTE}type(){return a.type()}}t.ReqeustEncryptMsg=a;class o extends i.Message{constructor(e,t,r){super(),this.chainId=e,this.cipherText=t,this.nonce=r}static type(){return"request-decrypt-msg"}validateBasic(){if(!this.chainId)throw new i.KeplrError("secret-wasm",100,"chain id not set");if(!this.cipherText||0===this.cipherText.length)throw new i.KeplrError("secret-wasm",102,"ciphertext not set");if(!this.nonce||0===this.nonce.length)throw new i.KeplrError("secret-wasm",110,"nonce not set")}approveExternal(){return!0}route(){return s.ROUTE}type(){return o.type()}}t.RequestDecryptMsg=o;class c extends i.Message{constructor(e,t){super(),this.chainId=e,this.nonce=t}static type(){return"get-tx-encryption-key-msg"}validateBasic(){if(!this.chainId)throw new i.KeplrError("secret-wasm",100,"chain id not set");if(!this.nonce)throw new i.KeplrError("secret-wasm",111,"nonce is null")}approveExternal(){return!0}route(){return s.ROUTE}type(){return c.type()}}t.GetTxEncryptionKeyMsg=c},1176:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="secret-wasm"},1177:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(536),t),s(r(337),t),s(r(1178),t)},1178:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1179:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(538),t),s(r(338),t)},1180:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(540),t),s(r(231),t),s(r(543),t)},1181:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(544),t),s(r(341),t),s(r(1182),t),s(r(545),t)},1182:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1183:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(548),t),s(r(342),t)},1217:function(e,t,r){"use strict";r.d(t,"a",function(){return o}),r.d(t,"b",function(){return c});r(196),r(50),r(379),r(4);var i=r(3);r(96),r(16),r(252),r(1);var t=r(41),t=r.n(t),s=(t.a.object({name:t.a.string().min(1).required(),type:t.a.string().min(1).required()}),t.a.array().items(t.a.object({name:t.a.string().valid("name").required(),type:t.a.string().valid("string").required()}),t.a.object({name:t.a.string().valid("version").required(),type:t.a.string().valid("string").required()}),t.a.object({name:t.a.string().valid("chainId").required(),type:t.a.string().valid("uint256").required()}),t.a.object({name:t.a.string().valid("verifyingContract").required(),type:t.a.string().valid("address","string").required()}),t.a.object({name:t.a.string().valid("salt").required(),type:t.a.string().valid("bytes32","string").required()})).unique().min(1).custom(e=>{const r=["name","version","chainId","verifyingContract","salt"];return e.sort((e,t)=>r.indexOf(e.name)-r.indexOf(t.name))}));t.a.object({types:t.a.object({EIP712Domain:s.required()}).unknown(!0).required(),primaryType:t.a.string().min(1).required(),domain:t.a.object().required(),message:t.a.object().required()});r(596);var n;(s=n=n||{})[s.NOTLOADED=0]="NOTLOADED",s[s.EMPTY=1]="EMPTY",s[s.LOCKED=2]="LOCKED",s[s.UNLOCKED=3]="UNLOCKED",s[s.MIGRATOR=4]="MIGRATOR";r(27),r(100),r(7);t.a.object({chain_id:t.a.string().allow(""),account_number:t.a.string().allow(""),sequence:t.a.string().allow(""),fee:t.a.object({amount:t.a.array().items(t.a.object({denom:t.a.string().allow(""),amount:t.a.string().allow("")})),gas:t.a.string().allow(""),payer:t.a.string().allow(""),granter:t.a.string().allow(""),feePayer:t.a.string().allow("")}),msgs:t.a.array().items(t.a.any()),memo:t.a.string().allow(""),timeout_height:t.a.string().allow("")});r(105);(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});(class extends i.Message{});const a="auto-lock-account";class o extends i.Message{static type(){return"get-auto-lock-account-duration"}constructor(){super()}validateBasic(){}route(){return a}type(){return o.type()}}class c extends i.Message{constructor(e){super(),this.duration=e}static type(){return"update-auto-lock-account-duration"}validateBasic(){if(this.duration<0)throw new i.KeplrError("auto-lock-account",101,"duration cannot be set to a negative number.")}route(){return a}type(){return c.type()}}(class extends i.Message{});(class extends i.Message{})},1348:function(e,t,r){"use strict";r.d(t,"a",function(){return c});var t=r(60),n=r.n(t),i=r(598);new class{constructor(e){this.requestUrlList=[],this.cancelRequestSourceList=[],this.instance=n.a.create(Object.assign(Object.assign({},e),{adapter:i.default})),this.interceptorsObj=e.interceptors,this.instance.interceptors.request.use(e=>e,e=>e),this.instance.interceptors.request.use(null==(e=this.interceptorsObj)?void 0:e.requestInterceptors,null==(e=this.interceptorsObj)?void 0:e.requestInterceptorsCatch),this.instance.interceptors.response.use(null==(e=this.interceptorsObj)?void 0:e.responseInterceptors,null==(e=this.interceptorsObj)?void 0:e.responseInterceptorsCatch),this.instance.interceptors.response.use(e=>e.data,e=>e)}getSourceIndex(t){var e;return null==(e=this.cancelRequestSourceList)?void 0:e.findIndex(e=>Object.keys(e)[0]===t)}delUrl(t){var e,r=null==(r=this.requestUrlList)?void 0:r.findIndex(e=>e===t),i=this.getSourceIndex(t);-1!==r&&null!=(e=this.requestUrlList)&&e.splice(r,1),-1!==i&&null!=(e=this.cancelRequestSourceList)&&e.splice(i,1)}request(s){return new Promise((r,t)=>{var e;const i=(s=null!=(e=s.interceptors)&&e.requestInterceptors?s.interceptors.requestInterceptors(s):s).url;i&&(null!=(e=this.requestUrlList)&&e.push(i),s.cancelToken=new n.a.CancelToken(e=>{var t;null!=(t=this.cancelRequestSourceList)&&t.push({[i]:e})})),this.instance.request(s).then(e=>{var t;null!=(t=s.interceptors)&&t.responseInterceptors&&(e=s.interceptors.responseInterceptors(e)),r(e)}).catch(e=>{t(e)}).finally(()=>{i&&this.delUrl(i)})})}cancelRequest(e){var t,r;"string"==typeof e?0<=(r=this.getSourceIndex(e))&&null!=(t=this.cancelRequestSourceList)&&t[r][e]():e.forEach(e=>{var t,r=this.getSourceIndex(e);0<=r&&null!=(t=this.cancelRequestSourceList)&&t[r][e]()})}cancelAllRequest(){var e;null!=(e=this.cancelRequestSourceList)&&e.forEach(e=>{e[Object.keys(e)[0]]()})}}({baseURL:"https://api.alb.mises.site/api/v1",timeout:3e3,interceptors:{requestInterceptors:e=>e,responseInterceptors:e=>e}});const s=11,a=5,o=4;function c(e="",t=a){return e.length<s?e:e.slice(0,t)+"..."+e.slice(-o)}},229:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveSuggestedChainInfoMsg=t.SuggestChainInfoMsg=t.GetChainInfosMsg=void 0;const i=r(3),s=r(524);class n extends i.Message{static type(){return"get-chain-infos"}validateBasic(){}route(){return s.ROUTE}type(){return n.type()}}t.GetChainInfosMsg=n;class a extends i.Message{constructor(e){super(),this.chainInfo=e}static type(){return"suggest-chain-info"}validateBasic(){if(!this.chainInfo)throw new i.KeplrError("chains",100,"Chain info not set")}approveExternal(){return!0}route(){return s.ROUTE}type(){return a.type()}}t.SuggestChainInfoMsg=a;class o extends i.Message{constructor(e){super(),this.chainId=e}static type(){return"remove-suggested-chain-info"}validateBasic(){if(!this.chainId)throw new i.KeplrError("chains",101,"Chain id not set")}route(){return s.ROUTE}type(){return o.type()}}t.RemoveSuggestedChainInfoMsg=o},230:function(e,t,r){"use strict";var c,i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t},l=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.KeyRing=t.KeyRingStatus=void 0;const o=r(1027),u=r(50),d=r(96),h=r(3),p=r(4),a=r(16),f=r(252),g=n(r(1)),m=r(534),y=r(267),v=r(1040),b=((n=c=t.KeyRingStatus||(t.KeyRingStatus={}))[n.NOTLOADED=0]="NOTLOADED",n[n.EMPTY=1]="EMPTY",n[n.LOCKED=2]="LOCKED",n[n.UNLOCKED=3]="UNLOCKED",n[n.MIGRATOR=4]="MIGRATOR","key-store"),w="key-multi-store";class _{constructor(e,t,r,i){this.embedChainInfos=e,this.kvStore=t,this.crypto=r,this.misesService=i,this.cached=new Map,this.password="",this.mnemonic="",this.migratorStore={vault:""},this.loaded=!1,this.keyStore=null,this.multiKeyStore=[];e=new v.Migrator;(this.migrator=e).migrateData().then(e=>{this.migratorStore=e})}static getTypeOfKeyStore(e){e=e.type;if(null==e)return"mnemonic";if("mnemonic"!==e&&"privateKey"!==e&&"ledger"!==e)throw new h.KeplrError("keyring",132,"Invalid type of key store");return e}get type(){return this.keyStore?_.getTypeOfKeyStore(this.keyStore):"none"}isLocked(){return null==this.privateKey&&null==this.mnemonicMasterSeed&&null==this.ledgerPublicKeyCache}get privateKey(){return this._privateKey}set privateKey(e){this._privateKey=e,this._mnemonicMasterSeed=void 0,this._ledgerPublicKeyCache=void 0,this.cached=new Map}get mnemonicMasterSeed(){return this._mnemonicMasterSeed}set mnemonicMasterSeed(e){this._mnemonicMasterSeed=e,this._privateKey=void 0,this._ledgerPublicKeyCache=void 0,this.cached=new Map}get ledgerPublicKeyCache(){return this._ledgerPublicKeyCache}set ledgerPublicKeyCache(e){this._mnemonicMasterSeed=void 0,this._privateKey=void 0,this._ledgerPublicKeyCache=e,this.cached=new Map}get status(){return this.loaded?!this.keyStore&&this.migratorStore.vault?c.MIGRATOR:this.keyStore?this.isLocked()?c.LOCKED:c.UNLOCKED:c.EMPTY:c.NOTLOADED}getKeyStoreCoinType(e){if(this.keyStore&&this.keyStore.coinTypeForChain)return this.keyStore.coinTypeForChain[a.ChainIdHelper.parse(e).identifier]}getKey(e,t,r){return this.loadKey(this.computeKeyStoreCoinType(e,t),r)}getKeyStoreMeta(e){return this.keyStore&&null!=this.keyStore.meta&&null!=(e=this.keyStore.meta[e])?e:""}computeKeyStoreCoinType(e,t){if(this.keyStore)return this.keyStore.coinTypeForChain&&null!=(e=this.keyStore.coinTypeForChain[a.ChainIdHelper.parse(e).identifier])?e:t;throw new h.KeplrError("keyring",130,"Key store is empty")}getKeyFromCoinType(e,t){return this.loadKey(e,t)}createMnemonicKey(t,r,i,s,n){return l(this,void 0,void 0,function*(){if(![c.EMPTY,c.MIGRATOR].includes(this.status))throw new h.KeplrError("keyring",142,"Key ring is not loaded or not empty");this.mnemonicMasterSeed=u.Mnemonic.generateMasterSeedFromMnemonic(r),this.mnemonic=r,this.keyStore=yield _.CreateMnemonicKeyStore(this.crypto,t,r,i,yield this.assignKeyStoreIdMeta(s),n),this.password=i,this.multiKeyStore.push(this.keyStore);var e=this.loadPrivKey(60),e=new f.Wallet(e.toBytes());return yield this.misesService.initQueryClient(),this.misesService.activateUser(e.privateKey),yield this.save(),{status:this.status,multiKeyStoreInfo:this.getMultiKeyStoreInfo()}})}createPrivateKey(e,t,r,i){return l(this,void 0,void 0,function*(){if(this.status!==c.EMPTY)throw new h.KeplrError("keyring",142,"Key ring is not loaded or not empty");return this.privateKey=t,this.keyStore=yield _.CreatePrivateKeyStore(this.crypto,e,t,r,yield this.assignKeyStoreIdMeta(i)),this.password=r,this.multiKeyStore.push(this.keyStore),yield this.save(),{status:this.status,multiKeyStoreInfo:this.getMultiKeyStoreInfo()}})}lock(){if(this.status!==c.UNLOCKED)throw new h.KeplrError("keyring",143,"Key ring is not unlocked");this.mnemonicMasterSeed=void 0,this.privateKey=void 0,this.ledgerPublicKeyCache=void 0,this.password="",this.mnemonic="",this.misesService.lockAll()}checkKeyStoreStatus(){return l(this,void 0,void 0,function*(){return this.keyStore&&"none"!==this.type||(yield this.restore()),!0})}unlock(t){return l(this,void 0,void 0,function*(){if(yield this.checkKeyStoreStatus(),!this.keyStore||"none"===this.type)throw new h.KeplrError("keyring",144,"Key ring not initialized");if(this.mnemonic=p.Buffer.from(yield o.Crypto.decrypt(this.crypto,this.multiKeyStore[0],t)).toString(),this.mnemonicMasterSeed=u.Mnemonic.generateMasterSeedFromMnemonic(this.mnemonic),"mnemonic"===this.type)this.mnemonicMasterSeed=u.Mnemonic.generateMasterSeedFromMnemonic(p.Buffer.from(yield o.Crypto.decrypt(this.crypto,this.keyStore,t)).toString());else{if("privateKey"!==this.type)throw new h.KeplrError("keyring",145,"Unexpected type of keyring");this.privateKey=p.Buffer.from(p.Buffer.from(yield o.Crypto.decrypt(this.crypto,this.keyStore,t)).toString(),"hex")}this.password=t;var e=this.loadPrivKey(60),e=new f.Wallet(e.toBytes());yield this.misesService.initQueryClient(),this.misesService.activateUser(e.privateKey)})}save(){return l(this,void 0,void 0,function*(){yield this.kvStore.set(b,this.keyStore),yield this.kvStore.set(w,this.multiKeyStore)})}restore(){return l(this,void 0,void 0,function*(){const e=yield this.kvStore.get(b);e?this.keyStore=e:this.keyStore=null;var t=yield this.kvStore.get(w);t?this.multiKeyStore=t:(e?(e.meta=yield this.assignKeyStoreIdMeta({}),this.multiKeyStore=[e]):this.multiKeyStore=[],yield this.save());let r=!1;!this.keyStore||"1"!==this.keyStore.version&&"1.1"!==this.keyStore.version||(r=!0,this.updateLegacyKeyStore(this.keyStore));for(const e of this.multiKeyStore)"1"!==e.version&&"1.1"!==e.version||(r=!0,this.updateLegacyKeyStore(e));r&&(yield this.save()),this.loaded=!0})}updateLegacyKeyStore(e){e.version="1.2";for(const r of this.embedChainInfos){var t=(r.alternativeBIP44s&&0<r.alternativeBIP44s.length?r.alternativeBIP44s[0]:r.bip44).coinType;e.coinTypeForChain=Object.assign(Object.assign({},e.coinTypeForChain),{[a.ChainIdHelper.parse(r.chainId).identifier]:t})}}isKeyStoreCoinTypeSet(e){if(this.keyStore)return this.keyStore.coinTypeForChain&&void 0!==this.keyStore.coinTypeForChain[a.ChainIdHelper.parse(e).identifier];throw new h.KeplrError("keyring",130,"Key store is empty")}setKeyStoreCoinType(t,r){return l(this,void 0,void 0,function*(){if(!this.keyStore)throw new h.KeplrError("keyring",130,"Key store is empty");if(this.keyStore.coinTypeForChain&&void 0!==this.keyStore.coinTypeForChain[a.ChainIdHelper.parse(t).identifier])throw new h.KeplrError("keyring",110,"Coin type already set");this.keyStore.coinTypeForChain=Object.assign(Object.assign({},this.keyStore.coinTypeForChain),{[a.ChainIdHelper.parse(t).identifier]:r});var e=this.multiKeyStore.find(e=>_.getKeyStoreId(e)===_.getKeyStoreId(this.keyStore));e&&(e.coinTypeForChain=Object.assign({},this.keyStore.coinTypeForChain)),yield this.save()})}removeAllKeyStoreCoinType(e){var t=a.ChainIdHelper.parse(e).identifier;this.keyStore&&(delete(e=null!=(e=this.keyStore.coinTypeForChain)?e:{})[t],this.keyStore.coinTypeForChain=e);for(const i of this.multiKeyStore){var r=null!=(r=i.coinTypeForChain)?r:{};delete r[t],i.coinTypeForChain=r}this.save()}deleteKeyRing(i,s){return l(this,void 0,void 0,function*(){if(this.status!==c.UNLOCKED)throw new h.KeplrError("keyring",143,"Key ring is not unlocked");if(this.password!==s)throw new h.KeplrError("keyring",121,"Invalid password");var e=this.multiKeyStore[i];if(!e)throw new h.KeplrError("keyring",130,"Key store is empty");var t=this.multiKeyStore.slice(0,i).concat(this.multiKeyStore.slice(i+1));yield o.Crypto.decrypt(this.crypto,e,s);let r=!1;return this.keyStore&&_.getKeyStoreId(e)===_.getKeyStoreId(this.keyStore)&&(0<t.length?(yield this.lock(),this.keyStore=t[0],yield this.unlock(s)):(this.keyStore=null,this.mnemonicMasterSeed=void 0,this.privateKey=void 0,this.ledgerPublicKeyCache=void 0,this.misesService.lockAll()),r=!0),this.multiKeyStore=t,yield this.save(),{multiKeyStoreInfo:this.getMultiKeyStoreInfo(),keyStoreChanged:r}})}updateNameKeyRing(t,r){return l(this,void 0,void 0,function*(){if(this.status!==c.UNLOCKED)throw new h.KeplrError("keyring",143,"Key ring is not unlocked");var e=this.multiKeyStore[t];if(e)return e.meta=Object.assign(Object.assign({},e.meta),{name:r}),this.keyStore&&_.getKeyStoreId(this.keyStore)===_.getKeyStoreId(e)&&(this.keyStore=e),yield this.save(),this.getMultiKeyStoreInfo();throw new h.KeplrError("keyring",130,"Key store is empty")})}loadKey(e,t=!1){if(this.status!==c.UNLOCKED)throw new h.KeplrError("keyring",143,"Key ring is not unlocked");var r;if(this.keyStore)return r=(e=this.loadPrivKey(e)).getPubKey(),t?(t=new f.Wallet(e.toBytes()),{algo:"ethsecp256k1",pubKey:r.toBytes(),address:p.Buffer.from(t.address.replace("0x",""),"hex"),isNanoLedger:!1}):{algo:"secp256k1",pubKey:r.toBytes(),address:r.getAddress(),isNanoLedger:!1};throw new h.KeplrError("keyring",130,"Key store is empty")}loadPrivKey(e){if(this.status!==c.UNLOCKED||"none"===this.type||!this.keyStore)throw new h.KeplrError("keyring",143,"Key ring is not unlocked");var t=_.getKeyStoreBIP44Path(this.keyStore);if("mnemonic"===this.type){var e=`m/44'/${e}'/${t.account}'/${t.change}/`+t.addressIndex,t=this.cached.get(e);if(t)return new u.PrivKeySecp256k1(t);if(this.mnemonicMasterSeed)return t=u.Mnemonic.generatePrivateKeyFromMasterSeed(this.mnemonicMasterSeed,e),this.cached.set(e,t),new u.PrivKeySecp256k1(t);throw new h.KeplrError("keyring",133,"Key store type is mnemonic and it is unlocked. But, mnemonic is not loaded unexpectedly")}if("privateKey"!==this.type)throw new h.KeplrError("keyring",145,"Unexpected type of keyring");if(this.privateKey)return new u.PrivKeySecp256k1(this.privateKey);throw new h.KeplrError("keyring",134,"Key store type is private key and it is unlocked. But, private key is not loaded unexpectedly")}sign(e,r,i,s,n){return l(this,void 0,void 0,function*(){if(this.status!==c.UNLOCKED)throw new h.KeplrError("keyring",143,"Key ring is not unlocked");var e,t;if(this.keyStore)return e=this.computeKeyStoreCoinType(r,i),t=this.loadPrivKey(e),t=n?t.signDigest32(u.Hash.keccak256(s)):t.sign(s),this.isKeyStoreCoinTypeSet(r)||(yield this.setKeyStoreCoinType(r,e)),t;throw new h.KeplrError("keyring",130,"Key store is empty")})}signEthereum(e,s,n,a,o){return l(this,void 0,void 0,function*(){if(this.status!==c.UNLOCKED)throw new h.KeplrError("keyring",143,"Key ring is not unlocked");if(!this.keyStore)throw new h.KeplrError("keyring",130,"Key store is empty");var e=this.computeKeyStoreCoinType(s,n),e=this.loadPrivKey(e),t=new f.Wallet(e.toBytes());switch(o){case d.EthSignType.MESSAGE:var r=yield t.signMessage(a);return g.arrayify(r);case d.EthSignType.TRANSACTION:r=yield t.signTransaction(JSON.parse(p.Buffer.from(a).toString()));return g.arrayify(r);case d.EthSignType.EIP712:{const i=yield m.EIP712MessageValidator.validateAsync(JSON.parse(p.Buffer.from(a).toString()));r=yield t._signingKey().signDigest(u.Hash.keccak256(p.Buffer.concat([p.Buffer.from("19","hex"),p.Buffer.from("01","hex"),p.Buffer.from(y._TypedDataEncoder.hashStruct("EIP712Domain",{EIP712Domain:i.types.EIP712Domain},i.domain).replace("0x",""),"hex"),p.Buffer.from(y._TypedDataEncoder.from((()=>{var e=Object.assign({},i.types),t=(delete e.EIP712Domain,e[i.primaryType]);if(t)return delete e[i.primaryType],Object.assign({[i.primaryType]:t},e);throw new Error("No matched primary type: "+i.primaryType)})()).hash(i.message).replace("0x",""),"hex")])));return p.Buffer.concat([p.Buffer.from(r.r.replace("0x",""),"hex"),p.Buffer.from(r.s.replace("0x",""),"hex"),r.recoveryParam?p.Buffer.from("1c","hex"):p.Buffer.from("1b","hex")])}default:throw new Error("Unknown sign type: "+o)}})}showKeyRing(r,i){return l(this,void 0,void 0,function*(){if(this.status!==c.UNLOCKED)throw new h.KeplrError("keyring",143,"Key ring is not unlocked");if(this.password!==i)throw new h.KeplrError("keyring",121,"Invalid password");if(-1===r){const e=this.multiKeyStore[0];return p.Buffer.from(yield o.Crypto.decrypt(this.crypto,e,i)).toString()}const e=this.multiKeyStore[r];if(!e)throw new h.KeplrError("keyring",130,"Key store is empty");if("mnemonic"!==e.type)return p.Buffer.from(yield o.Crypto.decrypt(this.crypto,e,i)).toString();var t;if(this.checkPassword(i))return t=this.loadMnemonicPrivKey(60,e),new f.Wallet(t.toBytes()).privateKey.replace("0x","");throw new h.KeplrError("keyring",222,"Unmatched mac")})}loadMnemonicPrivKey(e,t){if(this.status!==c.UNLOCKED||!t)throw new h.KeplrError("keyring",143,"Key ring is not unlocked");t=_.getKeyStoreBIP44Path(t),e=`m/44'/${e}'/${t.account}'/${t.change}/`+t.addressIndex,t=this.cached.get(e);if(t)return new u.PrivKeySecp256k1(t);var t=u.Mnemonic.generateMasterSeedFromMnemonic(this.mnemonic);if(t)return t=u.Mnemonic.generatePrivateKeyFromMasterSeed(t,e),this.cached.set(e,t),new u.PrivKeySecp256k1(t);throw new h.KeplrError("keyring",133,"Key store type is mnemonic and it is unlocked. But, mnemonic is not loaded unexpectedly")}get canSetPath(){return"mnemonic"===this.type||"ledger"===this.type}addMnemonicKey(t,r,i,s){return l(this,void 0,void 0,function*(){if(this.status!==c.UNLOCKED||""==this.password)throw new h.KeplrError("keyring",141,"Key ring is locked or not initialized");var e=yield _.CreateMnemonicKeyStore(this.crypto,t,r,this.password,yield this.assignKeyStoreIdMeta(i),s);return this.multiKeyStore.push(e),yield this.save(),{multiKeyStoreInfo:this.getMultiKeyStoreInfo()}})}_checkPrivateKey(t,r){return l(this,void 0,void 0,function*(){var e;return!!(Array.isArray(t)&&0<t.length)&&(e=t.map(e=>l(this,void 0,void 0,function*(){return p.Buffer.from(yield o.Crypto.decrypt(this.crypto,e,this.password)).toString()})),(yield Promise.all(e)).some(e=>e===r))})}addPrivateKey(t,r,i){return l(this,void 0,void 0,function*(){if(this.status!==c.UNLOCKED||""==this.password)throw new h.KeplrError("keyring",141,"Key ring is locked or not initialized");var e=this.multiKeyStore.filter(e=>"privateKey"===e.type);if(0<e.length&&(yield this._checkPrivateKey(e,p.Buffer.from(r).toString("hex"))))throw new h.KeplrError("keyring",141,"Don't repeat the import privateKey");e=yield _.CreatePrivateKeyStore(this.crypto,t,r,this.password,yield this.assignKeyStoreIdMeta(i));return this.multiKeyStore.push(e),yield this.save(),{multiKeyStoreInfo:this.getMultiKeyStoreInfo()}})}changeKeyStoreFromMultiKeyStore(t){return l(this,void 0,void 0,function*(){if(this.status!==c.UNLOCKED||""==this.password)throw new h.KeplrError("keyring",141,"Key ring is locked or not initialized");var e=this.multiKeyStore[t];if(e)return this.keyStore=e,yield this.unlock(this.password),yield this.save(),{multiKeyStoreInfo:this.getMultiKeyStoreInfo()};throw new h.KeplrError("keyring",120,"Invalid keystore")})}getMultiKeyStoreInfo(){var e=[];for(const t of this.multiKeyStore)e.push({version:t.version,type:t.type,meta:t.meta,coinTypeForChain:t.coinTypeForChain,bip44HDPath:t.bip44HDPath,selected:!!this.keyStore&&_.getKeyStoreId(t)===_.getKeyStoreId(this.keyStore)});return e}checkPassword(e){if(this.password)return this.password===e;throw new h.KeplrError("keyring",100,"Keyring is locked")}exportKeyRingDatas(i){var s,n,a;return l(this,void 0,void 0,function*(){if(!this.password)throw new h.KeplrError("keyring",100,"Keyring is locked");if(this.password!==i)throw new h.KeplrError("keyring",121,"Invalid password");var e=[];for(const r of this.multiKeyStore)switch(null!=(s=r.type)?s:"mnemonic"){case"mnemonic":var t=p.Buffer.from(yield o.Crypto.decrypt(this.crypto,r,i)).toString();e.push({bip44HDPath:null!=(n=r.bip44HDPath)?n:{account:0,change:0,addressIndex:0},coinTypeForChain:r.coinTypeForChain,key:t,meta:null!=(n=r.meta)?n:{},type:"mnemonic"});break;case"privateKey":t=p.Buffer.from(yield o.Crypto.decrypt(this.crypto,r,i)).toString();e.push({bip44HDPath:null!=(n=r.bip44HDPath)?n:{account:0,change:0,addressIndex:0},coinTypeForChain:r.coinTypeForChain,key:t,meta:null!=(a=r.meta)?a:{},type:"privateKey"})}return e})}static CreateMnemonicKeyStore(e,t,r,i,s,n){return l(this,void 0,void 0,function*(){return yield o.Crypto.encrypt(e,t,"mnemonic",r,i,s,n)})}static CreatePrivateKeyStore(e,t,r,i,s){return l(this,void 0,void 0,function*(){return yield o.Crypto.encrypt(e,t,"privateKey",p.Buffer.from(r).toString("hex"),i,s)})}assignKeyStoreIdMeta(e){return l(this,void 0,void 0,function*(){return Object.assign({},e,{__id__:(yield this.getIncrementalNumber()).toString()})})}static getKeyStoreId(e){e=null==(e=e.meta)?void 0:e.__id__;if(e)return e;throw new h.KeplrError("keyring",131,"Key store's id is empty")}static getKeyStoreBIP44Path(e){return e.bip44HDPath?(_.validateBIP44Path(e.bip44HDPath),e.bip44HDPath):{account:0,change:0,addressIndex:0}}static validateBIP44Path(e){if(!Number.isInteger(e.account)||e.account<0)throw new h.KeplrError("keyring",100,"Invalid account in hd path");if(!Number.isInteger(e.change)||0!==e.change&&1!==e.change)throw new h.KeplrError("keyring",102,"Invalid change in hd path");if(!Number.isInteger(e.addressIndex)||e.addressIndex<0)throw new h.KeplrError("keyring",101,"Invalid address index in hd path")}getIncrementalNumber(){return l(this,void 0,void 0,function*(){let e=yield this.kvStore.get("incrementalNumber");return void 0===e&&(e=0),e++,yield this.kvStore.set("incrementalNumber",e),e})}throwErrorIfEthermintWithLedgerButNotEvmos(e){if(this.keyStore&&"ledger"===this.keyStore.type&&!e.startsWith("evmos_"))throw new h.KeplrError("keyring",152,"Ledger is unsupported for this chain")}addAccount(e,t){return l(this,void 0,void 0,function*(){if(!this.mnemonic)throw new h.KeplrError("keyring",152,"Mnemonic not found, Please try again");try{return yield this.addMnemonicKey("scrypt",this.mnemonic,{name:e},t)}catch(e){throw new Error(e)}})}_restoreFirstAccount(e,t){return l(this,void 0,void 0,function*(){return this.createMnemonicKey("scrypt",e,t,{name:"Account 1"},{account:0,change:0,addressIndex:0})})}_addAccounts(e,a){return l(this,void 0,void 0,function*(){var t=new Array(e).fill("").map((e,t)=>{return{bip44HDPath:{account:0,addressIndex:t+1,change:0},name:"Account "+(t+2)}});let r={multiKeyStoreInfo:[]};for(let e=0;e<t.length;e++){var i=t[e];r=yield this.addAccount(i.name,i.bip44HDPath)}var s=a.find(e=>"Simple Key Pair"===e.type);if(0<(null==s?void 0:s.data.length))for(let e=0;e<(null==s?void 0:s.data.length);e++){var n=null==s?void 0:s.data[e],n=p.Buffer.from(n,"hex");r=yield this.addPrivateKey("scrypt",n,{name:"Account "+(r.multiKeyStoreInfo.length+1)})}return r})}migratorKeyRing(a){return l(this,void 0,void 0,function*(){try{var e,t,r,i,s=yield this.migrator.enCodeValut(this.migratorStore,a),n=s.find(e=>"HD Key Tree"===e.type);return n?(e=p.Buffer.from(null==n?void 0:n.data.mnemonic).toString("utf8"),this.mnemonic=e,t=null==n?void 0:n.data.numberOfAccounts,r=yield this._restoreFirstAccount(e,a),i=1<t?t-1:0,yield this.migrator.clearCache(),this.migratorStore={vault:""},0<i?yield this._addAccounts(i,s):r):{multiKeyStoreInfo:[]}}catch(e){throw new Error(e)}})}restoreKeyStore(){this.keyStore=null,this.multiKeyStore=[],this.save()}}t.KeyRing=_},231:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetSecret20ViewingKey=t.RemoveTokenMsg=t.AddTokenMsg=t.SuggestTokenMsg=t.GetTokensMsg=void 0;const i=r(3),s=r(542);class n extends i.Message{constructor(e){super(),this.chainId=e}static type(){return"get-tokens"}validateBasic(){if(!this.chainId)throw new i.KeplrError("tokens",100,"Chain id is empty")}route(){return s.ROUTE}type(){return n.type()}}t.GetTokensMsg=n;class a extends i.Message{constructor(e,t,r){super(),this.chainId=e,this.contractAddress=t,this.viewingKey=r}static type(){return"suggest-token"}approveExternal(){return!0}validateBasic(){if(!this.chainId)throw new i.KeplrError("tokens",100,"Chain id is empty");if(!this.contractAddress)throw new i.KeplrError("tokens",101,"Contract address is empty")}route(){return s.ROUTE}type(){return a.type()}}t.SuggestTokenMsg=a;class o extends i.Message{constructor(e,t){super(),this.chainId=e,this.currency=t}static type(){return"add-token"}validateBasic(){if(!this.chainId)throw new i.KeplrError("tokens",100,"Chain id is empty")}route(){return s.ROUTE}type(){return o.type()}}t.AddTokenMsg=o;class c extends i.Message{constructor(e,t){super(),this.chainId=e,this.currency=t}static type(){return"remove-token"}validateBasic(){if(!this.chainId)throw new i.KeplrError("tokens",100,"Chain id is empty")}route(){return s.ROUTE}type(){return c.type()}}t.RemoveTokenMsg=c;class l extends i.Message{constructor(e,t){super(),this.chainId=e,this.contractAddress=t}static type(){return"get-secret20-viewing-key"}validateBasic(){if(!this.chainId)throw new i.KeplrError("tokens",100,"Chain id is empty");if(!this.contractAddress)throw new i.KeplrError("tokens",101,"Contract address is empty")}approveExternal(){return!0}route(){return s.ROUTE}type(){return l.type()}}t.GetSecret20ViewingKey=l},232:function(e,r,t){"use strict";var s=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.shortenAddress=r.MISES_TRUNCATED_ADDRESS_START_CHARS=r.TRUNCATED_ADDRESS_END_CHARS=r.TRUNCATED_ADDRESS_START_CHARS=r.TRUNCATED_NAME_CHAR_LIMIT=r.cancelAllRequest=r.cancelRequest=r.misesRequest=r.Request=r.MISES_POINT=r.MISES_SITE_API=void 0,r.MISES_SITE_API="https://api.alb.mises.site/api/v1",r.MISES_POINT="http://127.0.0.1:26657";const n=i(t(60)),a=i(t(598));class o{constructor(e){this.requestUrlList=[],this.cancelRequestSourceList=[],this.instance=n.default.create(Object.assign(Object.assign({},e),{adapter:a.default})),this.interceptorsObj=e.interceptors,this.instance.interceptors.request.use(e=>e,e=>e),this.instance.interceptors.request.use(null==(e=this.interceptorsObj)?void 0:e.requestInterceptors,null==(e=this.interceptorsObj)?void 0:e.requestInterceptorsCatch),this.instance.interceptors.response.use(null==(e=this.interceptorsObj)?void 0:e.responseInterceptors,null==(e=this.interceptorsObj)?void 0:e.responseInterceptorsCatch),this.instance.interceptors.response.use(e=>e.data,e=>e)}getSourceIndex(t){var e;return null==(e=this.cancelRequestSourceList)?void 0:e.findIndex(e=>Object.keys(e)[0]===t)}delUrl(t){var e,r=null==(r=this.requestUrlList)?void 0:r.findIndex(e=>e===t),i=this.getSourceIndex(t);-1!==r&&null!=(e=this.requestUrlList)&&e.splice(r,1),-1!==i&&null!=(e=this.cancelRequestSourceList)&&e.splice(i,1)}request(s){return new Promise((r,t)=>{var e;const i=(s=null!=(e=s.interceptors)&&e.requestInterceptors?s.interceptors.requestInterceptors(s):s).url;i&&(null!=(e=this.requestUrlList)&&e.push(i),s.cancelToken=new n.default.CancelToken(e=>{var t;null!=(t=this.cancelRequestSourceList)&&t.push({[i]:e})})),this.instance.request(s).then(e=>{var t;null!=(t=s.interceptors)&&t.responseInterceptors&&(e=s.interceptors.responseInterceptors(e)),r(e)}).catch(e=>{t(e)}).finally(()=>{i&&this.delUrl(i)})})}cancelRequest(e){var t,r;"string"==typeof e?0<=(r=this.getSourceIndex(e))&&null!=(t=this.cancelRequestSourceList)&&t[r][e]():e.forEach(e=>{var t,r=this.getSourceIndex(e);0<=r&&null!=(t=this.cancelRequestSourceList)&&t[r][e]()})}cancelAllRequest(){var e;null!=(e=this.cancelRequestSourceList)&&e.forEach(e=>{e[Object.keys(e)[0]]()})}}const c=new(r.Request=o)({baseURL:r.MISES_SITE_API,timeout:3e3,interceptors:{requestInterceptors:e=>e,responseInterceptors:e=>e}});r.misesRequest=i=>s(void 0,void 0,void 0,function*(){var{method:e="GET"}=i;"get"!==e&&"GET"!==e||(i.params=i.data);try{var t,r=yield c.request(i);if("ECONNABORTED"===r.code)return Promise.reject("ECONNABORTED");let e=r;return i.isCustomRequest&&(t=r,e={data:t,code:"0",message:"success"}),e.data}catch(e){return Promise.reject(e)}}),r.cancelRequest=e=>c.cancelRequest(e);r.cancelAllRequest=()=>c.cancelAllRequest(),r.TRUNCATED_NAME_CHAR_LIMIT=11,r.TRUNCATED_ADDRESS_START_CHARS=5,r.TRUNCATED_ADDRESS_END_CHARS=4,r.MISES_TRUNCATED_ADDRESS_START_CHARS=8,r.shortenAddress=function(e="",t=r.TRUNCATED_ADDRESS_START_CHARS){return e.length<r.TRUNCATED_NAME_CHAR_LIMIT?e:e.slice(0,t)+"..."+e.slice(-r.TRUNCATED_ADDRESS_END_CHARS)}},333:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetPersistentMemoryMsg=t.SetPersistentMemoryMsg=void 0;var i=r(3);const s=r(521);class n extends i.Message{constructor(e){super(),this.data=e}static type(){return"set-persistent-memory"}validateBasic(){}route(){return s.ROUTE}type(){return n.type()}}t.SetPersistentMemoryMsg=n;class a extends i.Message{static type(){return"get-persistent-memory"}constructor(){super()}validateBasic(){}route(){return s.ROUTE}type(){return a.type()}}t.GetPersistentMemoryMsg=a},334:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemovePermissionsOrigin=t.RemovePermissionOrigin=t.AddPermissionOrigin=t.GetOriginPermittedChainsMsg=t.GetPermissionOriginsMsg=t.EnableAccessMsg=void 0;const i=r(3),s=r(528);class n extends i.Message{constructor(e){super(),this.chainIds=e}static type(){return"enable-access"}validateBasic(){if(!this.chainIds||0===this.chainIds.length)throw new i.KeplrError("permission",100,"chain id not set")}route(){return s.ROUTE}approveExternal(){return!0}type(){return n.type()}}t.EnableAccessMsg=n;class a extends i.Message{constructor(e,t){super(),this.chainId=e,this.permissionType=t}static type(){return"get-permission-origins"}validateBasic(){if(!this.chainId)throw new i.KeplrError("permission",100,"chain id not set");if(!this.permissionType)throw new i.KeplrError("permission",110,"empty permission type")}route(){return s.ROUTE}type(){return a.type()}}t.GetPermissionOriginsMsg=a;class o extends i.Message{constructor(e,t){super(),this.permissionOrigin=e,this.permissionType=t}static type(){return"get-origin-permitted-chains"}validateBasic(){if(!this.permissionOrigin)throw new i.KeplrError("permission",101,"origin not set");if(!this.permissionType)throw new i.KeplrError("permission",110,"empty permission type")}route(){return s.ROUTE}type(){return o.type()}}t.GetOriginPermittedChainsMsg=o;class c extends i.Message{constructor(e,t,r){super(),this.chainId=e,this.permissionType=t,this.permissionOrigin=r}static type(){return"add-permission-origin"}validateBasic(){if(!this.chainId)throw new i.KeplrError("permission",100,"chain id not set");if(!this.permissionType)throw new i.KeplrError("permission",110,"empty permission type");if(!this.permissionOrigin)throw new i.KeplrError("permission",111,"empty permission origin")}route(){return s.ROUTE}type(){return c.type()}}t.AddPermissionOrigin=c;class l extends i.Message{constructor(e,t,r){super(),this.chainId=e,this.permissionType=t,this.permissionOrigin=r}static type(){return"remove-permission-origin"}validateBasic(){if(!this.chainId)throw new i.KeplrError("permission",100,"chain id not set");if(!this.permissionType)throw new i.KeplrError("permission",110,"empty permission type");if(!this.permissionOrigin)throw new i.KeplrError("permission",111,"empty permission origin")}route(){return s.ROUTE}type(){return l.type()}}t.RemovePermissionOrigin=l;class u extends i.Message{constructor(e){super(),this.chainId=e}static type(){return"remove-permissions-origin"}validateBasic(){if(!this.chainId)throw new i.KeplrError("permission",100,"chain id not set")}route(){return s.ROUTE}type(){return u.type()}}t.RemovePermissionsOrigin=u},336:function(j,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RestoreKeyStoreMsg=e.MigratorKeyRingMsg=e.AddAccountMsg=e.IsUnlockMsg=e.ExportKeyRingDatasMsg=e.CheckPasswordMsg=e.SetKeyStoreCoinTypeMsg=e.GetIsKeyStoreCoinTypeSetMsg=e.ChangeKeyRingMsg=e.GetMultiKeyStoreInfoMsg=e.RequestSignDirectMsg=e.RequestVerifyADR36AminoSignDoc=e.RequestSignEIP712CosmosTxMsg_v0=e.RequestSignAminoMsg=e.GetKeyMsg=e.UnlockKeyRingMsg=e.LockKeyRingMsg=e.AddPrivateKeyMsg=e.CreatePrivateKeyMsg=e.AddMnemonicKeyMsg=e.CreateMnemonicKeyMsg=e.ShowKeyRingMsg=e.UpdateNameKeyRingMsg=e.DeleteKeyRingMsg=e.RestoreKeyRingMsg=void 0;const i=t(3),r=t(535),s=t(230),n=t(16),a=t(96),o=t(105),c=t(100),l=t(4);class u extends i.Message{static type(){return"restore-keyring"}constructor(){super()}validateBasic(){}route(){return r.ROUTE}type(){return u.type()}}e.RestoreKeyRingMsg=u;class d extends i.Message{constructor(e,t){super(),this.index=e,this.password=t}static type(){return"delete-keyring"}validateBasic(){if(!Number.isInteger(this.index))throw new i.KeplrError("keyring",201,"Invalid index");if(!this.password)throw new i.KeplrError("keyring",274,"password not set")}route(){return r.ROUTE}type(){return d.type()}}e.DeleteKeyRingMsg=d;class h extends i.Message{constructor(e,t){super(),this.index=e,this.name=t}static type(){return"update-name-keyring"}validateBasic(){if(!Number.isInteger(this.index))throw new i.KeplrError("keyring",201,"Invalid index");if(!this.name)throw new i.KeplrError("keyring",273,"name not set")}route(){return r.ROUTE}type(){return h.type()}}e.UpdateNameKeyRingMsg=h;class p extends i.Message{constructor(e,t){super(),this.index=e,this.password=t}static type(){return"show-keyring"}validateBasic(){if(!Number.isInteger(this.index))throw new i.KeplrError("keyring",201,"Invalid index");if(!this.password)throw new i.KeplrError("keyring",274,"password not set")}route(){return r.ROUTE}type(){return p.type()}}e.ShowKeyRingMsg=p;class f extends i.Message{constructor(e,t,r,i,s){super(),this.kdf=e,this.mnemonic=t,this.password=r,this.meta=i,this.bip44HDPath=s}static type(){return"create-mnemonic-key"}validateBasic(){if("scrypt"!==this.kdf&&"sha256"!==this.kdf&&"pbkdf2"!==this.kdf)throw new i.KeplrError("keyring",202,"Invalid kdf");if(!this.mnemonic)throw new i.KeplrError("keyring",272,"mnemonic not set");if(!this.password)throw new i.KeplrError("keyring",274,"password not set");try{o.mnemonicToEntropy(this.mnemonic)}catch(e){if("Invalid mnemonic checksum"!==e.message)throw e}s.KeyRing.validateBIP44Path(this.bip44HDPath)}route(){return r.ROUTE}type(){return f.type()}}e.CreateMnemonicKeyMsg=f;class g extends i.Message{constructor(e,t,r,i){super(),this.kdf=e,this.mnemonic=t,this.meta=r,this.bip44HDPath=i}static type(){return"add-mnemonic-key"}validateBasic(){if("scrypt"!==this.kdf&&"sha256"!==this.kdf&&"pbkdf2"!==this.kdf)throw new i.KeplrError("keyring",202,"Invalid kdf");if(!this.mnemonic)throw new i.KeplrError("keyring",272,"mnemonic not set");try{o.mnemonicToEntropy(this.mnemonic)}catch(e){if("Invalid mnemonic checksum"!==e.message)throw e}s.KeyRing.validateBIP44Path(this.bip44HDPath)}route(){return r.ROUTE}type(){return g.type()}}e.AddMnemonicKeyMsg=g;class m extends i.Message{constructor(e,t,r,i){super(),this.kdf=e,this.privateKey=t,this.password=r,this.meta=i}static type(){return"create-private-key"}validateBasic(){if("scrypt"!==this.kdf&&"sha256"!==this.kdf&&"pbkdf2"!==this.kdf)throw new i.KeplrError("keyring",202,"Invalid kdf");if(!this.privateKey||0===this.privateKey.length)throw new i.KeplrError("keyring",275,"private key not set");if(32!==this.privateKey.length)throw new i.KeplrError("keyring",260,"invalid length of private key");if(!this.password)throw new i.KeplrError("keyring",274,"password not set")}route(){return r.ROUTE}type(){return m.type()}}e.CreatePrivateKeyMsg=m;class y extends i.Message{constructor(e,t,r){super(),this.kdf=e,this.privateKey=t,this.meta=r}static type(){return"add-private-key"}validateBasic(){if("scrypt"!==this.kdf&&"sha256"!==this.kdf&&"pbkdf2"!==this.kdf)throw new i.KeplrError("keyring",202,"Invalid kdf");if(!this.privateKey||0===this.privateKey.length)throw new i.KeplrError("keyring",275,"private key not set");if(32!==this.privateKey.length)throw new i.KeplrError("keyring",260,"invalid length of private key")}route(){return r.ROUTE}type(){return y.type()}}e.AddPrivateKeyMsg=y;class v extends i.Message{static type(){return"lock-keyring"}constructor(){super()}validateBasic(){}route(){return r.ROUTE}type(){return v.type()}}e.LockKeyRingMsg=v;class b extends i.Message{constructor(e=""){super(),this.password=e}static type(){return"unlock-keyring"}validateBasic(){if(!this.password)throw new i.KeplrError("keyring",274,"password not set")}route(){return r.ROUTE}type(){return b.type()}}e.UnlockKeyRingMsg=b;class w extends i.Message{constructor(e){super(),this.chainId=e}static type(){return"get-key"}validateBasic(){if(!this.chainId)throw new i.KeplrError("keyring",270,"chain id not set")}approveExternal(){return!0}route(){return r.ROUTE}type(){return w.type()}}e.GetKeyMsg=w;class _ extends i.Message{constructor(e,t,r,i={}){super(),this.chainId=e,this.signer=t,this.signDoc=r,this.signOptions=i}static type(){return"request-sign-amino"}validateBasic(){var e;if(!this.chainId)throw new i.KeplrError("keyring",270,"chain id not set");if(!this.signer)throw new i.KeplrError("keyring",230,"signer not set");if(n.Bech32Address.validate(this.signer),n.checkAndValidateADR36AminoSignDoc(this.signDoc)){if(this.signDoc.msgs[0].value.signer!==this.signer)throw new i.KeplrError("keyring",233,"Unmatched signer in sign doc");if(this.signOptions.ethSignType&&this.signOptions.ethSignType===a.EthSignType.EIP712){var t=JSON.parse(l.Buffer.from(this.signDoc.msgs[0].value.data,"base64").toString()),r=n.EthermintChainIdHelper.parse(this.chainId)["ethChainId"];if(parseFloat(null==(e=t.domain)?void 0:e.chainId)!==r)throw new Error(`Unmatched chain id for eth (expected: ${r}, actual: ${null==(e=t.domain)?void 0:e.chainId})`)}}else{if(this.signOptions.ethSignType)throw new Error("Eth sign type can be requested with only ADR-36 amino sign doc");if(this.signDoc.chain_id!==this.chainId)throw new i.KeplrError("keyring",234,"Chain id in the message is not matched with the requested chain id")}if(!this.signOptions)throw new i.KeplrError("keyring",235,"Sign options are null")}approveExternal(){return!0}route(){return r.ROUTE}type(){return _.type()}}e.RequestSignAminoMsg=_;class S extends i.Message{constructor(e,t,r,i,s){super(),this.chainId=e,this.signer=t,this.eip712=r,this.signDoc=i,this.signOptions=s}static type(){return"request-sign-eip-712-cosmos-tx-v0"}validateBasic(){if(!this.chainId)throw new i.KeplrError("keyring",270,"chain id not set");if(!this.signer)throw new i.KeplrError("keyring",230,"signer not set");if(n.Bech32Address.validate(this.signer),n.checkAndValidateADR36AminoSignDoc(this.signDoc))throw new Error("Can't sign ADR-36 with EIP-712");if(this.signDoc.chain_id!==this.chainId)throw new i.KeplrError("keyring",234,"Chain id in the message is not matched with the requested chain id");var e=n.EthermintChainIdHelper.parse(this.chainId)["ethChainId"];if(parseFloat(this.eip712.domain.chainId)!==e)throw new Error(`Unmatched chain id for eth (expected: ${e}, actual: ${this.eip712.domain.chainId})`);if(!this.signOptions)throw new i.KeplrError("keyring",235,"Sign options are null")}approveExternal(){return!0}route(){return r.ROUTE}type(){return S.type()}}e.RequestSignEIP712CosmosTxMsg_v0=S;class k extends i.Message{constructor(e,t,r,i){super(),this.chainId=e,this.signer=t,this.data=r,this.signature=i}static type(){return"request-verify-adr-36-amino-doc"}validateBasic(){if(!this.chainId)throw new i.KeplrError("keyring",270,"chain id not set");if(!this.signer)throw new i.KeplrError("keyring",230,"signer not set");if(!this.signature)throw new i.KeplrError("keyring",271,"Signature not set");n.Bech32Address.validate(this.signer)}approveExternal(){return!0}route(){return r.ROUTE}type(){return k.type()}}e.RequestVerifyADR36AminoSignDoc=k;class M extends i.Message{constructor(e,t,r,i={}){super(),this.chainId=e,this.signer=t,this.signDoc=r,this.signOptions=i}static type(){return"request-sign-direct"}validateBasic(){if(!this.chainId)throw new i.KeplrError("keyring",270,"chain id not set");if(!this.signer)throw new i.KeplrError("keyring",230,"signer not set");if(n.Bech32Address.validate(this.signer),c.SignDoc.fromPartial({bodyBytes:this.signDoc.bodyBytes,authInfoBytes:this.signDoc.authInfoBytes,chainId:this.signDoc.chainId,accountNumber:this.signDoc.accountNumber}).chainId!==this.chainId)throw new i.KeplrError("keyring",234,"Chain id in the message is not matched with the requested chain id");if(!this.signOptions)throw new i.KeplrError("keyring",235,"Sign options are null")}approveExternal(){return!0}route(){return r.ROUTE}type(){return M.type()}}e.RequestSignDirectMsg=M;class O extends i.Message{static type(){return"get-multi-key-store-info"}constructor(){super()}validateBasic(){}route(){return r.ROUTE}type(){return O.type()}}e.GetMultiKeyStoreInfoMsg=O;class x extends i.Message{constructor(e){super(),this.index=e}static type(){return"change-keyring"}validateBasic(){if(this.index<0)throw new i.KeplrError("keyring",200,"Index is negative");if(!Number.isInteger(this.index))throw new i.KeplrError("keyring",201,"Invalid index")}route(){return r.ROUTE}type(){return x.type()}}e.ChangeKeyRingMsg=x;class E extends i.Message{constructor(e,t){super(),this.chainId=e,this.paths=t}static type(){return"get-is-keystore-coin-type-set"}validateBasic(){if(!this.chainId)throw new i.KeplrError("keyring",270,"chain id not set");if(0===this.paths.length)throw new i.KeplrError("keyring",250,"empty bip44 path list")}route(){return r.ROUTE}type(){return E.type()}}e.GetIsKeyStoreCoinTypeSetMsg=E;class R extends i.Message{constructor(e,t){super(),this.chainId=e,this.coinType=t}static type(){return"set-keystore-coin-type"}validateBasic(){if(!this.chainId)throw new i.KeplrError("keyring",270,"chain id not set");if(this.coinType<0)throw new i.KeplrError("keyring",240,"coin type can not be negative");if(!Number.isInteger(this.coinType))throw new i.KeplrError("keyring",241,"coin type should be integer")}route(){return r.ROUTE}type(){return R.type()}}e.SetKeyStoreCoinTypeMsg=R;class I extends i.Message{constructor(e){super(),this.password=e}static type(){return"check-keyring-password"}validateBasic(){if(!this.password)throw new i.KeplrError("keyring",274,"password not set")}route(){return r.ROUTE}type(){return I.type()}}e.CheckPasswordMsg=I;class C extends i.Message{constructor(e){super(),this.password=e}static type(){return"export-keyring-datas"}validateBasic(){if(!this.password)throw new i.KeplrError("keyring",274,"password not set")}route(){return r.ROUTE}type(){return C.type()}}e.ExportKeyRingDatasMsg=C;class A extends i.Message{static type(){return"isUnlocked"}constructor(){super()}validateBasic(){}approveExternal(){return!0}route(){return r.ROUTE}type(){return A.type()}}e.IsUnlockMsg=A;class T extends i.Message{constructor(e,t){super(),this.name=e,this.bip44HDPath=t}static type(){return"add-account"}validateBasic(){}route(){return r.ROUTE}type(){return T.type()}}e.AddAccountMsg=T;class P extends i.Message{constructor(e){super(),this.password=e}static type(){return"migrator"}validateBasic(){}route(){return r.ROUTE}type(){return P.type()}}e.MigratorKeyRingMsg=P;class K extends i.Message{static type(){return"remove-all-Key-store"}constructor(){super()}validateBasic(){}route(){return r.ROUTE}type(){return K.type()}}e.RestoreKeyStoreMsg=K},337:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendTxMsg=void 0;const i=r(3),s=r(537);class n extends i.Message{constructor(e,t,r){super(),this.chainId=e,this.tx=t,this.mode=r}static type(){return"send-tx-to-background"}validateBasic(){if(!this.chainId)throw new i.KeplrError("tx",100,"chain id is empty");if(!this.tx)throw new i.KeplrError("tx",101,"tx is empty");if(!this.mode||"sync"!==this.mode&&"async"!==this.mode&&"block"!==this.mode)throw new i.KeplrError("tx",120,"invalid mode")}approveExternal(){return!0}route(){return s.ROUTE}type(){return n.type()}}t.SendTxMsg=n},338:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResetChainEndpointsMsg=t.SetChainEndpointsMsg=t.TryUpdateChainMsg=void 0;const i=r(3),s=r(539);class n extends i.Message{constructor(e){super(),this.chainId=e}static type(){return"try-update-chain"}validateBasic(){if(!this.chainId)throw new i.KeplrError("updater",100,"Empty chain id")}route(){return s.ROUTE}type(){return n.type()}}t.TryUpdateChainMsg=n;class a extends i.Message{constructor(e,t,r){super(),this.chainId=e,this.rpc=t,this.rest=r}static type(){return"set-chain-endpoints"}validateBasic(){if(!this.chainId)throw new i.KeplrError("updater",100,"Empty chain id");if(this.rpc){var e=new URL(this.rpc);if("http:"!==e.protocol&&"https:"!==e.protocol)throw new Error("RPC has invalid protocol: "+e.protocol)}if(this.rest){e=new URL(this.rest);if("http:"!==e.protocol&&"https:"!==e.protocol)throw new Error("LCD has invalid protocol: "+e.protocol)}}route(){return s.ROUTE}type(){return a.type()}}t.SetChainEndpointsMsg=a;class o extends i.Message{constructor(e){super(),this.chainId=e}static type(){return"reset-chain-endpoints"}validateBasic(){if(!this.chainId)throw new i.KeplrError("updater",100,"Empty chain id")}route(){return s.ROUTE}type(){return o.type()}}t.ResetChainEndpointsMsg=o},339:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(529),t),s(r(336),t),s(r(1051),t),s(r(230),t),s(r(534),t)},340:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PushEventDataMsg=t.PushInteractionDataMsg=void 0;const i=r(3),s=r(546);class n extends i.Message{constructor(e){super(),this.data=e}static type(){return"push-interaction-data"}validateBasic(){if(!this.data.type)throw new i.KeplrError("interaction",101,"Type should not be empty")}route(){return s.ROUTE}type(){return n.type()}}t.PushInteractionDataMsg=n;class a extends i.Message{constructor(e){super(),this.data=e}static type(){return"push-event-data"}validateBasic(){if(!this.data.type)throw new i.KeplrError("interaction",101,"Type should not be empty")}route(){return s.ROUTE}type(){return a.type()}}t.PushEventDataMsg=a},341:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RejectInteractionMsg=t.ApproveInteractionMsg=void 0;var i=r(3);const s=r(547);class n extends i.Message{constructor(e,t){super(),this.id=e,this.result=t}static type(){return"approve-interaction"}validateBasic(){}route(){return s.ROUTE}type(){return n.type()}}t.ApproveInteractionMsg=n;class a extends i.Message{constructor(e){super(),this.id=e}static type(){return"reject-interaction"}validateBasic(){}route(){return s.ROUTE}type(){return a.type()}}t.RejectInteractionMsg=a},342:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LockMsg=t.StartAutoLockMonitoringMsg=t.UpdateAutoLockAccountDurationMsg=t.GetAutoLockAccountDurationMsg=void 0;const i=r(3),s=r(549);class n extends i.Message{static type(){return"get-auto-lock-account-duration"}constructor(){super()}validateBasic(){}route(){return s.ROUTE}type(){return n.type()}}t.GetAutoLockAccountDurationMsg=n;class a extends i.Message{constructor(e){super(),this.duration=e}static type(){return"update-auto-lock-account-duration"}validateBasic(){if(this.duration<0)throw new i.KeplrError("auto-lock-account",101,"duration cannot be set to a negative number.")}route(){return s.ROUTE}type(){return a.type()}}t.UpdateAutoLockAccountDurationMsg=a;class o extends i.Message{static type(){return"start-auto-lock-monitoring"}constructor(){super()}validateBasic(){}route(){return s.ROUTE}type(){return o.type()}}t.StartAutoLockMonitoringMsg=o;class c extends i.Message{static type(){return"lock-msg"}constructor(){super()}validateBasic(){}route(){return s.ROUTE}type(){return c.type()}}t.LockMsg=c},343:function(e,a,t){"use strict";var o=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0}),a.MisesService=a.fetchConfig=void 0;const i=t(1068),c=t(232),l=t(265),s=r(t(7)),u={misesId:"",nickname:"",avatar:void 0,token:"",timestamp:0,transtions:[]};a.fetchConfig={retry:3,retryDelay:1e3};a.MisesService=class{constructor(e){this.kvStore=e,this.userInfo=u,this.keepAlivePort=null,this.data={}}init(){this.mises=new i.Mises}initQueryClient(){return o(this,void 0,void 0,function*(){if(this.queryClient)return this.queryClient;this.mises.queryFetchClient.fetchQuery("gasPriceAndLimit",()=>this.gasPriceAndLimit(),a.fetchConfig);try{var[e,t]=yield this.mises.queryFetchClient.fetchQuery("makeClient",()=>this.mises.makeClient(),a.fetchConfig);return this.queryClient=e,this.tmClient=t,e}catch(e){}})}activateUser(t){return o(this,void 0,void 0,function*(){this.activeUser=yield this.mises.misesUser.activateUser(t.replace("0x",""));var e=yield this.misesUserInfo();this.storeUserInfo(e),this.initKeepAlive(),browser.storage.local.set({setAccount:!0})})}misesUserInfo(){var n;return o(this,void 0,void 0,function*(){var e=this.activeUser&&this.activeUser.address(),t=(yield this.kvStore.get(e))||u,r=(new Date).getTime(),r=t.token&&t.timestamp&&6048e5<r-t.timestamp;if(!t.token||r){const i=yield this.getinstallreferrer();r=(new Date).getTime().toString();const s=(yield this.generateAuth(r))["auth"];r=yield this.mises.queryFetchClient.fetchQuery("getServerToken",()=>this.getServerToken({provider:"mises",user_authz:{auth:s},referrer:i}),a.fetchConfig);t.token=r,t.timestamp=(new Date).getTime()}return(yield this.activeUser.isRegistered())&&(r=yield null==(n=this.activeUser)?void 0:n.info(),t.avatar=null==r?void 0:r.avatarUrl,t.nickname=(null==r?void 0:r.name)||""),t.nickname=t.nickname||c.shortenAddress(e,c.MISES_TRUNCATED_ADDRESS_START_CHARS),t.misesId=e,t})}lockAll(){this.resetUserInfo(),this.mises.misesUser.lockAll(),this.activeUser=void 0,this.disconnectKeepAlive()}generateAuth(e){return o(this,void 0,void 0,function*(){if(this.activeUser)return{auth:yield this.activeUser.generateAuth(e),misesId:this.userInfo.misesId};throw new Error("Unknown activeUser")})}setToMisesPrivate(e){return browser.misesPrivate&&browser.misesPrivate.setMisesId(JSON.stringify(e)),Promise.resolve()}setUnFollow(e){return o(this,void 0,void 0,function*(){try{return this.activeUser.unfollow(e),Promise.resolve()}catch(e){return Promise.reject(e)}})}setFollow(e){try{return this.activeUser.follow(e),Promise.resolve()}catch(e){return Promise.reject(e)}}getServerToken(e){return o(this,void 0,void 0,function*(){try{return(yield c.misesRequest({url:"/signin",method:"POST",data:e,timeout:5e3})).token}catch(e){return Promise.reject(e)}})}getGasPrices(){return o(this,void 0,void 0,function*(){try{return c.misesRequest({url:"/mises/gasprices",timeout:5e3})}catch(e){return Promise.resolve({propose_gasprice:0})}})}getinstallreferrer(){return new Promise(e=>{browser.misesPrivate&&browser.misesPrivate.getInstallReferrer?browser.misesPrivate.getInstallReferrer(e):e("")})}setUserInfo(a){return o(this,void 0,void 0,function*(){try{var e=this.activeUser,t=(yield e.info()).version.add(1),{misesId:r,token:i,timestamp:s}=this.userInfo,n=(yield e.setInfo(Object.assign(Object.assign({},a),{version:t})),{nickname:a.name||c.shortenAddress(r,c.MISES_TRUNCATED_ADDRESS_START_CHARS),avatar:a.avatarUrl,token:i,misesId:r,timestamp:s,transtions:this.userInfo.transtions});return this.storeUserInfo(n),!0}catch(e){return Promise.reject(e)}})}connect({domain:e,appid:t,userid:r,permissions:i}){return o(this,void 0,void 0,function*(){try{return yield this.mises.misesAppMgr.ensureApp(t,e),yield this.mises.misesSdk.connect(e,t,r,i)}catch(e){return!1}})}disconnect({appid:e,userid:t}){return this.mises.misesSdk.disconnect(e,t)}gasPriceAndLimit(){return o(this,void 0,void 0,function*(){try{var e=(yield this.getGasPrices()).propose_gasprice||this.mises.config.gasPrice();return this.mises.config.setGasPriceAndLimit(e,2e5),e}catch(e){return Promise.resolve(this.mises.config.gasPrice())}})}resetUserInfo(){this.userInfo=u,this.save()}storeUserInfo(e){this.userInfo=e,this.save(),e.token&&this.setToMisesPrivate(e)}save(){var e=null==(e=this.activeUser)?void 0:e.address();if(e)return this.kvStore.set(e,this.userInfo)}getBalanceUMIS(){var t;return o(this,void 0,void 0,function*(){var e=yield null==(t=this.activeUser)?void 0:t.getBalanceUMIS();return this.mises.coinDefine.toCoinUMIS(e||s.default.ZERO)})}getChainId(){return this.mises.stargateClient.getChainId()}unbondingDelegations(t){return o(this,void 0,void 0,function*(){var e=yield this.initQueryClient();return null==e?void 0:e.staking.delegatorUnbondingDelegations(t)})}delegations(r){var i;return o(this,void 0,void 0,function*(){var e=yield this.initQueryClient(),t=yield null==e?void 0:e.staking.delegatorDelegations(r);if(100<((null==(i=null==(i=null==t?void 0:t.pagination)?void 0:i.total)?void 0:i.toNumber())||0)&&null!=t&&t.delegationResponses){e=yield null==e?void 0:e.staking.delegatorDelegations(r,null==(i=null==t?void 0:t.pagination)?void 0:i.nextKey);if(null!=e&&e.delegationResponses)return{delegationResponses:[...t.delegationResponses,...null==e?void 0:e.delegationResponses]}}return t})}rewards(t){return o(this,void 0,void 0,function*(){var e=yield this.initQueryClient();return null==e?void 0:e.distribution.delegationTotalRewards(t)})}authAccounts(t){return o(this,void 0,void 0,function*(){var e=yield this.initQueryClient();return null==e?void 0:e.auth.account(t)})}pollForTx(i,s=45e3,n=3e3){return o(this,void 0,void 0,function*(){let e=!1;var t=setTimeout(()=>{e=!0},s);"string"!=typeof i&&(i=this.toHex(i));try{if(e)throw new l.TimeoutError(`Transaction with ID ${i} was submitted but was not yet found on the chain. You might want to check later.`,i);yield this.sleep(n);var r=yield this.getTx(i);return clearTimeout(t),r||this.pollForTx(i)}catch(e){return clearTimeout(t),Promise.reject(e)}})}broadcastTx(t){return o(this,void 0,void 0,function*(){try{var e=yield this.tmClient.broadcastTxSync({tx:t});if(e.code)throw new Error(`Broadcasting transaction failed with code ${e.code} (codespace: ${e.codeSpace}). Log: `+e.log);return this.toHex(e.hash).toUpperCase()}catch(e){return Promise.reject(e)}})}simulate(t,r,i,s){var n;return o(this,void 0,void 0,function*(){var e=yield this.queryClient.tx.simulate(t,r,i,s);return{gasUsed:null==(n=e.gasInfo)?void 0:n.gasUsed}})}toHex(e){let t="";for(const r of e)t+=("0"+r.toString(16)).slice(-2);return t}getTx(t){return o(this,void 0,void 0,function*(){var e=yield this.txsQuery(`tx.hash='${t}'`,{minHeight:0,maxHeight:void 0,page:1});if(0!==e.totalCount&&e.txs)return{code:(e=e.txs[0]).code,height:e.height,rawLog:e.rawLog,hash:e.hash,gasUsed:e.gasUsed,gasWanted:e.gasWanted}})}txsQuery(s,n){return o(this,void 0,void 0,function*(){const e=n.minHeight||0,t=n.maxHeight||Number.MAX_SAFE_INTEGER;var r=n.page||1;let i;try{i=yield this.tmClient.txSearch({query:`${s} AND tx.height>=${e} AND tx.height<=`+t,page:r})}catch(e){i={totalCount:0,txs:[]}}return this.tmClient.disconnect(),{totalCount:i.totalCount,txs:i.txs.map(e=>({height:e.height,hash:this.toHex(e.hash).toUpperCase(),code:e.result.code,rawLog:e.result.log||"",tx:e.tx,gasUsed:e.result.gasUsed,gasWanted:e.result.gasWanted}))}})}sleep(t=3e3){return new Promise(e=>setTimeout(e,t))}misesAccount(){return o(this,void 0,void 0,function*(){try{var e=(new Date).getTime().toString(),t=(yield this.generateAuth(e))["auth"];return{auth:t,address:this.activeUser.address()}}catch(e){throw new Error(e.message)}})}hasWalletAccount(){return o(this,void 0,void 0,function*(){var e=(yield browser.storage.local.get("setAccount"))["setAccount"];return!!e})}staking(t){return o(this,void 0,void 0,function*(){try{var e=yield this.activeUser.postTx(t.msgs,"",t.gasFee,t.gasLimit);return 0!==e.code?Promise.reject(e.rawLog):e}catch(e){throw new Error(e.message)}})}parseAmountItem(e){return e.value?(e=null==(e=e.value)?void 0:e.replace("umis","|umis").split("|"),e=this.mises.coinDefine.fromCoin({amount:e[0],denom:e[1]}),{amount:(e=this.mises.coinDefine.toCoinMIS(e)).amount,denom:e.denom.toUpperCase()}):{amount:"0",denom:"MIS"}}parseTxEvents(u,d){return d.raw.reduce((e,t)=>{var r;let i={amount:"",denom:""},s={value:""},n={value:""},a="",o="",c="misesIn";switch(t.type){case"transfer":var l=t.attributes.find(e=>"amount"===e.key);l&&(i=this.parseAmountItem(l)),s=t.attributes.find(e=>"recipient"===e.key),n=t.attributes.find(e=>"sender"===e.key),a=s&&s.value===u?"receive":"send",o=s&&s.value===u?"Receive":"Send",c=s&&s.value===u?"misesIn":"misesOut";break;case"withdraw_rewards":l=t.attributes.find(e=>"amount"===e.key);l&&(i=this.parseAmountItem(l)),n=t.attributes.find(e=>"validator"===e.key),s={value:u},a="interaction",o="Withdraw Rewards",c="misesIn";break;case"delegate":l=t.attributes.find(e=>"amount"===e.key);l&&(i=this.parseAmountItem(l)),n={value:u},s=t.attributes.find(e=>"validator"===e.key),a="interaction",o="Delegate",c="misesOut";break;case"redelegate":l=t.attributes.find(e=>"amount"===e.key);l&&(i=this.parseAmountItem(l)),n={value:u},s=t.attributes.find(e=>"destination_validator"===e.key),a="interaction",o="Redelegate",c="misesOut";break;case"unbond":l=t.attributes.find(e=>"amount"===e.key);l&&(i=this.parseAmountItem(l)),n=t.attributes.find(e=>"validator"===e.key),s={value:u},a="interaction",o="Undelegate",c="misesIn";break;default:return e}return e.concat({category:a,date:0===e.length?""+d.height:d.height+":"+e.length,height:d.height,initialTransaction:{id:"0x0",hash:d.hash},primaryCurrency:i.amount+" "+i.denom,recipientAddress:null!=(r=s.value)?r:"",secondaryCurrency:i.amount+" "+i.denom,senderAddress:null!=(r=n.value)?r:"",title:o,transactionGroupType:c,resultLength:e.length})},[])}recentTransactions(){return o(this,void 0,void 0,function*(){try{const i=this.activeUser;var t,r=this.userInfo.transtions[0]?this.userInfo.transtions[0].height+1:0;let e=yield null===i||void 0===i?void 0:i.recentTransactions(r);return Array.isArray(e)?((t=[...e=e.reduce((e,t)=>(t.raw=[],JSON.parse(t.rawLog).forEach(e=>{t.raw=[...t.raw,...e.events]}),[...e,...this.parseTxEvents(i.address(),t)]),[])]).sort((e,t)=>e.height===t.height?e.resultLength-t.resultLength:t.height-e.height),t):[]}catch(e){return Promise.reject(e)}})}saveTranstions(e){this.userInfo.transtions=e,this.save()}openWallet(){browser.tabs.create({url:browser.runtime.getURL("popup.html")})}handleMessage(e){}handleDisconnect(e){this.keepAlivePort&&(this.keepAlivePort.onMessage.removeListener(this.handleMessage),this.keepAlivePort.onDisconnect.removeListener(this.handleDisconnect),this.keepAlivePort=null)}initKeepAlive(){this.keepAlivePort||(this.keepAlivePort=browser.runtime.connectNative("site.mises.browser"),this.keepAlivePort.onMessage.addListener(this.handleMessage),this.keepAlivePort.onDisconnect.addListener(this.handleDisconnect),this.keepAlivePort.postMessage({text:"keep-alive service worker"}))}disconnectKeepAlive(){var e;this.keepAlivePort&&(null!=(e=this.keepAlivePort)&&e.disconnect(),this.handleDisconnect({}))}}},347:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenWalletMsg=t.SaveTranstionsMsg=t.PortForTxMsg=t.ActiveUserMsg=t.StakingMsg=t.SetUserInfoMsg=t.UserUnFollowMsg=t.UserFollowMsg=t.ConnectMsg=t.DisconnectMsg=t.HasWalletAccountMsg=t.MisesAccountMsg=t.SimulateMsg=t.BroadcastTxMsg=t.AuthAccountsMsg=t.RewardsMsg=t.DelegationsMsg=t.UnbondingDelegationsMsg=t.GetChainIdMsg=t.RecentTransactionsMsg=t.MisesChainMsg=t.BalanceUMISMsg=void 0;const i=r(3),s=r(557);class n extends i.Message{static type(){return"balance-umis"}constructor(){super()}validateBasic(){}route(){return s.ROUTE}type(){return n.type()}}t.BalanceUMISMsg=n;class a extends i.Message{constructor(e){super(),this.chainId=e}static type(){return"mises-chain"}validateBasic(){if(!this.chainId)throw new i.KeplrError("mises",274,"chainId not set")}route(){return s.ROUTE}type(){return a.type()}}t.MisesChainMsg=a;class o extends i.Message{static type(){return"recent-transaction"}constructor(){super()}validateBasic(){}route(){return s.ROUTE}type(){return o.type()}}t.RecentTransactionsMsg=o;class c extends i.Message{static type(){return"get-chain-id"}constructor(){super()}validateBasic(){}route(){return s.ROUTE}type(){return c.type()}}t.GetChainIdMsg=c;class l extends i.Message{constructor(e){super(),this.address=e}static type(){return"unbonding-delegations"}validateBasic(){if(!this.address)throw new i.KeplrError("mises",274,"address not set")}route(){return s.ROUTE}type(){return l.type()}}t.UnbondingDelegationsMsg=l;class u extends i.Message{constructor(e){super(),this.address=e}static type(){return"delegations"}validateBasic(){if(!this.address)throw new i.KeplrError("mises",274,"address not set")}route(){return s.ROUTE}type(){return u.type()}}t.DelegationsMsg=u;class d extends i.Message{constructor(e){super(),this.address=e}static type(){return"rewards"}validateBasic(){if(!this.address)throw new i.KeplrError("mises",274,"address not set")}route(){return s.ROUTE}type(){return d.type()}}t.RewardsMsg=d;class h extends i.Message{constructor(e){super(),this.address=e}static type(){return"auth-accounts"}validateBasic(){if(!this.address)throw new i.KeplrError("mises",274,"address not set")}route(){return s.ROUTE}type(){return h.type()}}t.AuthAccountsMsg=h;class p extends i.Message{constructor(e){super(),this.tx=e}static type(){return"broadcast-tx-to-background"}validateBasic(){if(!this.tx)throw new i.KeplrError("tx",101,"tx is empty")}approveExternal(){return!0}route(){return s.ROUTE}type(){return p.type()}}t.BroadcastTxMsg=p;class f extends i.Message{constructor(e,t,r,i){super(),this.messages=e,this.memo=t,this.signer=r,this.sequence=i}static type(){return"simulate"}validateBasic(){if(!this.messages)throw new i.KeplrError("messages",101,"messages is empty");if(!this.signer)throw new i.KeplrError("signer",101,"signer is empty");if(!this.sequence)throw new i.KeplrError("sequence",101,"sequence is empty")}approveExternal(){return!0}route(){return s.ROUTE}type(){return f.type()}}t.SimulateMsg=f;class g extends i.Message{static type(){return"mises-account"}constructor(){super()}validateBasic(){}approveExternal(){return!0}route(){return s.ROUTE}type(){return g.type()}}t.MisesAccountMsg=g;class m extends i.Message{static type(){return"has-wallet-account"}constructor(){super()}validateBasic(){}approveExternal(){return!0}route(){return s.ROUTE}type(){return m.type()}}t.HasWalletAccountMsg=m;class y extends i.Message{constructor(e){super(),this.params=e}static type(){return"disconnect"}validateBasic(){if(!this.params.appid)throw new i.KeplrError("appid",101,"appid is empty");if(!this.params.userid)throw new i.KeplrError("userid",101,"userid is empty")}approveExternal(){return!0}route(){return s.ROUTE}type(){return y.type()}}t.DisconnectMsg=y;class v extends i.Message{constructor(e){super(),this.params=e}static type(){return"connect"}validateBasic(){if(!this.params.appid)throw new i.KeplrError("appid",101,"appid is empty");if(!this.params.userid)throw new i.KeplrError("userid",101,"userid is empty");if(!this.params.domain)throw new i.KeplrError("domain",101,"domain is empty");if(!this.params.permissions)throw new i.KeplrError("permissions",101,"permissions is empty")}approveExternal(){return!0}route(){return s.ROUTE}type(){return v.type()}}t.ConnectMsg=v;class b extends i.Message{constructor(e){super(),this.toUid=e}static type(){return"userFollow"}validateBasic(){if(!this.toUid)throw new i.KeplrError("toUid",101,"toUid is empty")}approveExternal(){return!0}route(){return s.ROUTE}type(){return b.type()}}t.UserFollowMsg=b;class w extends i.Message{constructor(e){super(),this.toUid=e}static type(){return"userUnFollow"}validateBasic(){if(!this.toUid)throw new i.KeplrError("toUid",101,"toUid is empty")}approveExternal(){return!0}route(){return s.ROUTE}type(){return w.type()}}t.UserUnFollowMsg=w;class _ extends i.Message{constructor(e){super(),this.params=e}static type(){return"set-user-info"}validateBasic(){if(!this.params)throw new i.KeplrError("params",101,"params is empty")}approveExternal(){return!0}route(){return s.ROUTE}type(){return _.type()}}t.SetUserInfoMsg=_;class S extends i.Message{constructor(e){super(),this.params=e}static type(){return"staking"}validateBasic(){if(!this.params)throw new i.KeplrError("params",101,"params is empty")}approveExternal(){return!0}route(){return s.ROUTE}type(){return S.type()}}t.StakingMsg=S;class k extends i.Message{static type(){return"active-user"}constructor(){super()}validateBasic(){}approveExternal(){return!0}route(){return s.ROUTE}type(){return k.type()}}t.ActiveUserMsg=k;class M extends i.Message{constructor(e){super(),this.txId=e}static type(){return"port-for-tx"}validateBasic(){if(!this.txId)throw new i.KeplrError("txId",101,"txId is empty")}route(){return s.ROUTE}type(){return M.type()}}t.PortForTxMsg=M;class O extends i.Message{constructor(e){super(),this.transtions=e}static type(){return"save-transtions"}validateBasic(){if(!this.transtions)throw new i.KeplrError("transtions",101,"transtions is empty")}route(){return s.ROUTE}type(){return O.type()}}t.SaveTranstionsMsg=O;class x extends i.Message{static type(){return"open-wallet"}constructor(){super()}approveExternal(){return!0}validateBasic(){}route(){return s.ROUTE}type(){return x.type()}}t.OpenWalletMsg=x},348:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetIsShouldVerifyMsg=t.GetIsShouldVerifyMsg=t.VerifyDomainMsg=t.InitSafeMsg=void 0;const i=r(3),s=r(559);class n extends i.Message{constructor(e){super(),this.state=e}static type(){return"init-mises-safe"}validateBasic(){if(!this.state)throw new i.KeplrError("state",101,"state is empty")}route(){return s.ROUTE}type(){return n.type()}}t.InitSafeMsg=n;class a extends i.Message{constructor(e){super(),this.params=e}static type(){return"verify-domain"}validateBasic(){}route(){return s.ROUTE}approveExternal(){return!0}type(){return a.type()}}t.VerifyDomainMsg=a;class o extends i.Message{static type(){return"get-is-should-verify"}constructor(){super()}validateBasic(){}route(){return s.ROUTE}approveExternal(){return!0}type(){return o.type()}}t.GetIsShouldVerifyMsg=o;class c extends i.Message{constructor(e){super(),this.state=e}static type(){return"set-is-should-verify"}validateBasic(){}route(){return s.ROUTE}approveExternal(){return!0}type(){return c.type()}}t.SetIsShouldVerifyMsg=c},379:function(e,t,r){t.pbkdf2=r(1028),t.pbkdf2Sync=r(532)},41:function(e,t,r){var i,s;self,e.exports=(i={1238:e=>{"use strict";e.exports={version:"17.5.0"}},7629:(e,t,r)=>{"use strict";const o=r(375),a=r(8571),s=r(9474),c=r(1687),i=r(8652),l=r(8160),n=r(3292),u=r(6354),d=r(8901),h=r(9708),p=r(6914),f=r(2294),g=r(6133),m=r(1152),y=r(8863),v=r(2036),b={Base:class{constructor(e){this.type=e,this.$_root=null,this._definition={},this._reset()}_reset(){this._ids=new f.Ids,this._preferences=null,this._refs=new g.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return o("function"==typeof h.describe,"Manifest functionality disabled"),h.describe(this)}allow(...e){return l.verifyFlat(e,"allow"),this._values(e,"_valids")}alter(e){o(e&&"object"==typeof e&&!Array.isArray(e),"Invalid targets argument"),o(!this._inRuleset(),"Cannot set alterations inside a ruleset");var t=this.clone();t.$_terms.alterations=t.$_terms.alterations||[];for(const i in e){var r=e[i];o("function"==typeof r,"Alteration adjuster for",i,"must be a function"),t.$_terms.alterations.push({target:i,adjuster:r})}return t.$_temp.ruleset=!1,t}artifact(e){return o(void 0!==e,"Artifact cannot be undefined"),o(!this._cache,"Cannot set an artifact with a rule cache"),this.$_setFlag("artifact",e)}cast(e){return o(!1===e||"string"==typeof e,"Invalid to value"),o(!1===e||this._definition.cast[e],"Type",this.type,"does not support casting to",e),this.$_setFlag("cast",!1===e?void 0:e)}default(e,t){return this._default("default",e,t)}description(e){return o(e&&"string"==typeof e,"Description must be a non-empty string"),this.$_setFlag("description",e)}empty(e){var t=this.clone();return void 0!==e&&(e=t.$_compile(e,{override:!1})),t.$_setFlag("empty",e,{clone:!1})}error(e){return o(e,"Missing error"),o(e instanceof Error||"function"==typeof e,"Must provide a valid Error object or a function"),this.$_setFlag("error",e)}example(e,t={}){return o(void 0!==e,"Missing example"),l.assertOptions(t,["override"]),this._inner("examples",e,{single:!0,override:t.override})}external(e,t){return"object"==typeof e&&(o(!t,"Cannot combine options with description"),t=e.description,e=e.method),o("function"==typeof e,"Method must be a function"),o(void 0===t||t&&"string"==typeof t,"Description must be a non-empty string"),this._inner("externals",{method:e,description:t},{single:!0})}failover(e,t){return this._default("failover",e,t)}forbidden(){return this.presence("forbidden")}id(e){return e?(o("string"==typeof e,"id must be a non-empty string"),o(/^[^\.]+$/.test(e),"id cannot contain period character"),this.$_setFlag("id",e)):this.$_setFlag("id",void 0)}invalid(...e){return this._values(e,"_invalids")}label(e){return o(e&&"string"==typeof e,"Label name must be a non-empty string"),this.$_setFlag("label",e)}meta(e){return o(void 0!==e,"Meta cannot be undefined"),this._inner("metas",e,{single:!0})}note(...e){o(e.length,"Missing notes");for(const t of e)o(t&&"string"==typeof t,"Notes must be non-empty strings");return this._inner("notes",e)}only(e=!0){return o("boolean"==typeof e,"Invalid mode:",e),this.$_setFlag("only",e)}optional(){return this.presence("optional")}prefs(e){o(e,"Missing preferences"),o(void 0===e.context,"Cannot override context"),o(void 0===e.externals,"Cannot override externals"),o(void 0===e.warnings,"Cannot override warnings"),o(void 0===e.debug,"Cannot override debug"),l.checkPreferences(e);var t=this.clone();return t._preferences=l.preferences(t._preferences,e),t}presence(e){return o(["optional","required","forbidden"].includes(e),"Unknown presence mode",e),this.$_setFlag("presence",e)}raw(e=!0){return this.$_setFlag("result",e?"raw":void 0)}result(e){return o(["raw","strip"].includes(e),"Unknown result mode",e),this.$_setFlag("result",e)}required(){return this.presence("required")}strict(e){var t=this.clone(),e=void 0!==e&&!e;return t._preferences=l.preferences(t._preferences,{convert:e}),t}strip(e=!0){return this.$_setFlag("result",e?"strip":void 0)}tag(...e){o(e.length,"Missing tags");for(const t of e)o(t&&"string"==typeof t,"Tags must be non-empty strings");return this._inner("tags",e)}unit(e){return o(e&&"string"==typeof e,"Unit name must be a non-empty string"),this.$_setFlag("unit",e)}valid(...e){l.verifyFlat(e,"valid");e=this.allow(...e);return e.$_setFlag("only",!!e._valids,{clone:!1}),e}when(e,t){var r=this.clone(),t=(r.$_terms.whens||(r.$_terms.whens=[]),n.when(r,e,t));if(!["any","link"].includes(r.type)){const e=t.is?[t]:t.switch;for(const t of e)o(!t.then||"any"===t.then.type||t.then.type===r.type,"Cannot combine",r.type,"with",t.then&&t.then.type),o(!t.otherwise||"any"===t.otherwise.type||t.otherwise.type===r.type,"Cannot combine",r.type,"with",t.otherwise&&t.otherwise.type)}return r.$_terms.whens.push(t),r.$_mutateRebuild()}cache(e){o(!this._inRuleset(),"Cannot set caching inside a ruleset"),o(!this._cache,"Cannot override schema cache"),o(void 0===this._flags.artifact,"Cannot cache a rule with an artifact");var t=this.clone();return t._cache=e||i.provider.provision(),t.$_temp.ruleset=!1,t}clone(){var e=Object.create(Object.getPrototypeOf(this));return this._assign(e)}concat(e){o(l.isSchema(e),"Invalid schema object"),o("any"===this.type||"any"===e.type||e.type===this.type,"Cannot merge type",this.type,"with another type:",e.type),o(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),o(!e._inRuleset(),"Cannot concatenate a schema with open ruleset");let t=this.clone();if("any"===this.type&&"any"!==e.type){var r=e.clone();for(const e of Object.keys(t))"type"!==e&&(r[e]=t[e]);t=r}t._ids.concat(e._ids),t._refs.register(e,g.toSibling),t._preferences=t._preferences?l.preferences(t._preferences,e._preferences):e._preferences,t._valids=v.merge(t._valids,e._valids,e._invalids),t._invalids=v.merge(t._invalids,e._invalids,e._valids);for(const s of e._singleRules.keys())t._singleRules.has(s)&&(t._rules=t._rules.filter(e=>e.keep||e.name!==s),t._singleRules.delete(s));for(const n of e._rules)e._definition.rules[n.method].multi||t._singleRules.set(n.name,n),t._rules.push(n);var i;t._flags.empty&&e._flags.empty?(t._flags.empty=t._flags.empty.concat(e._flags.empty),delete(i=Object.assign({},e._flags)).empty,c(t._flags,i)):e._flags.empty?(t._flags.empty=e._flags.empty,delete(i=Object.assign({},e._flags)).empty,c(t._flags,i)):c(t._flags,e._flags);for(const a in e.$_terms){const o=e.$_terms[a];o?t.$_terms[a]?t.$_terms[a]=t.$_terms[a].concat(o):t.$_terms[a]=o.slice():t.$_terms[a]||(t.$_terms[a]=o)}return this.$_root._tracer&&this.$_root._tracer._combine(t,[this,e]),t.$_mutateRebuild()}extend(e){return o(!e.base,"Cannot extend type with another base"),d.type(this,e)}extract(e){return e=Array.isArray(e)?e:e.split("."),this._ids.reach(e)}fork(e,t){o(!this._inRuleset(),"Cannot fork inside a ruleset");let r=this;for(var i of[].concat(e))i=Array.isArray(i)?i:i.split("."),r=r._ids.fork(i,t,r);return r.$_temp.ruleset=!1,r}rule(t){var r=this._definition;l.assertOptions(t,Object.keys(r.modifiers)),o(!1!==this.$_temp.ruleset,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");const i=null===this.$_temp.ruleset?this._rules.length-1:this.$_temp.ruleset;o(0<=i&&i<this._rules.length,"Cannot apply rules to empty ruleset");var s=this.clone();for(let e=i;e<s._rules.length;++e){const i=s._rules[e],n=a(i);for(const a in t)r.modifiers[a](n,t[a]),o(n.name===i.name,"Cannot change rule name");s._rules[e]=n,s._singleRules.get(n.name)===i&&s._singleRules.set(n.name,n)}return s.$_temp.ruleset=!1,s.$_mutateRebuild()}get ruleset(){o(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");var e=this.clone();return e.$_temp.ruleset=e._rules.length,e}get $(){return this.ruleset}tailor(t){t=[].concat(t),o(!this._inRuleset(),"Cannot tailor inside a ruleset");let e=this;if(this.$_terms.alterations)for(var{target:r,adjuster:i}of this.$_terms.alterations)t.includes(r)&&(e=i(e),o(l.isSchema(e),"Alteration adjuster for",r,"failed to return a schema object"));return(e=e.$_modify({each:e=>e.tailor(t),ref:!1})).$_temp.ruleset=!1,e.$_mutateRebuild()}tracer(){return m.location?m.location(this):this}validate(e,t){return y.entry(e,this,t)}validateAsync(e,t){return y.entryAsync(e,this,t)}$_addRule(t){"string"==typeof t&&(t={name:t}),o(t&&"object"==typeof t,"Invalid options"),o(t.name&&"string"==typeof t.name,"Invalid rule name");for(const r in t)o("_"!==r[0],"Cannot set private rule properties");const r=Object.assign({},t);r._resolve=[],r.method=r.method||r.name;var i=this._definition.rules[r.method],s=r.args,n=(o(i,"Unknown rule",r.method),this.clone());if(s){o(1===Object.keys(s).length||Object.keys(s).length===this._definition.rules[r.name].args.length,"Invalid rule definition for",this.type,r.name);for(const t in s){let e=s[t];if(void 0!==e){if(i.argsByName){var a=i.argsByName.get(t);if(a.ref&&l.isResolvable(e))r._resolve.push(t),n.$_mutateRegister(e);else if(a.normalize&&(e=a.normalize(e),s[t]=e),a.assert){const r=l.validateArg(e,t,a);o(!r,r,"or reference")}}s[t]=e}else delete s[t]}}return i.multi||(n._ruleRemove(r.name,{clone:!1}),n._singleRules.set(r.name,r)),!1===n.$_temp.ruleset&&(n.$_temp.ruleset=null),i.priority?n._rules.unshift(r):n._rules.push(r),n}$_compile(e,t){return n.schema(this.$_root,e,t)}$_createError(e,t,r,i,s,n={}){var a=!1!==n.flags?this._flags:{},n=n.messages?p.merge(this._definition.messages,n.messages):this._definition.messages;return new u.Report(e,t,r,a,n,i,s)}$_getFlag(e){return this._flags[e]}$_getRule(e){return this._singleRules.get(e)}$_mapLabels(e){return e=Array.isArray(e)?e:e.split("."),this._ids.labels(e)}$_match(e,t,r,i){(r=Object.assign({},r)).abortEarly=!0,r._externals=!1,t.snapshot();e=!y.validate(e,this,t,r,i).errors;return t.restore(),e}$_modify(e){return l.assertOptions(e,["each","once","ref","schema"]),f.schema(this,e)||this}$_mutateRebuild(){return o(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset(),this.$_modify({each:(e,{source:t,name:r,key:i})=>{t=this._definition[t][r]&&this._definition[t][r].register;!1!==t&&this.$_mutateRegister(e,{family:t,key:i})}}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(e,{family:t,key:r}={}){this._refs.register(e,t),this._ids.register(e,{key:r})}$_property(e){return this._definition.properties[e]}$_reach(e){return this._ids.reach(e)}$_rootReferences(){return this._refs.roots()}$_setFlag(e,t,r={}){o("_"===e[0]||!this._inRuleset(),"Cannot set flag inside a ruleset");var i=this._definition.flags[e]||{};return s(t,i.default)&&(t=void 0),s(t,this._flags[e])?this:(i=!1!==r.clone?this.clone():this,void 0!==t?(i._flags[e]=t,i.$_mutateRegister(t)):delete i._flags[e],"_"!==e[0]&&(i.$_temp.ruleset=!1),i)}$_parent(e,...t){return this[e][l.symbols.parent].call(this,...t)}$_validate(e,t,r){return y.validate(e,this,t,r)}_assign(e){e.type=this.type,e.$_root=this.$_root,e.$_temp=Object.assign({},this.$_temp),e.$_temp.whens={},e._ids=this._ids.clone(),e._preferences=this._preferences,e._valids=this._valids&&this._valids.clone(),e._invalids=this._invalids&&this._invalids.clone(),e._rules=this._rules.slice(),e._singleRules=a(this._singleRules,{shallow:!0}),e._refs=this._refs.clone(),e._flags=Object.assign({},this._flags),e._cache=null,e.$_terms={};for(const t in this.$_terms)e.$_terms[t]=this.$_terms[t]?this.$_terms[t].slice():null;e.$_super={};for(const r in this.$_super)e.$_super[r]=this._super[r].bind(e);return e}_bare(){var e=this.clone(),t=(e._reset(),e._definition.terms);for(const i in t){var r=t[i];e.$_terms[i]=r.init}return e.$_mutateRebuild()}_default(e,t,r={}){return l.assertOptions(r,"literal"),o(void 0!==t,"Missing",e,"value"),o("function"==typeof t||!r.literal,"Only function value supports literal option"),"function"==typeof t&&r.literal&&(t={[l.symbols.literal]:!0,literal:t}),this.$_setFlag(e,t)}_generate(r,i,s){if(!this.$_terms.whens)return{schema:this};var n=[],a=[];for(let t=0;t<this.$_terms.whens.length;++t){const f=this.$_terms.whens[t];if(f.concat)n.push(f.concat),a.push("".concat(t,".concat"));else{var o=f.ref?f.ref.resolve(r,i,s):r,c=f.is?[f]:f.switch,e=a.length;for(let e=0;e<c.length;++e){var{is:l,then:u,otherwise:d}=c[e],h="".concat(t).concat(f.switch?"."+e:"");if(l.$_match(o,i.nest(l,"".concat(h,".is")),s)){if(u){const p=i.localize([...i.path,"".concat(h,".then")],i.ancestors,i.schemas),{schema:f,id:g}=u._generate(r,p,s);n.push(f),a.push("".concat(h,".then").concat(g?"(".concat(g,")"):""));break}}else if(d){const p=i.localize([...i.path,"".concat(h,".otherwise")],i.ancestors,i.schemas),{schema:f,id:m}=d._generate(r,p,s);n.push(f),a.push("".concat(h,".otherwise").concat(m?"(".concat(m,")"):""));break}}if(f.break&&e<a.length)break}}const p=a.join(", ");if(i.mainstay.tracer.debug(i,"rule","when",p),!p)return{schema:this};if(!i.mainstay.tracer.active&&this.$_temp.whens[p])return{schema:this.$_temp.whens[p],id:p};let f=this;this._definition.generate&&(f=this._definition.generate(this,r,i,s));for(const r of n)f=f.concat(r);return this.$_root._tracer&&this.$_root._tracer._combine(f,[this,...n]),{schema:this.$_temp.whens[p]=f,id:p}}_inner(e,t,r={}){o(!this._inRuleset(),"Cannot set ".concat(e," inside a ruleset"));var i=this.clone();return i.$_terms[e]&&!r.override||(i.$_terms[e]=[]),r.single?i.$_terms[e].push(t):i.$_terms[e].push(...t),i.$_temp.ruleset=!1,i}_inRuleset(){return null!==this.$_temp.ruleset&&!1!==this.$_temp.ruleset}_ruleRemove(t,e={}){if(!this._singleRules.has(t))return this;var r=!1!==e.clone?this.clone():this,i=(r._singleRules.delete(t),[]);for(let e=0;e<r._rules.length;++e){var s=r._rules[e];s.name!==t||s.keep?i.push(s):r._inRuleset()&&e<r.$_temp.ruleset&&--r.$_temp.ruleset}return r._rules=i,r}_values(e,t){l.verifyFlat(e,t.slice(1,-1));const r=this.clone(),i=e[0]===l.symbols.override;if(i&&(e=e.slice(1)),!r[t]&&e.length?r[t]=new v:i&&(r[t]=e.length?new v:null,r.$_mutateRebuild()),r[t]){i&&r[t].override();for(const i of e){o(void 0!==i,"Cannot call allow/valid/invalid with undefined"),o(i!==l.symbols.override,"Override must be the first value");const e="_invalids"===t?"_valids":"_invalids";r[e]&&(r[e].remove(i),r[e].length||(o("_valids"===t||!r._flags.only,"Setting invalid value",i,"leaves schema rejecting all values due to previous valid rule"),r[e]=null)),r[t].add(i,r._refs)}}return r}}};b.Base.prototype[l.symbols.any]={version:l.version,compile:n.compile,root:"$_root"},b.Base.prototype.isImmutable=!0,b.Base.prototype.deny=b.Base.prototype.invalid,b.Base.prototype.disallow=b.Base.prototype.invalid,b.Base.prototype.equal=b.Base.prototype.valid,b.Base.prototype.exist=b.Base.prototype.required,b.Base.prototype.not=b.Base.prototype.invalid,b.Base.prototype.options=b.Base.prototype.prefs,b.Base.prototype.preferences=b.Base.prototype.prefs,e.exports=new b.Base},8652:(e,t,r)=>{"use strict";const i=r(375),s=r(8571),n=r(8160),a={max:1e3,supported:new Set(["undefined","boolean","number","string"])};t.provider={provision:e=>new a.Cache(e)},a.Cache=class{constructor(e={}){n.assertOptions(e,["max"]),i(void 0===e.max||e.max&&0<e.max&&isFinite(e.max),"Invalid max cache size"),this._max=e.max||a.max,this._map=new Map,this._list=new a.List}get length(){return this._map.size}set(t,r){if(null===t||a.supported.has(typeof t)){let e=this._map.get(t);e?(e.value=r,this._list.first(e)):(e=this._list.unshift({key:t,value:r}),this._map.set(t,e),this._compact())}}get(e){e=this._map.get(e);if(e)return this._list.first(e),s(e.value)}_compact(){var e;this._map.size>this._max&&(e=this._list.pop(),this._map.delete(e.key))}},a.List=class{constructor(){this.tail=null,this.head=null}unshift(e){return e.next=null,e.prev=this.head,this.head&&(this.head.next=e),this.head=e,this.tail||(this.tail=e),e}first(e){e!==this.head&&(this._remove(e),this.unshift(e))}pop(){return this._remove(this.tail)}_remove(e){var{next:t,prev:r}=e;return(t.prev=r)&&(r.next=t),e===this.tail&&(this.tail=t),e.prev=null,e.next=null,e}}},8160:(e,s,i)=>{"use strict";const n=i(375),t=i(7916),r=i(1238);let a,o;const c={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};s.version=r.version,s.defaults={abortEarly:!0,allowUnknown:!1,artifacts:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1},s.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),errors:Symbol("errors"),literal:Symbol("literal"),override:Symbol("override"),parent:Symbol("parent"),prefs:Symbol("prefs"),ref:Symbol("ref"),template:Symbol("template"),values:Symbol("values")},s.assertOptions=function(e,t,r="Options"){n(e&&"object"==typeof e&&!Array.isArray(e),"Options must be of type object");e=Object.keys(e).filter(e=>!t.includes(e));n(0===e.length,"".concat(r," contain unknown keys: ").concat(e))},s.checkPreferences=function(e){e=(o=o||i(3378)).preferences.validate(e);if(e.error)throw new t([e.error.details[0].message])},s.compare=function(e,t,r){switch(r){case"=":return e===t;case">":return t<e;case"<":return e<t;case">=":return t<=e;case"<=":return e<=t}},s.default=function(e,t){return void 0===e?t:e},s.isIsoDate=function(e){return c.isoDate.test(e)},s.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},s.isResolvable=function(e){return!!e&&(e[s.symbols.ref]||e[s.symbols.template])},s.isSchema=function(e,t={}){e=e&&e[s.symbols.any];return!!e&&(n(t.legacy||e.version===s.version,"Cannot mix different versions of joi schemas"),!0)},s.isValues=function(e){return e[s.symbols.values]},s.limit=function(e){return Number.isSafeInteger(e)&&0<=e},s.preferences=function(e,t){a=a||i(6914),e=e||{},t=t||{};var r=Object.assign({},e,t);return t.errors&&e.errors&&(r.errors=Object.assign({},e.errors,t.errors),r.errors.wrap=Object.assign({},e.errors.wrap,t.errors.wrap)),t.messages&&(r.messages=a.compile(t.messages,e.messages)),delete r[s.symbols.prefs],r},s.tryWithPath=function(e,t,r={}){try{return e()}catch(e){throw void 0!==e.path?e.path=t+"."+e.path:e.path=t,r.append&&(e.message="".concat(e.message," (").concat(e.path,")")),e}},s.validateArg=function(e,t,{assert:r,message:i}){if(s.isSchema(r)){const s=r.validate(e);return s.error?s.error.message:void 0}if(!r(e))return t?"".concat(t," ").concat(i):i},s.verifyFlat=function(e,t){for(const r of e)n(!Array.isArray(r),"Method no longer accepts array arguments:",t)}},3292:(e,a,t)=>{"use strict";const o=t(375),c=t(8160),l=t(6133),u={};a.schema=function(e,t,r={}){c.assertOptions(r,["appendPath","override"]);try{return u.schema(e,t,r)}catch(e){throw r.appendPath&&void 0!==e.path&&(e.message="".concat(e.message," (").concat(e.path,")")),e}},u.schema=function(r,e,i){o(void 0!==e,"Invalid undefined schema"),Array.isArray(e)&&(o(e.length,"Invalid empty array schema"),1===e.length)&&(e=e[0]);var t=(e,...t)=>!1!==i.override?e.valid(r.override,...t):e.valid(...t);if(u.simple(e))return t(r,e);if("function"==typeof e)return r.custom(e);if(o("object"==typeof e,"Invalid schema content:",typeof e),c.isResolvable(e))return t(r,e);if(c.isSchema(e))return e;if(Array.isArray(e)){for(const i of e)if(!u.simple(i))return r.alternatives().try(...e);return t(r,...e)}return e instanceof RegExp?r.string().regex(e):e instanceof Date?t(r.date(),e):(o(Object.getPrototypeOf(e)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),r.object().keys(e))},a.ref=function(e,t){return l.isRef(e)?e:l.create(e,t)},a.compile=function(e,t,r={}){c.assertOptions(r,["legacy"]);var i=t&&t[c.symbols.any];return i?(o(r.legacy||i.version===c.version,"Cannot mix different versions of joi schemas:",i.version,c.version),t):"object"==typeof t&&r.legacy&&(i=u.walk(t))?i.compile(i.root,t):a.schema(e,t,{appendPath:!0})},u.walk=function(e){if("object"==typeof e)if(Array.isArray(e))for(const r of e){const e=u.walk(r);if(e)return e}else{const r=e[c.symbols.any];if(r)return{root:e[r.root],compile:r.compile};o(Object.getPrototypeOf(e)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(const r in e){var t=u.walk(e[r]);if(t)return t}}return null},u.simple=function(e){return null===e||["boolean","string","number"].includes(typeof e)},a.when=function(r,i,s){if(void 0===s&&(o(i&&"object"==typeof i,"Missing options"),s=i,i=l.create(".")),Array.isArray(s)&&(s={switch:s}),c.assertOptions(s,["is","not","then","otherwise","switch","break"]),c.isSchema(i))return o(void 0===s.is,'"is" can not be used with a schema condition'),o(void 0===s.not,'"not" can not be used with a schema condition'),o(void 0===s.switch,'"switch" can not be used with a schema condition'),u.condition(r,{is:i,then:s.then,otherwise:s.otherwise,break:s.break});if(o(l.isRef(i)||"string"==typeof i,"Invalid condition:",i),o(void 0===s.not||void 0===s.is,'Cannot combine "is" with "not"'),void 0===s.switch){let e=s,t=void 0!==(e=void 0!==s.not?{is:s.not,then:s.otherwise,otherwise:s.then,break:s.break}:e).is?r.$_compile(e.is):r.$_root.invalid(null,!1,0,"").required();return o(void 0!==e.then||void 0!==e.otherwise,'options must have at least one of "then", "otherwise", or "switch"'),o(void 0===e.break||void 0===e.then||void 0===e.otherwise,"Cannot specify then, otherwise, and break all together"),void 0===s.is||l.isRef(s.is)||c.isSchema(s.is)||(t=t.required()),u.condition(r,{ref:a.ref(i),is:t,then:e.then,otherwise:e.otherwise,break:e.break})}o(Array.isArray(s.switch),'"switch" must be an array'),o(void 0===s.is,'Cannot combine "switch" with "is"'),o(void 0===s.not,'Cannot combine "switch" with "not"'),o(void 0===s.then,'Cannot combine "switch" with "then"');var t={ref:a.ref(i),switch:[],break:s.break};for(let e=0;e<s.switch.length;++e){const i=s.switch[e],u=e===s.switch.length-1;c.assertOptions(i,u?["is","then","otherwise"]:["is","then"]),o(void 0!==i.is,'Switch statement missing "is"'),o(void 0!==i.then,'Switch statement missing "then"');var n={is:r.$_compile(i.is),then:r.$_compile(i.then)};if(l.isRef(i.is)||c.isSchema(i.is)||(n.is=n.is.required()),u){o(void 0===s.otherwise||void 0===i.otherwise,'Cannot specify "otherwise" inside and outside a "switch"');const a=(void 0!==s.otherwise?s:i).otherwise;void 0!==a&&(o(void 0===t.break,"Cannot specify both otherwise and break"),n.otherwise=r.$_compile(a))}t.switch.push(n)}return t},u.condition=function(e,t){for(const r of["then","otherwise"])void 0===t[r]?delete t[r]:t[r]=e.$_compile(t[r]);return t}},6354:(e,o,t)=>{"use strict";const r=t(5688),a=t(8160),c=t(3328);o.Report=class{constructor(e,t,r,i,s,n,a){if(this.code=e,this.flags=i,this.messages=s,this.path=n.path,this.prefs=a,this.state=n,this.value=t,this.message=null,this.template=null,this.local=r||{},this.local.label=o.label(this.flags,this.state,this.prefs,this.messages),void 0===this.value||this.local.hasOwnProperty("value")||(this.local.value=this.value),this.path.length){const e=this.path[this.path.length-1];"object"!=typeof e&&(this.local.key=e)}}_setTemplate(e){if(this.template=e,!this.flags.label&&0===this.path.length){const e=this._template(this.template,"root");e&&(this.local.label=e)}}toString(){var e,t;return this.message||(e=this.code,this.prefs.errors.render?void 0===(t=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages))?'Error code "'.concat(e,'" is not defined, your custom type is missing the correct messages definition'):(this.message=t.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message):this.code)}_template(e,t){return o.template(this.value,e,t||this.code,this.state,this.prefs)}},o.path=function(e){let t="";for(const r of e)"object"!=typeof r&&("string"==typeof r?(t&&(t+="."),t+=r):t+="[".concat(r,"]"));return t},o.template=function(t,r,i,s,n){if(r){if(c.isTemplate(r))return"root"!==i?r:null;let e=n.errors.language;if((e=a.isResolvable(e)?e.resolve(t,s,n):e)&&r[e]){if(void 0!==r[e][i])return r[e][i];if(void 0!==r[e]["*"])return r[e]["*"]}return r[i]||r["*"]}},o.label=function(e,t,r,i){if(e.label)return e.label;if(!r.errors.label)return"";let s=t.path;return"key"===r.errors.label&&1<t.path.length&&(s=t.path.slice(-1)),o.path(s)||o.template(null,r.messages,"root",t,r)||i&&o.template(null,i,"root",t,r)||"value"},o.process=function(e,t,r){var i,s;return e?({override:e,message:i,details:s}=o.details(e),e||(r.errors.stack?new o.ValidationError(i,s,t):(e=Error.stackTraceLimit,Error.stackTraceLimit=0,r=new o.ValidationError(i,s,t),Error.stackTraceLimit=e,r))):null},o.details=function(e,t={}){let r=[];var i=[];for(const s of e)if(s instanceof Error){if(!1!==t.override)return{override:s};const e=s.toString();r.push(e),i.push({message:e,type:"override",context:{error:s}})}else{const e=s.toString();r.push(e),i.push({message:e,path:s.path.filter(e=>"object"!=typeof e),type:s.code,context:s.local})}return{message:(r=1<r.length?[...new Set(r)]:r).join(". "),details:i}},o.ValidationError=class extends Error{constructor(e,t,r){super(e),this._original=r,this.details=t}static isError(e){return e instanceof o.ValidationError}},o.ValidationError.prototype.isJoi=!0,o.ValidationError.prototype.name="ValidationError",o.ValidationError.prototype.annotate=r.error},8901:(e,t,r)=>{"use strict";const l=r(375),u=r(8571),d=r(8160),h=r(6914),p={};t.type=function(t,r){const i=Object.getPrototypeOf(t),s=u(i),e=t._assign(Object.create(s)),n=Object.assign({},r);delete n.base,s._definition=n;var t=i._definition||{},a=(n.messages=h.merge(t.messages,n.messages),n.properties=Object.assign({},t.properties,n.properties),e.type=n.type,n.flags=Object.assign({},t.flags,n.flags),Object.assign({},t.terms));if(n.terms)for(const t in n.terms){const r=n.terms[t];l(void 0===e.$_terms[t],"Invalid term override for",n.type,t),e.$_terms[t]=r.init,a[t]=r}n.terms=a,n.args||(n.args=t.args),n.prepare=p.prepare(n.prepare,t.prepare),n.coerce&&("function"==typeof n.coerce&&(n.coerce={method:n.coerce}),n.coerce.from)&&!Array.isArray(n.coerce.from)&&(n.coerce={method:n.coerce.method,from:[].concat(n.coerce.from)}),n.coerce=p.coerce(n.coerce,t.coerce),n.validate=p.validate(n.validate,t.validate);var o=Object.assign({},t.rules);if(n.rules)for(const t in n.rules){const r=n.rules[t];l("object"==typeof r,"Invalid rule definition for",n.type,t);let e=r.method;if((e=void 0===e?function(){return this.$_addRule(t)}:e)&&(l(!s[t],"Rule conflict in",n.type,t),s[t]=e),l(!o[t],"Rule conflict in",n.type,t),(o[t]=r).alias){const t=[].concat(r.alias);for(const i of t)s[i]=r.method}r.args&&(r.argsByName=new Map,r.args=r.args.map(e=>("string"==typeof e&&(e={name:e}),l(!r.argsByName.has(e.name),"Duplicated argument name",e.name),d.isSchema(e.assert)&&(e.assert=e.assert.strict().label(e.name)),r.argsByName.set(e.name,e),e)))}n.rules=o;var c=Object.assign({},t.modifiers);if(n.modifiers)for(const t in n.modifiers){l(!s[t],"Rule conflict in",n.type,t);const r=n.modifiers[t],i=(l("function"==typeof r,"Invalid modifier definition for",n.type,t),function(e){return this.rule({[t]:e})});s[t]=i,c[t]=r}if(n.modifiers=c,n.overrides){s._super=i,e.$_super={};for(const t in n.overrides)l(i[t],"Cannot override missing",t),n.overrides[t][d.symbols.parent]=i[t],e.$_super[t]=i[t].bind(e);Object.assign(s,n.overrides)}n.cast=Object.assign({},t.cast,n.cast);r=Object.assign({},t.manifest,n.manifest);return r.build=p.build(n.manifest&&n.manifest.build,t.manifest&&t.manifest.build),n.manifest=r,n.rebuild=p.rebuild(n.rebuild,t.rebuild),e},p.build=function(r,i){return r&&i?function(e,t){return i(r(e,t),t)}:r||i},p.coerce=function(i,s){return i&&s?{from:i.from&&s.from?[...new Set([...i.from,...s.from])]:null,method(e,t){let r;if((!s.from||s.from.includes(typeof e))&&(r=s.method(e,t))){if(r.errors||void 0===r.value)return r;e=r.value}if(!i.from||i.from.includes(typeof e)){const s=i.method(e,t);if(s)return s}return r}}:i||s},p.prepare=function(i,s){return i&&s?function(e,t){var r=i(e,t);if(r){if(r.errors||void 0===r.value)return r;e=r.value}return s(e,t)||r}:i||s},p.rebuild=function(t,r){return t&&r?function(e){r(e),t(e)}:t||r},p.validate=function(i,s){return i&&s?function(e,t){var r=s(e,t);if(r){if(r.errors&&(!Array.isArray(r.errors)||r.errors.length))return r;e=r.value}return i(e,t)||r}:i||s}},5107:(e,t,s)=>{"use strict";const n=s(375),a=s(8571),r=s(8652),o=s(8160),i=s(3292),c=s(6354),l=s(8901),u=s(9708),d=s(6133),h=s(3328),p=s(1152);let f;const g={types:{alternatives:s(4946),any:s(8068),array:s(546),boolean:s(4937),date:s(7500),function:s(390),link:s(8785),number:s(3832),object:s(8966),string:s(7417),symbol:s(8826)},aliases:{alt:"alternatives",bool:"boolean",func:"function"},root:function(){var e={_types:new Set(Object.keys(g.types))};for(const r of e._types)e[r]=function(...e){return n(!e.length||["alternatives","link","object"].includes(r),"The",r,"type does not allow arguments"),g.generate(this,g.types[r],e)};for(const i of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])e[i]=function(...e){return this.any()[i](...e)};Object.assign(e,g.methods);for(const s in g.aliases){var t=g.aliases[s];e[s]=e[t]}return e.x=e.expression,p.setup&&p.setup(e),e}};g.methods={ValidationError:c.ValidationError,version:o.version,cache:r.provider,assert(e,t,...r){g.assert(e,t,!0,r)},attempt:(e,t,...r)=>g.assert(e,t,!1,r),build(e){return n("function"==typeof u.build,"Manifest functionality disabled"),u.build(this,e)},checkPreferences(e){o.checkPreferences(e)},compile(e,t){return i.compile(this,e,t)},defaults(e){n("function"==typeof e,"modifier must be a function");var t=Object.assign({},this);for(const r of t._types){const i=e(t[r]());n(o.isSchema(i),"modifier must return a valid schema object"),t[r]=function(...e){return g.generate(this,i,e)}}return t},expression:(...e)=>new h(...e),extend(...e){o.verifyFlat(e,"extend"),f=f||s(3378),n(e.length,"You need to provide at least one extension"),this.assert(e,f.extensions);var t,r=Object.assign({},this);r._types=new Set(r._types);for(t of e){"function"==typeof t&&(t=t(r)),this.assert(t,f.extension);const e=g.expandExtension(t,r);for(const s of e){n(void 0===r[s.type]||r._types.has(s.type),"Cannot override name",s.type);const e=s.base||this.any(),i=l.type(e,s);r._types.add(s.type),r[s.type]=function(...e){return g.generate(this,i,e)}}}return r},isError:c.ValidationError.isError,isExpression:h.isTemplate,isRef:d.isRef,isSchema:o.isSchema,in:(...e)=>d.in(...e),override:o.symbols.override,ref:(...e)=>d.create(...e),types(){var e={};for(const t of this._types)e[t]=this[t]();for(const r in g.aliases)e[r]=this[r]();return e}},g.assert=function(e,t,r,i){var s=i[0]instanceof Error||"string"==typeof i[0]?i[0]:null,i=s?i[1]:i[0],t=t.validate(e,o.preferences({errors:{stack:!0}},i||{}));let n=t.error;if(!n)return t.value;if(s instanceof Error)throw s;e=r&&"function"==typeof n.annotate?n.annotate():n.message;throw(n=n instanceof c.ValidationError==0?a(n):n).message=s?"".concat(s," ").concat(e):e,n},g.generate=function(e,t,r){return n(e,"Must be invoked on a Joi instance."),t.$_root=e,t._definition.args&&r.length?t._definition.args(t,...r):t},g.expandExtension=function(e,t){if("string"==typeof e.type)return[e];var r,i=[];for(const s of t._types)e.type.test(s)&&((r=Object.assign({},e)).type=s,r.base=t[s](),i.push(r));return i},e.exports=g.root()},6914:(e,s,t)=>{"use strict";const n=t(375),a=t(8571),o=t(3328);s.compile=function(e,t){if("string"==typeof e)return n(!t,"Cannot set single message string"),new o(e);if(o.isTemplate(e))return n(!t,"Cannot set single message template"),e;for(var r in n("object"==typeof e&&!Array.isArray(e),"Invalid message options"),t=t?a(t):{},e){const a=e[r];if("root"===r||o.isTemplate(a))t[r]=a;else if("string"==typeof a)t[r]=new o(a);else{n("object"==typeof a&&!Array.isArray(a),"Invalid message for",r);var i=r;for(r in t[i]=t[i]||{},a){const e=a[r];"root"===r||o.isTemplate(e)?t[i][r]=e:(n("string"==typeof e,"Invalid message for",r,"in",i),t[i][r]=new o(e))}}}return t},s.decompile=function(e){var t,r={};for(t in e){var i=e[t];if("root"===t)r.root=i;else if(o.isTemplate(i))r[t]=i.describe({compact:!0});else{var s=t;for(t in r[s]={},i){const e=i[t];"root"!==t?r[s][t]=e.describe({compact:!0}):r[s].root=e}}}return r},s.merge=function(e,t){if(!e)return s.compile(t);if(!t)return e;if("string"==typeof t)return new o(t);if(o.isTemplate(t))return t;var r,i=a(e);for(r in t){const s=t[r];if("root"===r||o.isTemplate(s))i[r]=s;else if("string"==typeof s)i[r]=new o(s);else{n("object"==typeof s&&!Array.isArray(s),"Invalid message for",r);const a=r;for(r in i[a]=i[a]||{},s){const t=s[r];"root"===r||o.isTemplate(t)?i[a][r]=t:(n("string"==typeof t,"Invalid message for",r,"in",a),i[a][r]=new o(t))}}}return i}},2294:(e,s,t)=>{"use strict";function r(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function o(i){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?r(Object(s),!0).forEach(function(e){var t,r;t=i,r=s[e=e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(s,e))})}return i}const n=t(375),c=t(8160),l=t(6133),u={};s.Ids=u.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){var e=new u.Ids;return e._byId=new Map(this._byId),e._byKey=new Map(this._byKey),e._schemaChain=this._schemaChain,e}concat(e){e._schemaChain&&(this._schemaChain=!0);for(var[t,r]of e._byId.entries())n(!this._byKey.has(t),"Schema id conflicts with existing key:",t),this._byId.set(t,r);for(var[i,s]of e._byKey.entries())n(!this._byId.has(i),"Schema key conflicts with existing id:",i),this._byKey.set(i,s)}fork(e,t,r){var i=this._collect(e),e=(i.push({schema:r}),i.shift());let s={id:e.id,schema:t(e.schema)};n(c.isSchema(s.schema),"adjuster function failed to return a joi schema type");for(const e of i)s={id:e.id,schema:u.fork(e.schema,s.id,s.schema)};return s.schema}labels(e,t=[]){var r,i=e[0],s=this._get(i);return s?(r=e.slice(1),t=[...t,s.schema._flags.label||i],r.length?s.schema._ids.labels(r,t):t.join(".")):[...t,...e].join(".")}reach(e,t=[]){var r=e[0],i=this._get(r),e=(n(i,"Schema does not contain path",[...t,...e].join(".")),e.slice(1));return e.length?i.schema._ids.reach(e,[...t,r]):i.schema}register(e,{key:t}={}){if(e&&c.isSchema(e)){(e.$_property("schemaChain")||e._ids._schemaChain)&&(this._schemaChain=!0);var r=e._flags.id;if(r){const t=this._byId.get(r);n(!t||t.schema===e,"Cannot add different schemas with the same id:",r),n(!this._byKey.has(r),"Schema id conflicts with existing key:",r),this._byId.set(r,{schema:e,id:r})}t&&(n(!this._byKey.has(t),"Schema already contains key:",t),n(!this._byId.has(t),"Schema key conflicts with existing id:",t),this._byKey.set(t,{schema:e,id:t}))}}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(e,t=[],r=[]){var i=e[0],s=this._get(i),e=(n(s,"Schema does not contain path",[...t,...e].join(".")),r=[s,...r],e.slice(1));return e.length?s.schema._ids._collect(e,[...t,i],r):r}_get(e){return this._byId.get(e)||this._byKey.get(e)}},u.fork=function(e,r,i){var t=s.schema(e,{each:(e,{key:t})=>{if(r===(e._flags.id||t))return i},ref:!1});return t?t.$_mutateRebuild():e},s.schema=function(t,r){let i;for(const o in t._flags){var e;"_"!==o[0]&&void 0!==(e=u.scan(t._flags[o],{source:"flags",name:o},r))&&((i=i||t.clone())._flags[o]=e)}for(let e=0;e<t._rules.length;++e){var s=t._rules[e],n=u.scan(s.args,{source:"rules",name:s.name},r);if(void 0!==n){i=i||t.clone();const r=Object.assign({},s);r.args=n,i._rules[e]=r,i._singleRules.get(s.name)===s&&i._singleRules.set(s.name,r)}}for(const c in t.$_terms){var a;"_"!==c[0]&&void 0!==(a=u.scan(t.$_terms[c],{source:"terms",name:c},r))&&((i=i||t.clone()).$_terms[c]=a)}return i},u.scan=function(r,i,s,e,n){var a=e||[];if(null!==r&&"object"==typeof r){let t;if(Array.isArray(r))for(let e=0;e<r.length;++e){const o="terms"===i.source&&"keys"===i.name&&r[e].key,n=u.scan(r[e],i,s,[e,...a],o);void 0!==n&&((t=t||r.slice())[e]=n)}else{if(!1!==s.schema&&c.isSchema(r)||!1!==s.ref&&l.isRef(r)){const e=s.each(r,o(o({},i),{},{path:a,key:n}));return e===r?void 0:e}for(const e in r)if("_"!==e[0]){const o=u.scan(r[e],i,s,[e,...a],n);void 0!==o&&((t=t||Object.assign({},r))[e]=o)}}return t}}},6133:(e,r,i)=>{"use strict";function t(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function s(i){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?t(Object(s),!0).forEach(function(e){var t,r;t=i,r=s[e=e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(s)):t(Object(s)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(s,e))})}return i}const n=i(375),a=i(8571),o=i(9621),c=i(8160);let l;const u={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};r.create=function(e,t={}){n("string"==typeof e,"Invalid reference key:",e),c.assertOptions(t,["adjust","ancestor","in","iterables","map","prefix","render","separator"]),n(!t.prefix||"object"==typeof t.prefix,"options.prefix must be of type object");var r=Object.assign({},u.defaults,t);delete r.prefix;const i=r.separator,s=u.context(e,i,t.prefix);if(r.type=s.type,e=s.key,"value"===r.type)if(s.root&&(n(!i||e[0]!==i,"Cannot specify relative path with root prefix"),r.ancestor="root",e=e||null),i&&i===e)e=null,r.ancestor=0;else if(void 0!==r.ancestor)n(!i||!e||e[0]!==i,"Cannot combine prefix with ancestor option");else{const[t,s]=u.ancestor(e,i);s&&""===(e=e.slice(s))&&(e=null),r.ancestor=t}return r.path=i?null===e?[]:e.split(i):[e],new u.Ref(r)},r.in=function(e,t={}){return r.create(e,s(s({},t),{},{in:!0}))},r.isRef=function(e){return!!e&&!!e[c.symbols.ref]},u.Ref=class{constructor(e){n("object"==typeof e,"Invalid reference construction"),c.assertOptions(e,["adjust","ancestor","in","iterables","map","path","render","separator","type","depth","key","root","display"]),n([!1,void 0].includes(e.separator)||"string"==typeof e.separator&&1===e.separator.length,"Invalid separator"),n(!e.adjust||"function"==typeof e.adjust,"options.adjust must be a function"),n(!e.map||Array.isArray(e.map),"options.map must be an array"),n(!e.map||!e.adjust,"Cannot set both map and adjust options"),Object.assign(this,u.defaults,e),n("value"===this.type||void 0===this.ancestor,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(e,t,r,i,s={}){return n(!this.in||s.in,"Invalid in() reference usage"),"global"===this.type?this._resolve(r.context,t,s):"local"===this.type?this._resolve(i,t,s):this.ancestor?"root"===this.ancestor?this._resolve(t.ancestors[t.ancestors.length-1],t,s):(n(this.ancestor<=t.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(t.ancestors[this.ancestor-1],t,s)):this._resolve(e,t,s)}_resolve(e,t,r){let i;if(void 0===(i="value"===this.type&&t.mainstay.shadow&&!1!==r.shadow?t.mainstay.shadow.get(this.absolute(t)):i)&&(i=o(e,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(i=this.adjust(i)),this.map){const e=this.map.get(i);void 0!==e&&(i=e)}return t.mainstay&&t.mainstay.tracer.resolve(t,this,i),i}toString(){return this.display}absolute(e){return[...e.path.slice(0,-this.ancestor),...this.path]}clone(){return new u.Ref(this)}describe(){var e={path:this.path};"value"!==this.type&&(e.type=this.type),"."!==this.separator&&(e.separator=this.separator),"value"===this.type&&1!==this.ancestor&&(e.ancestor=this.ancestor),this.map&&(e.map=[...this.map]);for(const t of["adjust","iterables","render"])null!==this[t]&&void 0!==this[t]&&(e[t]=this[t]);return!1!==this.in&&(e.in=!0),{ref:e}}updateDisplay(){var e,t=null!==this.key?this.key:"";"value"!==this.type?this.display="ref:".concat(this.type,":").concat(t):this.separator?this.ancestor?"root"===this.ancestor?this.display="ref:root:".concat(t):1===this.ancestor?this.display="ref:".concat(t||".."):(e=new Array(this.ancestor+1).fill(this.separator).join(""),this.display="ref:".concat(e).concat(t||"")):this.display="ref:".concat(this.separator).concat(t):this.display="ref:".concat(t)}},u.Ref.prototype[c.symbols.ref]=!0,r.build=function(e){return"value"===(e=Object.assign({},u.defaults,e)).type&&void 0===e.ancestor&&(e.ancestor=1),new u.Ref(e)},u.context=function(e,t,r={}){if(e=e.trim(),r){var i=void 0===r.global?"$":r.global;if(i!==t&&e.startsWith(i))return{key:e.slice(i.length),type:"global"};i=void 0===r.local?"#":r.local;if(i!==t&&e.startsWith(i))return{key:e.slice(i.length),type:"local"};i=void 0===r.root?"/":r.root;if(i!==t&&e.startsWith(i))return{key:e.slice(i.length),type:"value",root:!0}}return{key:e,type:"value"}},u.ancestor=function(e,t){if(!t)return[1,0];if(e[0]!==t)return[1,0];if(e[1]!==t)return[0,1];let r=2;for(;e[r]===t;)++r;return[r-1,r]},r.toSibling=0,r.toParent=1,r.Manager=class{constructor(){this.refs=[]}register(e,t){if(e)if(t=void 0===t?r.toParent:t,Array.isArray(e))for(const r of e)this.register(r,t);else if(c.isSchema(e))for(const r of e._refs.refs)0<=r.ancestor-t&&this.refs.push({ancestor:r.ancestor-t,root:r.root});else r.isRef(e)&&"value"===e.type&&0<=e.ancestor-t&&this.refs.push({ancestor:e.ancestor-t,root:e.root}),(l=l||i(3328)).isTemplate(e)&&this.register(e.refs(),t)}get length(){return this.refs.length}clone(){var e=new r.Manager;return e.refs=a(this.refs),e}reset(){this.refs=[]}roots(){return this.refs.filter(e=>!e.ancestor).map(e=>e.root)}}},3378:(e,t,r)=>{"use strict";var r=r(5107),i={};i.wrap=r.string().min(1).max(2).allow(!1),t.preferences=r.object({allowUnknown:r.boolean(),abortEarly:r.boolean(),artifacts:r.boolean(),cache:r.boolean(),context:r.object(),convert:r.boolean(),dateFormat:r.valid("date","iso","string","time","utc"),debug:r.boolean(),errors:{escapeHtml:r.boolean(),label:r.valid("path","key",!1),language:[r.string(),r.object().ref()],render:r.boolean(),stack:r.boolean(),wrap:{label:i.wrap,array:i.wrap,string:i.wrap}},externals:r.boolean(),messages:r.object(),noDefaults:r.boolean(),nonEnumerables:r.boolean(),presence:r.valid("required","optional","forbidden"),skipFunctions:r.boolean(),stripUnknown:r.object({arrays:r.boolean(),objects:r.boolean()}).or("arrays","objects").allow(!0,!1),warnings:r.boolean()}).strict(),i.nameRx=/^[a-zA-Z0-9]\w*$/,i.rule=r.object({alias:r.array().items(r.string().pattern(i.nameRx)).single(),args:r.array().items(r.string(),r.object({name:r.string().pattern(i.nameRx).required(),ref:r.boolean(),assert:r.alternatives([r.function(),r.object().schema()]).conditional("ref",{is:!0,then:r.required()}),normalize:r.function(),message:r.string().when("assert",{is:r.function(),then:r.required()})})),convert:r.boolean(),manifest:r.boolean(),method:r.function().allow(!1),multi:r.boolean(),validate:r.function()}),t.extension=r.object({type:r.alternatives([r.string(),r.object().regex()]).required(),args:r.function(),cast:r.object().pattern(i.nameRx,r.object({from:r.function().maxArity(1).required(),to:r.function().minArity(1).maxArity(2).required()})),base:r.object().schema().when("type",{is:r.object().regex(),then:r.forbidden()}),coerce:[r.function().maxArity(3),r.object({method:r.function().maxArity(3).required(),from:r.array().items(r.string()).single()})],flags:r.object().pattern(i.nameRx,r.object({setter:r.string(),default:r.any()})),manifest:{build:r.function().arity(2)},messages:[r.object(),r.string()],modifiers:r.object().pattern(i.nameRx,r.function().minArity(1).maxArity(2)),overrides:r.object().pattern(i.nameRx,r.function()),prepare:r.function().maxArity(3),rebuild:r.function().arity(1),rules:r.object().pattern(i.nameRx,i.rule),terms:r.object().pattern(i.nameRx,r.object({init:r.array().allow(null).required(),manifest:r.object().pattern(/.+/,[r.valid("schema","single"),r.object({mapped:r.object({from:r.string().required(),to:r.string().required()}).required()})])})),validate:r.function().maxArity(3)}).strict(),t.extensions=r.array().items(r.object(),r.function().arity(1)).strict(),i.desc={buffer:r.object({buffer:r.string()}),func:r.object({function:r.function().required(),options:{literal:!0}}),override:r.object({override:!0}),ref:r.object({ref:r.object({type:r.valid("value","global","local"),path:r.array().required(),separator:r.string().length(1).allow(!1),ancestor:r.number().min(0).integer().allow("root"),map:r.array().items(r.array().length(2)).min(1),adjust:r.function(),iterables:r.boolean(),in:r.boolean(),render:r.boolean()}).required()}),regex:r.object({regex:r.string().min(3)}),special:r.object({special:r.valid("deep").required()}),template:r.object({template:r.string().required(),options:r.object()}),value:r.object({value:r.alternatives([r.object(),r.array()]).required()})},i.desc.entity=r.alternatives([r.array().items(r.link("...")),r.boolean(),r.function(),r.number(),r.string(),i.desc.buffer,i.desc.func,i.desc.ref,i.desc.regex,i.desc.special,i.desc.template,i.desc.value,r.link("/")]),i.desc.values=r.array().items(null,r.boolean(),r.function(),r.number().allow(1/0,-1/0),r.string().allow(""),r.symbol(),i.desc.buffer,i.desc.func,i.desc.override,i.desc.ref,i.desc.regex,i.desc.template,i.desc.value),i.desc.messages=r.object().pattern(/.+/,[r.string(),i.desc.template,r.object().pattern(/.+/,[r.string(),i.desc.template])]),t.description=r.object({type:r.string().required(),flags:r.object({cast:r.string(),default:r.any(),description:r.string(),empty:r.link("/"),failover:i.desc.entity,id:r.string(),label:r.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:r.boolean(),unit:r.string()}).unknown(),preferences:{allowUnknown:r.boolean(),abortEarly:r.boolean(),artifacts:r.boolean(),cache:r.boolean(),convert:r.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:r.boolean(),label:["path","key"],language:[r.string(),i.desc.ref],wrap:{label:i.wrap,array:i.wrap}},externals:r.boolean(),messages:i.desc.messages,noDefaults:r.boolean(),nonEnumerables:r.boolean(),presence:["required","optional","forbidden"],skipFunctions:r.boolean(),stripUnknown:r.object({arrays:r.boolean(),objects:r.boolean()}).or("arrays","objects").allow(!0,!1),warnings:r.boolean()},allow:i.desc.values,invalid:i.desc.values,rules:r.array().min(1).items({name:r.string().required(),args:r.object().min(1),keep:r.boolean(),message:[r.string(),i.desc.messages],warn:r.boolean()}),keys:r.object().pattern(/.*/,r.link("/")),link:i.desc.ref}).pattern(/^[a-z]\w*$/,r.any())},493:(e,t,r)=>{"use strict";const i=r(8571),s=r(9621),n=r(8160),a={value:Symbol("value")};e.exports=a.State=class{constructor(e,t,r){this.path=e,this.ancestors=t,this.mainstay=r.mainstay,this.schemas=r.schemas,this.debug=null}localize(e,t=null,r=null){e=new a.State(e,t,this);return r&&e.schemas&&(e.schemas=[a.schemas(r),...e.schemas]),e}nest(e,t){var r=new a.State(this.path,this.ancestors,this);return r.schemas=r.schemas&&[a.schemas(e),...r.schemas],r.debug=t,r}shadow(e,t){this.mainstay.shadow=this.mainstay.shadow||new a.Shadow,this.mainstay.shadow.set(this.path,e,t)}snapshot(){this.mainstay.shadow&&(this._snapshot=i(this.mainstay.shadow.node(this.path)))}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0)}},a.schemas=function(e){return n.isSchema(e)?{schema:e}:e},a.Shadow=class{constructor(){this._values=null}set(i,e,s){if(i.length&&("strip"!==s||"number"!=typeof i[i.length-1])){this._values=this._values||new Map;let r=this._values;for(let t=0;t<i.length;++t){const s=i[t];let e=r.get(s);e||(e=new Map,r.set(s,e)),r=e}r[a.value]=e}}get(e){e=this.node(e);if(e)return e[a.value]}node(e){if(this._values)return s(this._values,e,{iterables:!0})}override(e,t){var r;this._values&&(r=e.slice(0,-1),e=e[e.length-1],r=s(this._values,r,{iterables:!0}),t?r.set(e,t):r&&r.delete(e))}}},3328:(e,t,r)=>{"use strict";function n(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function u(i){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?n(Object(s),!0).forEach(function(e){var t,r;t=i,r=s[e=e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(s,e))})}return i}const i=r(375),s=r(8571),c=r(5277),a=r(1447),o=r(8160),l=r(6354),d=r(6133),h={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};e.exports=h.Template=class{constructor(e,t){i("string"==typeof e,"Template source must be a string"),i(!e.includes("\0")&&!e.includes(""),"Template source cannot contain reserved control characters"),this.source=e,this.rendered=e,this._template=null,this._settings=s(t),this._parse()}_parse(){if(this.source.includes("{")){const i=h.encode(this.source),s=h.split(i);let t=!1;const n=[],a=s.shift();a&&n.push(a);for(const i of s){const s="{"!==i[0],a=s?"}":"}}",o=i.indexOf(a);if(-1===o||"{"===i[1])n.push("{".concat(h.decode(i)));else{let e=i.slice(s?0:1,o);var r=":"===e[0],r=(r&&(e=e.slice(1)),this._ref(h.decode(e),{raw:s,wrapped:r})),r=(n.push(r),"string"!=typeof r&&(t=!0),i.slice(o+a.length));r&&n.push(h.decode(r))}}t?this._template=n:this.rendered=n.join("")}}static date(e,t){return h.dateFormat[t.dateFormat].call(e)}describe(e={}){return!this._settings&&e.compact?this.source:(e={template:this.source},this._settings&&(e.options=this._settings),e)}static build(e){return new h.Template(e.template,e.options)}isDynamic(){return!!this._template}static isTemplate(e){return!!e&&!!e[o.symbols.template]}refs(){if(this._template){var e=[];for(const t of this._template)"string"!=typeof t&&e.push(...t.refs);return e}}resolve(e,t,r,i){return this._template&&1===this._template.length?this._part(this._template[0],e,t,r,i,{}):this.render(e,t,r,i)}_part(e,...t){return e.ref?e.ref.resolve(...t):e.formula.evaluate(t)}render(e,t,r,i,s={}){if(!this.isDynamic())return this.rendered;var n=[];for(const o of this._template)if("string"==typeof o)n.push(o);else{var a=this._part(o,e,t,r,i,s),a=h.stringify(a,e,t,r,i,s);if(void 0!==a){const e=o.raw||!1===(s.errors&&s.errors.escapeHtml)?a:c(a);n.push(h.wrap(e,o.wrapped&&r.errors.wrap.label))}}return n.join("")}_ref(e,{raw:t,wrapped:r}){const i=[],s=e=>{const t=d.create(e,this._settings);return i.push(t),e=>t.resolve(...e)};try{var n=new a.Parser(e,{reference:s,functions:h.functions,constants:h.constants})}catch(t){throw t.message='Invalid template variable "'.concat(e,'" fails due to: ').concat(t.message),t}if(n.single){if("reference"!==n.single.type)return h.stringify(n.single.value);{const e=i[0];return{ref:e,raw:t,refs:i,wrapped:r||"local"===e.type&&"label"===e.key}}}return{formula:n,raw:t,refs:i}}toString(){return this.source}},h.Template.prototype[o.symbols.template]=!0,h.Template.prototype.isImmutable=!0,h.encode=function(e){return e.replace(/\\(\{+)/g,(e,t)=>h.opens.slice(0,t.length)).replace(/\\(\}+)/g,(e,t)=>h.closes.slice(0,t.length))},h.decode=function(e){return e.replace(/\u0000/g,"{").replace(/\u0001/g,"}")},h.split=function(r){var i=[];let s="";for(let t=0;t<r.length;++t){var e=r[t];if("{"===e){let e="";for(;t+1<r.length&&"{"===r[t+1];)e+="{",++t;i.push(s),s=e}else s+=e}return i.push(s),i},h.wrap=function(e,t){return t?1===t.length?"".concat(t).concat(e).concat(t):"".concat(t[0]).concat(e).concat(t[1]):e},h.stringify=function(e,t,r,i,s,n={}){const a=typeof e,o=i&&i.errors&&i.errors.wrap||{};let c=!1;if(d.isRef(e)&&e.render&&(c=e.in,e=e.resolve(t,r,i,s,u({in:e.in},n))),null===e)return"null";if("string"===a)return h.wrap(e,n.arrayItems&&o.string);if("number"===a||"function"===a||"symbol"===a)return e.toString();if("object"!==a)return JSON.stringify(e);if(e instanceof Date)return h.Template.date(e,i);if(e instanceof Map){const t=[];for(const[r,i]of e.entries())t.push("".concat(r.toString()," -> ").concat(i.toString()));e=t}if(!Array.isArray(e))return e.toString();var l=[];for(const a of e)l.push(h.stringify(a,t,r,i,s,u({arrayItems:!0},n)));return h.wrap(l.join(", "),!c&&o.array)},h.constants={true:!0,false:!1,null:null,second:1e3,minute:6e4,hour:36e5,day:864e5},h.functions={if:(e,t,r)=>e?t:r,msg(e){var[t,r,i,s,n]=this,a=n.messages;return(a=a&&(l.template(t,a[0],e,r,i)||l.template(t,a[1],e,r,i)))?a.render(t,r,i,s,n):""},number:e=>"number"==typeof e?e:"string"==typeof e?parseFloat(e):"boolean"==typeof e?e?1:0:e instanceof Date?e.getTime():null}},4946:(e,t,r)=>{"use strict";const i=r(375),p=r(1687),s=r(8068),n=r(8160),a=r(3292),f=r(6354),o=r(6133),g={};e.exports=s.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:o.toSibling}},args:(e,...t)=>1===t.length&&Array.isArray(t[0])?e.try(...t[0]):e.try(...t),validate(r,t){const{schema:i,error:s,state:n,prefs:a}=t;if(i._flags.match){const t=[],c=[];for(let e=0;e<i.$_terms.matches.length;++e){const p=i.$_terms.matches[e],f=n.nest(p.schema,"match.".concat(e));f.snapshot();var o=p.schema.$_validate(r,f,a);o.errors?(c.push(o.errors),f.restore()):t.push(o.value)}if(0===t.length)return{errors:s("alternatives.any",{details:c.map(e=>f.details(e,{override:!1}))})};if("one"===i._flags.match)return 1===t.length?{value:t[0]}:{errors:s("alternatives.one")};if(t.length!==i.$_terms.matches.length)return{errors:s("alternatives.all",{details:c.map(e=>f.details(e,{override:!1}))})};const l=e=>e.$_terms.matches.some(e=>"object"===e.schema.type||"alternatives"===e.schema.type&&l(e.schema));return l(i)?{value:t.reduce((e,t)=>p(e,t,{mergeArrays:!1}))}:{value:t[t.length-1]}}const c=[];for(let t=0;t<i.$_terms.matches.length;++t){const s=i.$_terms.matches[t];if(s.schema){const i=n.nest(s.schema,"match.".concat(t)),p=(i.snapshot(),s.schema.$_validate(r,i,a));if(!p.errors)return p;i.restore(),c.push({schema:s.schema,reports:p.errors})}else{const p=s.ref?s.ref.resolve(r,n,a):r,f=s.is?[s]:s.switch;for(let e=0;e<f.length;++e){const c=f[e],{is:u,then:g,otherwise:d}=c,h="match.".concat(t).concat(s.switch?"."+e:"");if(u.$_match(p,n.nest(u,"".concat(h,".is")),a)){if(g)return g.$_validate(r,n.nest(g,"".concat(h,".then")),a)}else if(d)return d.$_validate(r,n.nest(d,"".concat(h,".otherwise")),a)}}}return g.errors(c,t)},rules:{conditional:{method(e,t){i(!this._flags._endedSwitch,"Unreachable condition"),i(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),i(void 0===t.break,"Cannot use break option with alternatives conditional");var r=this.clone(),t=a.when(r,e,t);for(const e of t.is?[t]:t.switch)if(e.then&&e.otherwise){r.$_setFlag("_endedSwitch",!0,{clone:!1});break}return r.$_terms.matches.push(t),r.$_mutateRebuild()}},match:{method(e){if(i(["any","one","all"].includes(e),"Invalid alternatives match mode",e),"any"!==e)for(const t of this.$_terms.matches)i(t.schema,"Cannot combine match mode",e,"with conditional rules");return this.$_setFlag("match",e)}},try:{method(...e){i(e.length,"Missing alternative schemas"),n.verifyFlat(e,"try"),i(!this._flags._endedSwitch,"Unreachable condition");var t=this.clone();for(const r of e)t.$_terms.matches.push({schema:t.$_compile(r)});return t.$_mutateRebuild()}}},overrides:{label(r){return this.$_parent("label",r).$_modify({each:(e,t)=>"is"!==t.path[0]?e.label(r):void 0,ref:!1})}},rebuild(t){t.$_modify({each:e=>{n.isSchema(e)&&"array"===e.type&&t.$_setFlag("_arrayItems",!0,{clone:!1})}})},manifest:{build(e,t){if(t.matches)for(const r of t.matches){const{schema:t,ref:i,is:s,not:n,then:a,otherwise:o}=r;e=t?e.try(t):i?e.conditional(i,{is:s,then:a,not:n,otherwise:o,switch:r.switch}):e.conditional(s,{then:a,otherwise:o})}return e}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}}),g.errors=function(e,{error:t,state:r}){if(!e.length)return{errors:t("alternatives.any")};if(1===e.length)return{errors:e[0].reports};var i,s,n=new Set,a=[];for({reports:i,schema:s}of e){if(1<i.length)return g.unmatched(e,t);var o=i[0];if(o instanceof f.Report==0)return g.unmatched(e,t);if(o.state.path.length!==r.path.length)a.push({type:s.type,report:o});else if("any.only"===o.code)for(const e of o.local.valids)n.add(e);else{var[c,l]=o.code.split(".");"base"===l?n.add(c):a.push({type:s.type,report:o})}}return a.length?1===a.length?{errors:a[0].report}:g.unmatched(e,t):{errors:t("alternatives.types",{types:[...n]})}},g.unmatched=function(e,t){var r=[];for(const t of e)r.push(...t.reports);return{errors:t("alternatives.match",f.details(r,{override:!1}))}}},8068:(e,t,r)=>{"use strict";const i=r(375),s=r(7629),n=r(8160),a=r(6914);e.exports=s.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(e,t){return i("function"==typeof e,"Method must be a function"),i(void 0===t||t&&"string"==typeof t,"Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:e,description:t}})},validate(e,t,{method:r}){try{return r(e,t)}catch(e){return t.error("any.custom",{error:e})}},args:["method","description"],multi:!0},messages:{method(e){return this.prefs({messages:e})}},shared:{method(e){i(n.isSchema(e)&&e._flags.id,"Schema must be a schema with an id");var t=this.clone();return t.$_terms.shared=t.$_terms.shared||[],t.$_terms.shared.push(e),t.$_mutateRegister(e),t}},warning:{method(e,t){return i(e&&"string"==typeof e,"Invalid warning code"),this.$_addRule({name:"warning",args:{code:e,local:t},warn:!0})},validate:(e,t,{code:r,local:i})=>t.error(r,i),args:["code","local"],multi:!0}},modifiers:{keep(e,t=!0){e.keep=t},message(e,t){e.message=a.compile(t)},warn(e,t=!0){e.warn=t}},manifest:{build(e,t){for(const l in t){var r=t[l];if(["examples","externals","metas","notes","tags"].includes(l))for(const t of r)e=e[l.slice(0,-1)](t);else if("alterations"!==l)if("whens"!==l){if("shared"===l)for(const t of r)e=e.shared(t)}else for(const t of r){var{ref:i,is:s,not:n,then:a,otherwise:o,concat:c}=t;e=c?e.concat(c):i?e.when(i,{is:s,not:n,then:a,otherwise:o,switch:t.switch,break:t.break}):e.when(s,{then:a,otherwise:o,break:t.break})}else{const t={};for(const{target:e,adjuster:u}of r)t[e]=u;e=e.alter(t)}}return e}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":"{{#label}} {{#arg}} references {{:#ref}} which {{#reason}}","any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}})},546:(e,t,r)=>{"use strict";const p=r(375),f=r(9474),g=r(9621),i=r(8068),_=r(8160),s=r(3292),S={};e.exports=i.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(e,{schema:t,state:r,prefs:i}){var s;return Array.isArray(e)&&(s=t.$_getRule("sort"))?S.sort(t,e,s.args.options,r,i):void 0}},validate(e,{schema:t,error:r}){if(!Array.isArray(e)){if(t._flags.single){const t=[e];return t[_.symbols.arraySingle]=!0,{value:t}}return{errors:r("array.base")}}if(t.$_getRule("items")||t.$_terms.externals)return{value:e.slice()}},rules:{has:{method(e){e=this.$_compile(e,{appendPath:!0});var t=this.$_addRule({name:"has",args:{schema:e}});return t.$_mutateRegister(e),t},validate(t,{state:r,prefs:i,error:e},{schema:s}){var n=[t,...r.ancestors];for(let e=0;e<t.length;++e){const a=r.localize([...r.path,e],n,s);if(s.$_match(t[e],a,i))return t}const a=s._flags.label;return a?e("array.hasKnown",{patternLabel:a}):e("array.hasUnknown",null)},multi:!0},items:{method(...t){_.verifyFlat(t,"items");var r=this.$_addRule("items");for(let e=0;e<t.length;++e){var i=_.tryWithPath(()=>this.$_compile(t[e]),e,{append:!0});r.$_terms.items.push(i)}return r.$_mutateRebuild()},validate(n,{schema:a,error:o,state:c,prefs:l,errorsArray:e}){const u=a.$_terms._requireds.slice(),d=a.$_terms.ordered.slice(),h=[...a.$_terms._inclusions,...u],p=!n[_.symbols.arraySingle];delete n[_.symbols.arraySingle];var f=e();let g=n.length;for(let s=0;s<g;++s){const _=n[s];let r=!1,i=!1;var m=p?s:new Number(s),y=[...c.path,m];if(a._flags.sparse||void 0!==_){var v=[n,...c.ancestors];for(const n of a.$_terms._exclusions)if(n.$_match(_,c.localize(y,v,n),l,{presence:"ignore"})){if(f.push(o("array.excludes",{pos:s,value:_},c.localize(y))),l.abortEarly)return f;r=!0,d.shift();break}if(!r){if(a.$_terms.ordered.length){if(d.length){const u=d.shift(),h=u.$_validate(_,c.localize(y,v,u),l);if(h.errors){if(f.push(...h.errors),l.abortEarly)return f}else if("strip"===u._flags.result)S.fastSplice(n,s),--s,--g;else{if(!a._flags.sparse&&void 0===h.value){if(f.push(o("array.sparse",{key:m,path:y,pos:s,value:void 0},c.localize(y))),l.abortEarly)return f;continue}n[s]=h.value}continue}if(!a.$_terms.items.length){if(f.push(o("array.orderedLength",{pos:s,limit:a.$_terms.ordered.length})),l.abortEarly)return f;break}}var b=[];let t=u.length;for(let e=0;e<t;++e){const h=c.localize(y,v,u[e]),p=(h.snapshot(),u[e].$_validate(_,h,l));if(!(b[e]=p).errors){if(n[s]=p.value,i=!0,S.fastSplice(u,e),--e,--t,!a._flags.sparse&&void 0===p.value&&(f.push(o("array.sparse",{key:m,path:y,pos:s,value:void 0},c.localize(y))),l.abortEarly))return f;break}h.restore()}if(!i){var w=l.stripUnknown&&!!l.stripUnknown.arrays||!1;t=h.length;for(const d of h){let e;const p=u.indexOf(d);if(-1!==p)e=b[p];else{const u=c.localize(y,v,d);if(u.snapshot(),!(e=d.$_validate(_,u,l)).errors){"strip"===d._flags.result?(S.fastSplice(n,s),--s,--g):a._flags.sparse||void 0!==e.value?n[s]=e.value:(f.push(o("array.sparse",{key:m,path:y,pos:s,value:void 0},c.localize(y))),r=!0),i=!0;break}u.restore()}if(1===t){if(w){S.fastSplice(n,s),--s,--g,i=!0;break}if(f.push(...e.errors),l.abortEarly)return f;r=!0;break}}if(!r&&(a.$_terms._inclusions.length||a.$_terms._requireds.length)&&!i)if(w)S.fastSplice(n,s),--s,--g;else if(f.push(o("array.includes",{pos:s,value:_},c.localize(y))),l.abortEarly)return f}}}else{if(f.push(o("array.sparse",{key:m,path:y,pos:s,value:void 0},c.localize(y))),l.abortEarly)return f;d.shift()}}return u.length&&S.fillMissedErrors(a,f,u,n,c,l),d.length&&(S.fillOrderedErrors(a,f,d,n,c,l),f.length||S.fillDefault(d,n,c,l)),f.length?f:n},priority:!0,manifest:!1},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:r},{name:i,operator:s,args:n})=>_.compare(e.length,r,s)?e:t.error("array."+i,{limit:n.limit,value:e}),args:[{name:"limit",ref:!0,assert:_.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},ordered:{method(...t){_.verifyFlat(t,"ordered");var r=this.$_addRule("items");for(let e=0;e<t.length;++e){var i=_.tryWithPath(()=>this.$_compile(t[e]),e,{append:!0});S.validateSingle(i,r),r.$_mutateRegister(i),r.$_terms.ordered.push(i)}return r.$_mutateRebuild()}},single:{method(e){e=void 0===e||!!e;return p(!e||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",e)}},sort:{method(e={}){_.assertOptions(e,["by","order"]);var t={order:e.order||"ascending"};return e.by&&(t.by=s.ref(e.by,{ancestor:0}),p(!t.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:t}})},validate(t,{error:r,state:e,prefs:i,schema:s},{options:n}){var{value:a,errors:s}=S.sort(s,t,n,e,i);if(s)return s;for(let e=0;e<t.length;++e)if(t[e]!==a[e])return r("array.sort",{order:n.order,by:n.by?n.by.key:"value"});return t},convert:!0},sparse:{method(e){e=void 0===e||!!e;return this._flags.sparse===e?this:(e?this.clone():this.$_addRule("items")).$_setFlag("sparse",e,{clone:!1})}},unique:{method(e,t={}){p(!e||"function"==typeof e||"string"==typeof e,"comparator must be a function or a string"),_.assertOptions(t,["ignoreUndefined","separator"]);var r={name:"unique",args:{options:t,comparator:e}};if(e)if("string"==typeof e){const p=_.default(t.separator,".");r.path=p?e.split(p):[e]}else r.comparator=e;return this.$_addRule(r)},validate(t,{state:r,error:i},{comparator:s,options:n},{comparator:a,path:o}){var c,l={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),object:new Map,function:new Map,custom:new Map},u=a||f,d=n.ignoreUndefined;for(let e=0;e<t.length;++e){const h=o?g(t[e],o):t[e],n=a?l.custom:l[typeof h];if(p(n,"Failed to find unique map container for type",typeof h),n instanceof Map){const p=n.entries();for(;!(c=p.next()).done;)if(u(c.value[0],h)){const p=r.localize([...r.path,e],[t,...r.ancestors]),h={pos:e,value:t[e],dupePos:c.value[1],dupeValue:t[c.value[1]]};return o&&(h.path=s),i("array.unique",h,p)}n.set(h,e)}else{if((!d||void 0!==h)&&void 0!==n[h]){const p={pos:e,value:t[e],dupePos:n[h],dupeValue:t[n[h]]};return o&&(p.path=s),i("array.unique",p,r.localize([...r.path,e],[t,...r.ancestors]))}n[h]=e}}return t},args:["comparator","options"],multi:!0}},cast:{set:{from:Array.isArray,to:(e,t)=>new Set(e)}},rebuild(e){e.$_terms._inclusions=[],e.$_terms._exclusions=[],e.$_terms._requireds=[];for(const t of e.$_terms.items)S.validateSingle(t,e),("required"===t._flags.presence?e.$_terms._requireds:"forbidden"===t._flags.presence?e.$_terms._exclusions:e.$_terms._inclusions).push(t);for(const r of e.$_terms.ordered)S.validateSingle(r,e)},manifest:{build:(e,t)=>(t.items&&(e=e.items(...t.items)),e=t.ordered?e.ordered(...t.ordered):e)},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":"{{#label}} does not contain at least one required match for type {:#patternLabel}","array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}}),S.fillMissedErrors=function(e,t,r,i,s,n){var a=[];let o=0;for(const e of r){const t=e._flags.label;t?a.push(t):++o}a.length?o?t.push(e.$_createError("array.includesRequiredBoth",i,{knownMisses:a,unknownMisses:o},s,n)):t.push(e.$_createError("array.includesRequiredKnowns",i,{knownMisses:a},s,n)):t.push(e.$_createError("array.includesRequiredUnknowns",i,{unknownMisses:o},s,n))},S.fillOrderedErrors=function(e,t,r,i,s,n){var a=[];for(const e of r)"required"===e._flags.presence&&a.push(e);a.length&&S.fillMissedErrors(e,t,a,i,s,n)},S.fillDefault=function(t,r,i,s){var n=[];let a=!0;for(let e=t.length-1;0<=e;--e){var o=t[e],c=[r,...i.ancestors],c=o.$_validate(void 0,i.localize(i.path,c,o),s).value;if(a){if(void 0===c)continue;a=!1}n.unshift(c)}n.length&&r.push(...n)},S.fastSplice=function(e,t){let r=t;for(;r<e.length;)e[r++]=e[r];--e.length},S.validateSingle=function(e,t){"array"!==e.type&&!e._flags._arrayItems||(p(!t._flags.single,"Cannot specify array item with single rule enabled"),t.$_setFlag("_arrayItems",!0,{clone:!1}))},S.sort=function(i,s,n,a,o){const c="ascending"===n.order?1:-1,l=-1*c,u=c;try{return{value:s.slice().sort((e,t)=>{var r=S.compare(e,t,l,u);if(null!==r)return r;if(n.by&&(e=n.by.resolve(e,a,o),t=n.by.resolve(t,a,o)),null!==(r=S.compare(e,t,l,u)))return r;r=typeof e;if(r!=typeof t)throw i.$_createError("array.sort.mismatching",s,null,a,o);if("number"!=r&&"string"!=r)throw i.$_createError("array.sort.unsupported",s,{type:r},a,o);return"number"==r?(e-t)*c:e<t?l:u})}}catch(i){return{errors:i}}},S.compare=function(e,t,r,i){return e===t?0:void 0===e?1:void 0===t?-1:null===e?i:null===t?r:null}},4937:(e,t,r)=>{"use strict";const s=r(375),i=r(8068),n=r(8160),a=r(2036),o={isBool:function(e){return"boolean"==typeof e}};e.exports=i.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(e,{schema:t}){var r;if("boolean"!=typeof e)return{value:e="boolean"!=typeof(e="string"==typeof e?"true"===(r=t._flags.sensitive?e:e.toLowerCase())||"false"!==r&&e:e)?t.$_terms.truthy&&t.$_terms.truthy.has(e,null,null,!t._flags.sensitive)||(!t.$_terms.falsy||!t.$_terms.falsy.has(e,null,null,!t._flags.sensitive))&&e:e}},validate(e,{error:t}){if("boolean"!=typeof e)return{value:e,errors:t("boolean.base")}},rules:{truthy:{method(...t){n.verifyFlat(t,"truthy");var r=this.clone();r.$_terms.truthy=r.$_terms.truthy||new a;for(let e=0;e<t.length;++e){var i=t[e];s(void 0!==i,"Cannot call truthy with undefined"),r.$_terms.truthy.add(i)}return r}},falsy:{method(...t){n.verifyFlat(t,"falsy");var r=this.clone();r.$_terms.falsy=r.$_terms.falsy||new a;for(let e=0;e<t.length;++e){var i=t[e];s(void 0!==i,"Cannot call falsy with undefined"),r.$_terms.falsy.add(i)}return r}},sensitive:{method(e=!0){return this.$_setFlag("sensitive",e)}}},cast:{number:{from:o.isBool,to:(e,t)=>e?1:0},string:{from:o.isBool,to:(e,t)=>e?"true":"false"}},manifest:{build:(e,t)=>(t.truthy&&(e=e.truthy(...t.truthy)),e=t.falsy?e.falsy(...t.falsy):e)},messages:{"boolean.base":"{{#label}} must be a boolean"}})},7500:(e,t,r)=>{"use strict";const i=r(375),s=r(8068),a=r(8160),n=r(3328),o={isDate:function(e){return e instanceof Date}};e.exports=s.extend({type:"date",coerce:{from:["number","string"],method:(e,{schema:t})=>({value:o.parse(e,t._flags.format)||e})},validate(e,{schema:t,error:r,prefs:i}){if(!(e instanceof Date)||isNaN(e.getTime()))return t=t._flags.format,i.convert&&t&&"string"==typeof e?{value:e,errors:r("date.format",{format:t})}:{value:e,errors:r("date.base")}},rules:{compare:{method:!1,validate(e,t,{date:r},{name:i,operator:s,args:n}){r="now"===r?Date.now():r.getTime();return a.compare(e.getTime(),r,s)?e:t.error("date."+i,{limit:n.date,value:e})},args:[{name:"date",ref:!0,normalize:e=>"now"===e?e:o.parse(e),assert:e=>null!==e,message:"must have a valid date format"}]},format:{method(e){return i(["iso","javascript","unix"].includes(e),"Unknown date format",e),this.$_setFlag("format",e)}},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{date:e},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{date:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{date:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{date:e},operator:">="})}},timestamp:{method(e="javascript"){return i(["javascript","unix"].includes(e),'"type" must be one of "javascript, unix"'),this.format(e)}}},cast:{number:{from:o.isDate,to:(e,t)=>e.getTime()},string:{from:o.isDate,to:(e,{prefs:t})=>n.date(e,t)}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":"{{#label}} must be greater than {{:#limit}}","date.less":"{{#label}} must be less than {{:#limit}}","date.max":"{{#label}} must be less than or equal to {{:#limit}}","date.min":"{{#label}} must be greater than or equal to {{:#limit}}","date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}}),o.parse=function(e,t){if(e instanceof Date)return e;if("string"!=typeof e&&(isNaN(e)||!isFinite(e)))return null;if(/^\s*$/.test(e))return null;if("iso"===t)return a.isIsoDate(e)?o.date(e.toString()):null;var r=e;if("string"==typeof e&&/^[+-]?\d+(\.\d+)?$/.test(e)&&(e=parseFloat(e)),t){if("javascript"===t)return o.date(+e);if("unix"===t)return o.date(1e3*e);if("string"==typeof r)return null}return o.date(e)},o.date=function(e){e=new Date(e);return isNaN(e.getTime())?null:e}},390:(e,t,r)=>{"use strict";const i=r(375),s=r(7824);e.exports=s.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(e){return i(Number.isSafeInteger(e)&&0<=e,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:e}})},validate:(e,t,{n:r})=>e.length===r?e:t.error("function.arity",{n:r})},class:{method(){return this.$_addRule("class")},validate:(e,t)=>/^\s*class\s/.test(e.toString())?e:t.error("function.class",{value:e})},minArity:{method(e){return i(Number.isSafeInteger(e)&&0<e,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:e}})},validate:(e,t,{n:r})=>e.length>=r?e:t.error("function.minArity",{n:r})},maxArity:{method(e){return i(Number.isSafeInteger(e)&&0<=e,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:e}})},validate:(e,t,{n:r})=>e.length<=r?e:t.error("function.maxArity",{n:r})}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}})},7824:(e,t,r)=>{"use strict";const s=r(978),o=r(375),i=r(8571),n=r(3652),a=r(8068),m=r(8160),c=r(3292),y=r(6354),l=r(6133),d=r(3328),f={renameDefaults:{alias:!1,multiple:!1,override:!1}};e.exports=a.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:!1}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args:(e,t)=>e.keys(t),validate(e,{schema:t,error:r,state:i,prefs:s}){if(!e||typeof e!==t.$_property("typeof")||Array.isArray(e))return{value:e,errors:r("object.base",{type:t.$_property("typeof")})};if(t.$_terms.renames||t.$_terms.dependencies||t.$_terms.keys||t.$_terms.patterns||t.$_terms.externals){e=f.clone(e,s);var n=[];if((!t.$_terms.renames||f.rename(t,e,i,s,n))&&(t.$_terms.keys||t.$_terms.patterns||t.$_terms.dependencies)){const o=new Set(Object.keys(e));if(t.$_terms.keys){const r=[e,...i.ancestors];for(const c of t.$_terms.keys){const t=c.key,l=e[t];o.delete(t);var a=i.localize([...i.path,t],r,c),a=c.schema.$_validate(l,a,s);if(a.errors){if(s.abortEarly)return{value:e,errors:a.errors};void 0!==a.value&&(e[t]=a.value),n.push(...a.errors)}else"strip"===c.schema._flags.result||void 0===a.value&&void 0!==l?delete e[t]:void 0!==a.value&&(e[t]=a.value)}}if(o.size||t._flags._hasPatternMatch){const r=f.unknown(t,e,o,n,i,s);if(r)return r}if(t.$_terms.dependencies)for(const r of t.$_terms.dependencies)if(!r.key||void 0!==r.key.resolve(e,i,s,null,{shadow:!1})){const o=f.dependencies[r.rel](t,r,e,i,s);if(o){const r=t.$_createError(o.code,e,o.context,i,s);if(s.abortEarly)return{value:e,errors:r};n.push(r)}}}return{value:e,errors:n}}},rules:{and:{method(...e){return m.verifyFlat(e,"and"),f.dependency(this,"and",null,e)}},append:{method(e){return null==e||0===Object.keys(e).length?this:this.keys(e)}},assert:{method(e,t,r){d.isTemplate(e)||(e=c.ref(e)),o(void 0===r||"string"==typeof r,"Message must be a string"),t=this.$_compile(t,{appendPath:!0});r=this.$_addRule({name:"assert",args:{subject:e,schema:t,message:r}});return r.$_mutateRegister(e),r.$_mutateRegister(t),r},validate(e,{error:t,prefs:r,state:i},{subject:s,schema:n,message:a}){var o=s.resolve(e,i,r),c=l.isRef(s)?s.absolute(i):[];return n.$_match(o,i.localize(c,[e,...i.ancestors],n),r)?e:t("object.assert",{subject:s,message:a})},args:["subject","schema","message"],multi:!0},instance:{method(e,t){return o("function"==typeof e,"constructor must be a function"),t=t||e.name,this.$_addRule({name:"instance",args:{constructor:e,name:t}})},validate:(e,t,{constructor:r,name:i})=>e instanceof r?e:t.error("object.instance",{type:i,value:e}),args:["constructor","name"]},keys:{method(t){o(void 0===t||"object"==typeof t,"Object schema must be a valid object"),o(!m.isSchema(t),"Object schema cannot be a joi schema");const e=this.clone();if(t)if(Object.keys(t).length){e.$_terms.keys=e.$_terms.keys?e.$_terms.keys.filter(e=>!t.hasOwnProperty(e.key)):new f.Keys;for(const r in t)m.tryWithPath(()=>e.$_terms.keys.push({key:r,schema:this.$_compile(t[r])}),r)}else e.$_terms.keys=new f.Keys;else e.$_terms.keys=null;return e.$_mutateRebuild()}},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:r},{name:i,operator:s,args:n})=>m.compare(Object.keys(e).length,r,s)?e:t.error("object."+i,{limit:n.limit,value:e}),args:[{name:"limit",ref:!0,assert:m.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},nand:{method(...e){return m.verifyFlat(e,"nand"),f.dependency(this,"nand",null,e)}},or:{method(...e){return m.verifyFlat(e,"or"),f.dependency(this,"or",null,e)}},oxor:{method(...e){return f.dependency(this,"oxor",null,e)}},pattern:{method(e,t,r={}){var i=e instanceof RegExp,s=(i||(e=this.$_compile(e,{appendPath:!0})),o(void 0!==t,"Invalid rule"),m.assertOptions(r,["fallthrough","matches"]),i&&o(!e.flags.includes("g")&&!e.flags.includes("y"),"pattern should not use global or sticky mode"),t=this.$_compile(t,{appendPath:!0}),this.clone()),i=(s.$_terms.patterns=s.$_terms.patterns||[],{[i?"regex":"schema"]:e,rule:t});return r.matches&&(i.matches=this.$_compile(r.matches),"array"!==i.matches.type&&(i.matches=i.matches.$_root.array().items(i.matches)),s.$_mutateRegister(i.matches),s.$_setFlag("_hasPatternMatch",!0,{clone:!1})),r.fallthrough&&(i.fallthrough=!0),s.$_terms.patterns.push(i),s.$_mutateRegister(t),s}},ref:{method(){return this.$_addRule("ref")},validate:(e,t)=>l.isRef(e)?e:t.error("object.refType",{value:e})},regex:{method(){return this.$_addRule("regex")},validate:(e,t)=>e instanceof RegExp?e:t.error("object.regex",{value:e})},rename:{method(e,t,r={}){o("string"==typeof e||e instanceof RegExp,"Rename missing the from argument"),o("string"==typeof t||t instanceof d,"Invalid rename to argument"),o(t!==e,"Cannot rename key to same name:",e),m.assertOptions(r,["alias","ignoreUndefined","override","multiple"]);var i=this.clone();i.$_terms.renames=i.$_terms.renames||[];for(const t of i.$_terms.renames)o(t.from!==e,"Cannot rename the same key multiple times");return t instanceof d&&i.$_mutateRegister(t),i.$_terms.renames.push({from:e,to:t,options:s(f.renameDefaults,r)}),i}},schema:{method(e="any"){return this.$_addRule({name:"schema",args:{type:e}})},validate:(e,t,{type:r})=>!m.isSchema(e)||"any"!==r&&e.type!==r?t.error("object.schema",{type:r}):e},unknown:{method(e){return this.$_setFlag("unknown",!1!==e)}},with:{method(e,t,r={}){return f.dependency(this,"with",e,t,r)}},without:{method(e,t,r={}){return f.dependency(this,"without",e,t,r)}},xor:{method(...e){return m.verifyFlat(e,"xor"),f.dependency(this,"xor",null,e)}}},overrides:{default(e,t){return void 0===e&&(e=m.symbols.deepDefault),this.$_parent("default",e,t)}},rebuild(e){if(e.$_terms.keys){const t=new n.Sorter;for(const r of e.$_terms.keys)m.tryWithPath(()=>t.add(r,{after:r.schema.$_rootReferences(),group:r.key}),r.key);e.$_terms.keys=new f.Keys(...t.nodes)}},manifest:{build(e,t){if(t.keys&&(e=e.keys(t.keys)),t.dependencies)for(var{rel:r,key:i=null,peers:s,options:n}of t.dependencies)e=f.dependency(e,r,i,s,n);if(t.patterns)for(var{regex:a,schema:o,rule:c,fallthrough:l,matches:u}of t.patterns)e=e.pattern(a||o,c,{fallthrough:l,matches:u});if(t.renames)for(var{from:d,to:h,options:p}of t.renames)e=e.rename(d,h,p);return e}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":"{{#label}} must be an instance of {{:#type}}","object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":"{{:#mainWithLabel}} must not exist simultaneously with {{#peersWithLabels}}","object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":"{{#label}} cannot rename {{:#from}} because multiple renames are disabled and another key was already renamed to {{:#to}}","object.rename.override":"{{#label}} cannot rename {{:#from}} because override is disabled and target {{:#to}} exists","object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":"{{:#mainWithLabel}} missing required peer {{:#peerWithLabel}}","object.without":"{{:#mainWithLabel}} conflict with forbidden peer {{:#peerWithLabel}}","object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}}),f.clone=function(t,e){if("object"==typeof t){if(e.nonEnumerables)return i(t,{shallow:!0});const r=Object.create(Object.getPrototypeOf(t));return Object.assign(r,t),r}const r=function(...e){return t.apply(this,e)};return r.prototype=i(t.prototype),Object.defineProperty(r,"name",{value:t.name,writable:!1}),Object.defineProperty(r,"length",{value:t.length,writable:!1}),Object.assign(r,t),r},f.dependency=function(e,t,r,i,s){o(null===r||"string"==typeof r,t,"key must be a strings"),s=s||(1<i.length&&"object"==typeof i[i.length-1]?i.pop():{}),m.assertOptions(s,["separator"]),i=[].concat(i);var n=m.default(s.separator,"."),a=[];for(const e of i)o("string"==typeof e,t,"peers must be strings"),a.push(c.ref(e,{separator:n,ancestor:0,prefix:!1}));null!==r&&(r=c.ref(r,{separator:n,ancestor:0,prefix:!1}));s=e.clone();return s.$_terms.dependencies=s.$_terms.dependencies||[],s.$_terms.dependencies.push(new f.Dependency(t,r,a,i)),s},f.dependencies={and(e,t,r,i,s){var n=[],a=[],o=t.peers.length;for(const e of t.peers)(void 0===e.resolve(r,i,s,null,{shadow:!1})?n:a).push(e.key);if(n.length!==o&&a.length!==o)return{code:"object.and",context:{present:a,presentWithLabels:f.keysToLabels(e,a),missing:n,missingWithLabels:f.keysToLabels(e,n)}}},nand(e,t,r,i,s){var n,a=[];for(const e of t.peers)void 0!==e.resolve(r,i,s,null,{shadow:!1})&&a.push(e.key);if(a.length===t.peers.length)return n=t.paths[0],t=t.paths.slice(1),{code:"object.nand",context:{main:n,mainWithLabel:f.keysToLabels(e,n),peers:t,peersWithLabels:f.keysToLabels(e,t)}}},or(e,t,r,i,s){for(const e of t.peers)if(void 0!==e.resolve(r,i,s,null,{shadow:!1}))return;return{code:"object.missing",context:{peers:t.paths,peersWithLabels:f.keysToLabels(e,t.paths)}}},oxor(e,t,r,i,s){var n=[];for(const e of t.peers)void 0!==e.resolve(r,i,s,null,{shadow:!1})&&n.push(e.key);if(n.length&&1!==n.length)return(t={peers:t.paths,peersWithLabels:f.keysToLabels(e,t.paths)}).present=n,t.presentWithLabels=f.keysToLabels(e,n),{code:"object.oxor",context:t}},with(e,t,r,i,s){for(const n of t.peers)if(void 0===n.resolve(r,i,s,null,{shadow:!1}))return{code:"object.with",context:{main:t.key.key,mainWithLabel:f.keysToLabels(e,t.key.key),peer:n.key,peerWithLabel:f.keysToLabels(e,n.key)}}},without(e,t,r,i,s){for(const n of t.peers)if(void 0!==n.resolve(r,i,s,null,{shadow:!1}))return{code:"object.without",context:{main:t.key.key,mainWithLabel:f.keysToLabels(e,t.key.key),peer:n.key,peerWithLabel:f.keysToLabels(e,n.key)}}},xor(e,t,r,i,s){var n=[];for(const e of t.peers)void 0!==e.resolve(r,i,s,null,{shadow:!1})&&n.push(e.key);if(1!==n.length)return t={peers:t.paths,peersWithLabels:f.keysToLabels(e,t.paths)},0===n.length?{code:"object.missing",context:t}:(t.present=n,t.presentWithLabels=f.keysToLabels(e,n),{code:"object.xor",context:t})}},f.keysToLabels=function(t,e){return Array.isArray(e)?e.map(e=>t.$_mapLabels(e)):t.$_mapLabels(e)},f.rename=function(t,r,i,s,n){var a={};for(const l of t.$_terms.renames){var e=[],o="string"!=typeof l.from;if(o){for(const t in r)if((void 0!==r[t]||!l.options.ignoreUndefined)&&t!==l.to){const i=l.from.exec(t);i&&e.push({from:t,to:l.to,match:i})}}else!Object.prototype.hasOwnProperty.call(r,l.from)||void 0===r[l.from]&&l.options.ignoreUndefined||e.push(l);for(const u of e){var c=u.from;let e=u.to;if(c!==(e=e instanceof d?e.render(r,i,s,u.match):e)){if(!l.options.multiple&&a[e]&&(n.push(t.$_createError("object.rename.multiple",r,{from:c,to:e,pattern:o},i,s)),s.abortEarly))return!1;if(Object.prototype.hasOwnProperty.call(r,e)&&!l.options.override&&!a[e]&&(n.push(t.$_createError("object.rename.override",r,{from:c,to:e,pattern:o},i,s)),s.abortEarly))return!1;void 0===r[c]?delete r[e]:r[e]=r[c],a[e]=!0,l.options.alias||delete r[c]}}}return!0},f.unknown=function(r,i,s,n,a,o){if(r.$_terms.patterns){let t=!1;const p=r.$_terms.patterns.map(e=>{if(e.matches)return t=!0,[]}),m=[i,...a.ancestors];for(const f of s){const g=i[f],y=[...a.path,f];for(let e=0;e<r.$_terms.patterns.length;++e){var c=r.$_terms.patterns[e];if(c.regex){const r=c.regex.test(f);if(a.mainstay.tracer.debug(a,"rule","pattern.".concat(e),r?"pass":"error"),!r)continue}else if(!c.schema.$_match(f,a.nest(c.schema,"pattern.".concat(e)),o))continue;s.delete(f);var l=a.localize(y,m,{schema:c.rule,key:f}),l=c.rule.$_validate(g,l,o);if(l.errors){if(o.abortEarly)return{value:i,errors:l.errors};n.push(...l.errors)}if(c.matches&&p[e].push(f),i[f]=l.value,!c.fallthrough)break}}if(t)for(let e=0;e<p.length;++e){var u=p[e];if(u){var d=r.$_terms.patterns[e].matches,h=a.localize(a.path,m,d),d=d.$_validate(u,h,o);if(d.errors){const s=y.details(d.errors,{override:!1});s.matches=u;h=r.$_createError("object.pattern.match",i,s,a,o);if(o.abortEarly)return{value:i,errors:h};n.push(h)}}}}if(s.size&&(r.$_terms.keys||r.$_terms.patterns)){if(o.stripUnknown&&!r._flags.unknown||o.skipFunctions){const r=!(!o.stripUnknown||!0!==o.stripUnknown&&!o.stripUnknown.objects);for(const n of s)r?(delete i[n],s.delete(n)):"function"==typeof i[n]&&s.delete(n)}if(!m.default(r._flags.unknown,o.allowUnknown))for(const e of s){const s=a.localize([...a.path,e],[]),t=r.$_createError("object.unknown",i[e],{child:e},s,o,{flags:!1});if(o.abortEarly)return{value:i,errors:t};n.push(t)}}},f.Dependency=class{constructor(e,t,r,i){this.rel=e,this.key=t,this.peers=r,this.paths=i}describe(){var e={rel:this.rel,peers:this.paths};return null!==this.key&&(e.key=this.key.key),"."!==this.peers[0].separator&&(e.options={separator:this.peers[0].separator}),e}},f.Keys=class extends Array{concat(e){var t=this.slice(),r=new Map;for(let e=0;e<t.length;++e)r.set(t[e].key,e);for(const i of e){const e=i.key,s=r.get(e);void 0!==s?t[s]={key:e,schema:t[s].schema.concat(i.schema)}:t.push(i)}return t}}},8785:(e,t,r)=>{"use strict";const a=r(375),i=r(8068),s=r(8160),n=r(3292),o=r(6354),c={};e.exports=i.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args:(e,t)=>e.ref(t),validate(e,{schema:t,state:r,prefs:i}){a(t.$_terms.link,"Uninitialized link schema");var s=c.generate(t,e,r,i),t=t.$_terms.link[0].ref;return s.$_validate(e,r.nest(s,"link:".concat(t.display,":").concat(s.type)),i)},generate:(e,t,r,i)=>c.generate(e,t,r,i),rules:{ref:{method(e){a(!this.$_terms.link,"Cannot reinitialize schema"),e=n.ref(e),a("value"===e.type||"local"===e.type,"Invalid reference type:",e.type),a("local"===e.type||"root"===e.ancestor||0<e.ancestor,"Link cannot reference itself");var t=this.clone();return t.$_terms.link=[{ref:e}],t}},relative:{method(e=!0){return this.$_setFlag("relative",e)}}},overrides:{concat(e){a(this.$_terms.link,"Uninitialized link schema"),a(s.isSchema(e),"Invalid schema object"),a("link"!==e.type,"Cannot merge type link with another link");var t=this.clone();return t.$_terms.whens||(t.$_terms.whens=[]),t.$_terms.whens.push({concat:e}),t.$_mutateRebuild()}},manifest:{build:(e,t)=>(a(t.link,"Invalid link description missing link"),e.ref(t.link))}}),c.generate=function(e,t,r,i){let s=r.mainstay.links.get(e);if(!s){var n=e.$_terms.link[0].ref,{perspective:a,path:o}=c.perspective(n,r);c.assert(a,"which is outside of schema boundaries",n,e,r,i);try{s=o.length?a.$_reach(o):a}catch(t){c.assert(!1,"to non-existing schema",n,e,r,i)}c.assert("link"!==s.type,"which is another link",n,e,r,i),e._flags.relative||r.mainstay.links.set(e,s)}return s._generate(t,r,i).schema},c.perspective=function(e,t){if("local"!==e.type)return"root"===e.ancestor?{perspective:t.schemas[t.schemas.length-1].schema,path:e.path}:{perspective:t.schemas[e.ancestor]&&t.schemas[e.ancestor].schema,path:e.path};for(var{schema:r,key:i}of t.schemas){if((r._flags.id||i)===e.path[0])return{perspective:r,path:e.path.slice(1)};if(r.$_terms.shared)for(const t of r.$_terms.shared)if(t._flags.id===e.path[0])return{perspective:t,path:e.path.slice(1)}}return{perspective:null,path:null}},c.assert=function(e,t,r,i,s,n){e||a(!1,'"'.concat(o.label(i._flags,s,n),'" contains link reference "').concat(r.display,'" ').concat(t))}},3832:(e,t,r)=>{"use strict";const i=r(375),s=r(8068),a=r(8160),n={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/};e.exports=s.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(e,{schema:t,error:r}){var i=e.match(n.numberRx);if(i){e=e.trim();var s={value:parseFloat(e)};if(0===s.value&&(s.value=0),!t._flags.unsafe)if(e.match(/e/i)){if(n.normalizeExponent("".concat(s.value/Math.pow(10,i[1]),"e").concat(i[1]))!==n.normalizeExponent(e))s.errors=r("number.unsafe")}else{const t=s.value.toString();if(t.match(/e/i))return s;if(t!==n.normalizeDecimal(e))s.errors=r("number.unsafe")}return s}}},validate(e,{schema:t,error:r,prefs:i}){if(e===1/0||e===-1/0)return{value:e,errors:r("number.infinity")};if(!a.isNumber(e))return{value:e,errors:r("number.base")};var s={value:e};if(i.convert){const e=t.$_getRule("precision");if(e){const t=Math.pow(10,e.args.limit);s.value=Math.round(s.value*t)/t}}return 0===s.value&&(s.value=0),!t._flags.unsafe&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)&&(s.errors=r("number.unsafe")),s},rules:{compare:{method:!1,validate:(e,t,{limit:r},{name:i,operator:s,args:n})=>a.compare(e,r,s)?e:t.error("number."+i,{limit:n.limit,value:e}),args:[{name:"limit",ref:!0,assert:a.isNumber,message:"must be a number"}]},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{limit:e},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate:(e,t)=>Math.trunc(e)-e==0?e:t.error("number.integer")},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{limit:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{limit:e},operator:">="})}},multiple:{method(e){return this.$_addRule({name:"multiple",args:{base:e}})},validate:(e,t,{base:r},i)=>e*(1/r)%1==0?e:t.error("number.multiple",{multiple:i.args.base,value:e}),args:[{name:"base",ref:!0,assert:e=>"number"==typeof e&&isFinite(e)&&0<e,message:"must be a positive number"}],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate:(e,t)=>Number.isSafeInteger(e)&&0<=e&&e<=65535?e:t.error("number.port")},positive:{method(){return this.sign("positive")}},precision:{method(e){return i(Number.isSafeInteger(e),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:e}})},validate(e,t,{limit:r}){var i=e.toString().match(n.precisionRx);return Math.max((i[1]?i[1].length:0)-(i[2]?parseInt(i[2],10):0),0)<=r?e:t.error("number.precision",{limit:r,value:e})},convert:!0},sign:{method(e){return i(["negative","positive"].includes(e),"Invalid sign",e),this.$_addRule({name:"sign",args:{sign:e}})},validate:(e,t,{sign:r})=>"negative"===r&&e<0||"positive"===r&&0<e?e:t.error("number.".concat(r))},unsafe:{method(e=!0){return i("boolean"==typeof e,"enabled must be a boolean"),this.$_setFlag("unsafe",e)}}},cast:{string:{from:e=>"number"==typeof e,to:(e,t)=>e.toString()}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be greater than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}}),n.normalizeExponent=function(e){return e.replace(/E/,"e").replace(/\.(\d*[1-9])?0+e/,".$1e").replace(/\.e/,"e").replace(/e\+/,"e").replace(/^\+/,"").replace(/^(-?)0+([1-9])/,"$1$2")},n.normalizeDecimal=function(e){return"-0"===(e=(e=e.replace(/^\+/,"").replace(/\.0*$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([0-9])/,"$1$2")).includes(".")&&e.endsWith("0")?e.replace(/0+$/,""):e)?"0":e}},8966:(e,t,r)=>{"use strict";r=r(7824);e.exports=r.extend({type:"object",cast:{map:{from:e=>e&&"object"==typeof e,to:(e,t)=>new Map(Object.entries(e))}}})},7417:(e,t,r)=>{"use strict";function n(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function i(i){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?n(Object(s),!0).forEach(function(e){var t,r;t=i,r=s[e=e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(s,e))})}return i}const a=r(375),o=r(5380),c=r(1745),s=r(9959),l=r(6064),u=r(9926),d=r(5752),h=r(8068),p=r(8160),f={tlds:u instanceof Set&&{tlds:{allow:u,deny:null}},base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:/^[a-f0-9]+$/i,ipRegex:s.regex({cidr:"forbidden"}).regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5"},guidSeparators:new Set([void 0,!0,!1,"-",":"]),normalizationForms:["NFC","NFD","NFKC","NFKD"]};e.exports=h.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(t,{schema:r,state:i,prefs:s}){const n=r.$_getRule("normalize");n&&(t=t.normalize(n.args.form));var e=r.$_getRule("case"),e=(e&&(t="upper"===e.args.direction?t.toLocaleUpperCase():t.toLocaleLowerCase()),r.$_getRule("trim"));if(e&&e.args.enabled&&(t=t.trim()),r.$_terms.replacements)for(const i of r.$_terms.replacements)t=t.replace(i.pattern,i.replacement);e=r.$_getRule("hex");if(e&&e.args.options.byteAligned&&t.length%2!=0&&(t="0".concat(t)),r.$_getRule("isoDate")){const r=f.isoDate(t);r&&(t=r)}if(r._flags.truncate){const n=r.$_getRule("max");if(n){let e=n.args.limit;if(p.isResolvable(e)&&(e=e.resolve(t,i,s),!p.limit(e)))return{value:t,errors:r.$_createError("any.ref",e,{ref:n.args.limit,arg:"limit",reason:"must be a positive integer"},i,s)};t=t.slice(0,e)}}return{value:t}}},validate(e,{schema:t,error:r}){if("string"!=typeof e)return{value:e,errors:r("string.base")};if(""===e){t=t.$_getRule("min");if(!t||0!==t.args.limit)return{value:e,errors:r("string.empty")}}},rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate:(e,t)=>/^[a-zA-Z0-9]+$/.test(e)?e:t.error("string.alphanum")},base64:{method(e={}){return p.assertOptions(e,["paddingRequired","urlSafe"]),e=i({urlSafe:!1,paddingRequired:!0},e),a("boolean"==typeof e.paddingRequired,"paddingRequired must be boolean"),a("boolean"==typeof e.urlSafe,"urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:e}})},validate:(e,t,{options:r})=>f.base64Regex[r.paddingRequired][r.urlSafe].test(e)?e:t.error("string.base64")},case:{method(e){return a(["lower","upper"].includes(e),"Invalid case:",e),this.$_addRule({name:"case",args:{direction:e}})},validate:(e,t,{direction:r})=>"lower"===r&&e===e.toLocaleLowerCase()||"upper"===r&&e===e.toLocaleUpperCase()?e:t.error("string.".concat(r,"case")),convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(e,t){let r=e.length,i=0,s=1;for(;r--;){const t=e.charAt(r)*s;i+=t-9*(9<t),s^=3}return 0<i&&i%10==0?e:t.error("string.creditCard")}},dataUri:{method(e={}){return p.assertOptions(e,["paddingRequired"]),e=i({paddingRequired:!0},e),a("boolean"==typeof e.paddingRequired,"paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:e}})},validate(e,t,{options:r}){var i=e.match(f.dataUriRegex);if(i){if(!i[2])return e;if("base64"!==i[2])return e;if(f.base64Regex[r.paddingRequired].false.test(i[3]))return e}return t.error("string.dataUri")}},domain:{method(e){e&&p.assertOptions(e,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);var t=f.addressOptions(e);return this.$_addRule({name:"domain",args:{options:e},address:t})},validate:(e,t,r,{address:i})=>o.isValid(e,i)?e:t.error("string.domain")},email:{method(e={}){p.assertOptions(e,["allowFullyQualified","allowUnicode","ignoreLength","maxDomainSegments","minDomainSegments","multiple","separator","tlds"]),a(void 0===e.multiple||"boolean"==typeof e.multiple,"multiple option must be an boolean");var t=f.addressOptions(e),r=new RegExp("\\s*[".concat(e.separator?l(e.separator):",","]\\s*"));return this.$_addRule({name:"email",args:{options:e},regex:r,address:t})},validate(e,t,{options:r},{regex:i,address:s}){var r=r.multiple?e.split(i):[e],n=[];for(const e of r)c.isValid(e,s)||n.push(e);return n.length?t.error("string.email",{value:e,invalids:n}):e}},guid:{alias:"uuid",method(e={}){p.assertOptions(e,["version","separator"]);let t="";if(e.version){const i=[].concat(e.version),s=(a(1<=i.length,"version must have at least 1 valid version specified"),new Set);for(let e=0;e<i.length;++e){var r=i[e],r=(a("string"==typeof r,"version at position "+e+" must be a string"),f.guidVersions[r.toLowerCase()]);a(r,"version at position "+e+" must be one of "+Object.keys(f.guidVersions).join(", ")),a(!s.has(r),"version at position "+e+" must not be a duplicate"),t+=r,s.add(r)}}a(f.guidSeparators.has(e.separator),'separator must be one of true, false, "-", or ":"');const i=void 0===e.separator?"[:-]?":!0===e.separator?"[:-]":!1===e.separator?"[]?":"\\".concat(e.separator),s=new RegExp("^([\\[{\\(]?)[0-9A-F]{8}(".concat(i,")[0-9A-F]{4}\\2?[").concat(t||"0-9A-F","][0-9A-F]{3}\\2?[").concat(t?"89AB":"0-9A-F","][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$"),"i");return this.$_addRule({name:"guid",args:{options:e},regex:s})},validate(e,t,r,{regex:i}){i=i.exec(e);return!i||f.guidBrackets[i[1]]!==i[i.length-1]?t.error("string.guid"):e}},hex:{method(e={}){return p.assertOptions(e,["byteAligned"]),e=i({byteAligned:!1},e),a("boolean"==typeof e.byteAligned,"byteAligned must be boolean"),this.$_addRule({name:"hex",args:{options:e}})},validate:(e,t,{options:r})=>f.hexRegex.test(e)?r.byteAligned&&e.length%2!=0?t.error("string.hexAlign"):e:t.error("string.hex")},hostname:{method(){return this.$_addRule("hostname")},validate:(e,t)=>o.isValid(e,{minDomainSegments:1})||f.ipRegex.test(e)?e:t.error("string.hostname")},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(e={}){p.assertOptions(e,["cidr","version"]);var{cidr:t,versions:r,regex:i}=s.regex(e),e=e.version?r:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:t,version:e}},regex:i})},validate:(e,t,{options:r},{regex:i})=>i.test(e)?e:r.version?t.error("string.ipVersion",{value:e,cidr:r.cidr,version:r.version}):t.error("string.ip",{value:e,cidr:r.cidr})},isoDate:{method(){return this.$_addRule("isoDate")},validate:(e,{error:t})=>f.isoDate(e)?e:t("string.isoDate")},isoDuration:{method(){return this.$_addRule("isoDuration")},validate:(e,t)=>f.isoDurationRegex.test(e)?e:t.error("string.isoDuration")},length:{method(e,t){return f.length(this,"length",e,"=",t)},validate(e,t,{limit:r,encoding:i},{name:s,operator:n,args:a}){var o=!i&&e.length;return p.compare(o,r,n)?e:t.error("string."+s,{limit:a.limit,value:e,encoding:i})},args:[{name:"limit",ref:!0,assert:p.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(e,t){return f.length(this,"max",e,"<=",t)},args:["limit","encoding"]},min:{method(e,t){return f.length(this,"min",e,">=",t)},args:["limit","encoding"]},normalize:{method(e="NFC"){return a(f.normalizationForms.includes(e),"normalization form must be one of "+f.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:e}})},validate:(e,{error:t},{form:r})=>e===e.normalize(r)?e:t("string.normalize",{value:e,form:r}),convert:!0},pattern:{alias:"regex",method(e,t={}){a(e instanceof RegExp,"regex must be a RegExp"),a(!e.flags.includes("g")&&!e.flags.includes("y"),"regex should not use global or sticky mode"),"string"==typeof t&&(t={name:t}),p.assertOptions(t,["invert","name"]);var r=["string.pattern",t.invert?".invert":"",t.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:e,options:t},errorCode:r})},validate:(e,t,{regex:r,options:i},{errorCode:s})=>r.test(e)^i.invert?e:t.error(s,{name:i.name,regex:r,value:e}),args:["regex","options"],multi:!0},replace:{method(e,t){"string"==typeof e&&(e=new RegExp(l(e),"g")),a(e instanceof RegExp,"pattern must be a RegExp"),a("string"==typeof t,"replacement must be a String");var r=this.clone();return r.$_terms.replacements||(r.$_terms.replacements=[]),r.$_terms.replacements.push({pattern:e,replacement:t}),r}},token:{method(){return this.$_addRule("token")},validate:(e,t)=>/^\w+$/.test(e)?e:t.error("string.token")},trim:{method(e=!0){return a("boolean"==typeof e,"enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:e}})},validate:(e,t,{enabled:r})=>r&&e!==e.trim()?t.error("string.trim"):e,convert:!0},truncate:{method(e=!0){return a("boolean"==typeof e,"enabled must be a boolean"),this.$_setFlag("truncate",e)}},uppercase:{method(){return this.case("upper")}},uri:{method(e={}){p.assertOptions(e,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme"]),e.domain&&p.assertOptions(e.domain,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);var{regex:t,scheme:r}=d.regex(e),i=e.domain?f.addressOptions(e.domain):null;return this.$_addRule({name:"uri",args:{options:e},regex:t,domain:i,scheme:r})},validate(e,t,{options:r},{regex:i,domain:s,scheme:n}){if(["http:/","https:/"].includes(e))return t.error("string.uri");var a=i.exec(e);if(a){const i=a[1]||a[2];return!s||r.allowRelative&&!i||o.isValid(i,s)?e:t.error("string.domain",{value:i})}return r.relativeOnly?t.error("string.uriRelativeOnly"):r.scheme?t.error("string.uriCustomScheme",{scheme:n,value:e}):t.error("string.uri")}}},manifest:{build(e,t){if(t.replacements)for(var{pattern:r,replacement:i}of t.replacements)e=e.replace(r,i);return e}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":"{{#label}} with value {:[.]} fails to match the required pattern: {{#regex}}","string.pattern.name":"{{#label}} with value {:[.]} fails to match the {{#name}} pattern","string.pattern.invert.base":"{{#label}} with value {:[.]} matches the inverted pattern: {{#regex}}","string.pattern.invert.name":"{{#label}} with value {:[.]} matches the inverted {{#name}} pattern","string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}}),f.addressOptions=function(e){if(!e)return e;if(a(void 0===e.minDomainSegments||Number.isSafeInteger(e.minDomainSegments)&&0<e.minDomainSegments,"minDomainSegments must be a positive integer"),a(void 0===e.maxDomainSegments||Number.isSafeInteger(e.maxDomainSegments)&&0<e.maxDomainSegments,"maxDomainSegments must be a positive integer"),!1===e.tlds)return e;if(!0===e.tlds||void 0===e.tlds)return a(f.tlds,"Built-in TLD list disabled"),Object.assign({},e,f.tlds);a("object"==typeof e.tlds,"tlds must be true, false, or an object");var t=e.tlds.deny;return t?(Array.isArray(t)&&(e=Object.assign({},e,{tlds:{deny:new Set(t)}})),a(e.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),a(!e.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),f.validateTlds(e.tlds.deny,"tlds.deny"),e):(t=e.tlds.allow)?!0===t?(a(f.tlds,"Built-in TLD list disabled"),Object.assign({},e,f.tlds)):(Array.isArray(t)&&(e=Object.assign({},e,{tlds:{allow:new Set(t)}})),a(e.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),f.validateTlds(e.tlds.allow,"tlds.allow"),e):e},f.validateTlds=function(e,t){for(const r of e)a(o.isValid(r,{minDomainSegments:1,maxDomainSegments:1}),"".concat(t," must contain valid top level domain names"))},f.isoDate=function(e){if(!p.isIsoDate(e))return null;/.*T.*[+-]\d\d$/.test(e)&&(e+="00");e=new Date(e);return isNaN(e.getTime())?null:e.toISOString()},f.length=function(e,t,r,i,s){return a(!s||!1,"Invalid encoding:",s),e.$_addRule({name:t,method:"length",args:{limit:r,encoding:s},operator:i})}},8826:(e,t,r)=>{"use strict";const n=r(375),i=r(8068),s={};s.Map=class extends Map{slice(){return new s.Map(this)}},e.exports=i.extend({type:"symbol",terms:{map:{init:new s.Map}},coerce:{method(e,{schema:t,error:r}){var i=t.$_terms.map.get(e);return i&&(e=i),t._flags.only&&"symbol"!=typeof e?{value:e,errors:r("symbol.map",{map:t.$_terms.map})}:{value:e}}},validate(e,{error:t}){if("symbol"!=typeof e)return{value:e,errors:t("symbol.base")}},rules:{map:{method(e){e&&!e[Symbol.iterator]&&"object"==typeof e&&(e=Object.entries(e)),n(e&&e[Symbol.iterator],"Iterable must be an iterable or object");var t=this.clone(),r=[];for(const i of e){n(i&&i[Symbol.iterator],"Entry must be an iterable");const[e,s]=i;n("object"!=typeof e&&"function"!=typeof e&&"symbol"!=typeof e,"Key must not be of type object, function, or Symbol"),n("symbol"==typeof s,"Value must be a Symbol"),t.$_terms.map.set(e,s),r.push(s)}return t.valid(...r)}}},manifest:{build:(e,t)=>e=t.map?e.map(t.map):e},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}})},8863:(e,a,t)=>{"use strict";const o=t(375),c=t(8571),r=t(738),l=t(9621),p=t(8160),u=t(6354),d=t(493),f={result:Symbol("result")};a.entry=function(e,t,r){let i=p.defaults;r&&(o(void 0===r.warnings,"Cannot override warnings preference in synchronous validation"),o(void 0===r.artifacts,"Cannot override artifacts preference in synchronous validation"),i=p.preferences(p.defaults,r));r=f.entry(e,t,i),o(!r.mainstay.externals.length,"Schema with external rules must use validateAsync()"),e={value:r.value};return r.error&&(e.error=r.error),r.mainstay.warnings.length&&(e.warning=u.details(r.mainstay.warnings)),r.mainstay.debug&&(e.debug=r.mainstay.debug),r.mainstay.artifacts&&(e.artifacts=r.mainstay.artifacts),e},a.entryAsync=async function(s,n,a){let o=p.defaults;a&&(o=p.preferences(p.defaults,a));const c=f.entry(s,n,o),e=c.mainstay;if(c.error)throw e.debug&&(c.error.debug=e.debug),c.error;if(e.externals.length){let i=c.value;for(const{method:n,path:c,label:p}of e.externals){let e,t,r=i;c.length&&(e=c[c.length-1],t=l(i,c.slice(0,-1)),r=t[e]);try{const o=await n(r,{prefs:a});void 0!==o&&o!==r&&(t?t[e]=o:i=o)}catch(s){throw o.errors.label&&(s.message+=" (".concat(p,")")),s}}c.value=i}return o.warnings||o.debug||o.artifacts?(n={value:c.value},e.warnings.length&&(n.warning=u.details(e.warnings)),e.debug&&(n.debug=e.debug),e.artifacts&&(n.artifacts=e.artifacts),n):c.value},f.entry=function(e,t,r){var{tracer:i,cleanup:s}=f.tracer(t,r),i={externals:[],warnings:[],tracer:i,debug:r.debug?[]:null,links:t._ids._schemaChain?new Map:null},n=t._ids._schemaChain?[{schema:t}]:null,n=new d([],[],{mainstay:i,schemas:n}),n=a.validate(e,t,n,r),s=(s&&t.$_root.untrace(),u.process(n.errors,e,r));return{value:n.value,error:s,mainstay:i}},f.tracer=function(e,t){return e.$_root._tracer?{tracer:e.$_root._tracer._register(e)}:t.debug?(o(e.$_root.trace,"Debug mode not supported"),{tracer:e.$_root.trace()._register(e),cleanup:!0}):{tracer:f.ignore}},a.validate=function(i,s,n,a,e={}){if((s=s.$_terms.whens?s._generate(i,n,a).schema:s)._preferences&&(a=f.prefs(s,a)),s._cache&&a.cache){const a=s._cache.get(i);if(n.mainstay.tracer.debug(n,"validate","cached",!!a),a)return a}const o=(e,t,r)=>s.$_createError(e,i,t,r||n,a),t={original:i,prefs:a,schema:s,state:n,error:o,errorsArray:f.errorsArray,warn:(e,t,r)=>n.mainstay.warnings.push(o(e,t,r)),message:(e,t)=>s.$_createError("custom",i,t,n,a,{messages:e})};n.mainstay.tracer.entry(s,n);var r=s._definition;if(r.prepare&&void 0!==i&&a.convert){const s=r.prepare(i,t);if(s){if(n.mainstay.tracer.value(n,"prepare",i,s.value),s.errors)return f.finalize(s.value,[].concat(s.errors),t);i=s.value}}if(r.coerce&&void 0!==i&&a.convert&&(!r.coerce.from||r.coerce.from.includes(typeof i))){const s=r.coerce.method(i,t);if(s){if(n.mainstay.tracer.value(n,"coerced",i,s.value),s.errors)return f.finalize(s.value,[].concat(s.errors),t);i=s.value}}var c=s._flags.empty,c=(c&&c.$_match(f.trim(i,s),n.nest(c),p.defaults)&&(n.mainstay.tracer.value(n,"empty",i,void 0),i=void 0),e.presence||s._flags.presence||(s._flags._endedSwitch?null:a.presence));if(void 0===i){if("forbidden"===c)return f.finalize(i,null,t);if("required"===c)return f.finalize(i,[s.$_createError("any.required",i,null,n,a)],t);if("optional"===c){if(s._flags.default!==p.symbols.deepDefault)return f.finalize(i,null,t);n.mainstay.tracer.value(n,"default",i,{}),i={}}}else if("forbidden"===c)return f.finalize(i,[s.$_createError("any.unknown",i,null,n,a)],t);c=[];if(s._valids){const e=s._valids.get(i,n,a,s._flags.insensitive);if(e)return a.convert&&(n.mainstay.tracer.value(n,"valids",i,e.value),i=e.value),n.mainstay.tracer.filter(s,n,"valid",e),f.finalize(i,null,t);if(s._flags.only){const e=s.$_createError("any.only",i,{valids:s._valids.values({display:!0})},n,a);if(a.abortEarly)return f.finalize(i,[e],t);c.push(e)}}if(s._invalids){const e=s._invalids.get(i,n,a,s._flags.insensitive);if(e){n.mainstay.tracer.filter(s,n,"invalid",e);const o=s.$_createError("any.invalid",i,{invalids:s._invalids.values({display:!0})},n,a);if(a.abortEarly)return f.finalize(i,[o],t);c.push(o)}}if(r.validate){const s=r.validate(i,t);if(s&&(n.mainstay.tracer.value(n,"base",i,s.value),i=s.value,s.errors)){if(!Array.isArray(s.errors))return c.push(s.errors),f.finalize(i,c,t);if(s.errors.length)return c.push(...s.errors),f.finalize(i,c,t)}}return s._rules.length?f.rules(i,c,t):f.finalize(i,c,t)},f.rules=function(r,i,s){var{schema:n,state:a,prefs:o}=s;for(const u of n._rules){var c=n._definition.rules[u.method];if(c.convert&&o.convert)a.mainstay.tracer.log(n,a,"rule",u.name,"full");else{let e,t=u.args;if(u._resolve.length){t=Object.assign({},t);for(const i of u._resolve){const s=c.argsByName.get(i),d=t[i].resolve(r,a,o),f=s.normalize?s.normalize(d):d,h=p.validateArg(f,null,s);if(h){e=n.$_createError("any.ref",d,{arg:i,ref:t[i],reason:h},a,o);break}t[i]=f}}e=e||c.validate(r,s,t,u);var l=f.rule(e,u);if(l.errors)if(a.mainstay.tracer.log(n,a,"rule",u.name,"error"),u.warn)a.mainstay.warnings.push(...l.errors);else{if(o.abortEarly)return f.finalize(r,l.errors,s);i.push(...l.errors)}else a.mainstay.tracer.log(n,a,"rule",u.name,"pass"),a.mainstay.tracer.value(a,"rule",r,l.value,u.name),r=l.value}}return f.finalize(r,i,s)},f.rule=function(e,t){return e instanceof u.Report?(f.error(e,t),{errors:[e],value:null}):Array.isArray(e)&&e[p.symbols.errors]?(e.forEach(e=>f.error(e,t)),{errors:e,value:null}):{errors:null,value:e}},f.error=function(e,t){return t.message&&e._setTemplate(t.message),e},f.finalize=function(e,t,r){var{schema:i,state:s,prefs:n}=r;if((t=t||[]).length){const o=f.default("failover",void 0,t,r);void 0!==o&&(s.mainstay.tracer.value(s,"failover",e,o),e=o,t=[])}if(t.length&&i._flags.error)if("function"==typeof i._flags.error){t=i._flags.error(t);for(const e of t=Array.isArray(t)?t:[t])o(e instanceof Error||e instanceof u.Report,"error() must return an Error object")}else t=[i._flags.error];if(void 0===e){const o=f.default("default",e,t,r);s.mainstay.tracer.value(s,"default",e,o),e=o}if(i._flags.cast&&void 0!==e){const t=i._definition.cast[i._flags.cast];if(t.from(e)){const o=t.to(e,r);s.mainstay.tracer.value(s,"cast",e,o,i._flags.cast),e=o}}if(i.$_terms.externals&&n.externals&&!1!==n._externals)for(const{method:e}of i.$_terms.externals)s.mainstay.externals.push({method:e,path:s.path,label:u.label(i._flags,s,n)});t={value:e,errors:t.length?t:null};return i._flags.result&&(t.value="strip"===i._flags.result?void 0:r.original,s.mainstay.tracer.value(s,i._flags.result,e,t.value),s.shadow(e,i._flags.result)),i._cache&&!1!==n.cache&&!i._refs.length&&i._cache.set(r.original,t),void 0===e||t.errors||void 0===i._flags.artifact||(s.mainstay.artifacts=s.mainstay.artifacts||new Map,s.mainstay.artifacts.has(i._flags.artifact)||s.mainstay.artifacts.set(i._flags.artifact,[]),s.mainstay.artifacts.get(i._flags.artifact).push(s.path)),t},f.prefs=function(e,t){var r=t===p.defaults;return r&&e._preferences[p.symbols.prefs]?e._preferences[p.symbols.prefs]:(t=p.preferences(t,e._preferences),r&&(e._preferences[p.symbols.prefs]=t),t)},f.default=function(e,t,r,i){var{schema:s,state:n,prefs:a}=i,o=s._flags[e];if(a.noDefaults||void 0===o)return t;if(n.mainstay.tracer.log(s,n,"rule",e,"full"),!o)return o;if("function"==typeof o){const t=o.length?[c(n.ancestors[0]),i]:[];try{return o(...t)}catch(t){return void r.push(s.$_createError("any.".concat(e),null,{error:t},n,a))}}return"object"!=typeof o?o:o[p.symbols.literal]?o.literal:p.isResolvable(o)?o.resolve(t,n,a):c(o)},f.trim=function(e,t){return"string"==typeof e&&(t=t.$_getRule("trim"))&&t.args.enabled?e.trim():e},f.ignore={active:!1,debug:r,entry:r,filter:r,log:r,resolve:r,value:r},f.errorsArray=function(){var e=[];return e[p.symbols.errors]=!0,e}},2036:(e,t,r)=>{"use strict";const i=r(375),a=r(9474),s=r(8160),n={};e.exports=n.Values=class{constructor(e,t){this._values=new Set(e),this._refs=new Set(t),this._lowercase=n.lowercases(e),this._override=!1}get length(){return this._values.size+this._refs.size}add(e,t){s.isResolvable(e)?this._refs.has(e)||(this._refs.add(e),t&&t.register(e)):this.has(e,null,null,!1)||(this._values.add(e),"string"==typeof e&&this._lowercase.set(e.toLowerCase(),e))}static merge(e,t,r){if(e=e||new n.Values,t){if(t._override)return t.clone();for(const r of[...t._values,...t._refs])e.add(r)}if(r)for(const t of[...r._values,...r._refs])e.remove(t);return e.length?e:null}remove(e){s.isResolvable(e)?this._refs.delete(e):(this._values.delete(e),"string"==typeof e&&this._lowercase.delete(e.toLowerCase()))}has(e,t,r,i){return!!this.get(e,t,r,i)}get(e,t,r,i){if(this.length){if(this._values.has(e))return{value:e};if("string"==typeof e&&e&&i){const t=this._lowercase.get(e.toLowerCase());if(t)return{value:t}}if(this._refs.size||"object"==typeof e){if("object"==typeof e)for(const t of this._values)if(a(t,e))return{value:t};if(t)for(const n of this._refs){var s=n.resolve(e,t,r,null,{in:!0});if(void 0!==s)for(const t of n.in&&"object"==typeof s?Array.isArray(s)?s:Object.keys(s):[s])if(typeof t==typeof e)if(i&&e&&"string"==typeof e){if(t.toLowerCase()===e.toLowerCase())return{value:t,ref:n}}else if(a(t,e))return{value:t,ref:n}}}}return!1}override(){this._override=!0}values(e){if(e&&e.display){const e=[];for(const t of[...this._values,...this._refs])void 0!==t&&e.push(t);return e}return Array.from([...this._values,...this._refs])}clone(){var e=new n.Values(this._values,this._refs);return e._override=this._override,e}concat(e){i(!e._override,"Cannot concat override set of values");e=new n.Values([...this._values,...e._values],[...this._refs,...e._refs]);return e._override=this._override,e}describe(){var e=[];this._override&&e.push({override:!0});for(const t of this._values.values())e.push(t&&"object"==typeof t?{value:t}:t);for(const r of this._refs.values())e.push(r.describe());return e}},n.Values.prototype[s.symbols.values]=!0,n.Values.prototype.slice=n.Values.prototype.clone,n.lowercases=function(e){var t=new Map;if(e)for(const r of e)"string"==typeof r&&t.set(r.toLowerCase(),r);return t}},978:(e,t,r)=>{"use strict";const c=r(375),l=r(8571),u=r(1687),d=r(9621),h={};e.exports=function(e,t,r={}){return c(e&&"object"==typeof e,"Invalid defaults value: must be an object"),c(!t||!0===t||"object"==typeof t,"Invalid source value: must be true, falsy or an object"),c("object"==typeof r,"Invalid options: must be an object"),t?r.shallow?h.applyToDefaultsWithShallow(e,t,r):(e=l(e),!0===t?e:(r=void 0!==r.nullOverride&&r.nullOverride,u(e,t,{nullOverride:r,mergeArrays:!1}))):null},h.applyToDefaultsWithShallow=function(e,t,r){var i,s=r.shallow,n=(c(Array.isArray(s),"Invalid keys"),new Map),a=!0===t?null:new Set;for(i of s){i=Array.isArray(i)?i:i.split(".");const c=d(e,i);c&&"object"==typeof c?n.set(c,a&&d(t,i)||c):a&&a.add(i)}var o=l(e,{},n);if(!a)return o;for(const e of a)h.reachCopy(o,t,e);s=void 0!==r.nullOverride&&r.nullOverride;return u(o,t,{nullOverride:s,mergeArrays:!1})},h.reachCopy=function(e,t,r){for(const e of r){if(!(e in t))return;const r=t[e];if("object"!=typeof r||null===r)return;t=r}var i=t;let s=e;for(let e=0;e<r.length-1;++e){const t=r[e];"object"!=typeof s[t]&&(s[t]={}),s=s[t]}s[r[r.length-1]]=i}},375:(e,t,r)=>{"use strict";const i=r(7916);e.exports=function(e,...t){if(!e){if(1===t.length&&t[0]instanceof Error)throw t[0];throw new i(t)}}},8571:(e,t,r)=>{"use strict";const s=r(9621),o=r(4277),c=r(7043),l={needsProtoHack:new Set([o.set,o.map,o.weakSet,o.weakMap])};e.exports=l.clone=function(e,t={},r=null){if("object"!=typeof e||null===e)return e;let i=l.clone,s=r;if(t.shallow){if(!0!==t.shallow)return l.cloneWithShallow(e,t);i=e=>e}else if(s){const t=s.get(e);if(t)return t}else s=new Map;var n=o.getInternalProto(e);if(n===o.buffer)return!1;if(n===o.date)return new Date(e.getTime());if(n===o.regex)return new RegExp(e);var a=l.base(e,n,t);if(a===e)return e;if(s&&s.set(e,a),n===o.set)for(const r of e)a.add(i(r,t,s));else if(n===o.map)for(const[r,o]of e)a.set(r,i(o,t,s));for(const r of c.keys(e,t))if("__proto__"!==r)if(n===o.array&&"length"===r)a.length=e.length;else{const c=Object.getOwnPropertyDescriptor(e,r);c?c.get||c.set?Object.defineProperty(a,r,c):c.enumerable?a[r]=i(e[r],t,s):Object.defineProperty(a,r,{enumerable:!1,writable:!0,configurable:!0,value:i(e[r],t,s)}):Object.defineProperty(a,r,{enumerable:!0,writable:!0,configurable:!0,value:i(e[r],t,s)})}return a},l.cloneWithShallow=function(e,t){const r=t.shallow;(t=Object.assign({},t)).shallow=!1;var i=new Map;for(const t of r){const r=s(e,t);"object"!=typeof r&&"function"!=typeof r||i.set(r,r)}return l.clone(e,t,i)},l.base=function(e,t,r){if(!1===r.prototype)return l.needsProtoHack.has(t)?new t.constructor:t===o.array?[]:{};r=Object.getPrototypeOf(e);if(r&&r.isImmutable)return e;if(t===o.array){const e=[];return r!==t&&Object.setPrototypeOf(e,r),e}if(l.needsProtoHack.has(t)){const e=new r.constructor;return r!==t&&Object.setPrototypeOf(e,r),e}return Object.create(r)}},9474:(e,t,r)=>{"use strict";const d=r(4277),h={mismatched:null};e.exports=function(e,t,r){return r=Object.assign({prototype:!0},r),!!h.isDeepEqual(e,t,r,[])},h.isDeepEqual=function(t,r,e,i){if(t===r)return 0!==t||1/t==1/r;var s=typeof t;if(s!=typeof r)return!1;if(null===t||null===r)return!1;if("function"==s){if(!e.deepFunction||t.toString()!==r.toString())return!1}else if("object"!=s)return t!=t&&r!=r;s=h.getSharedType(t,r,!!e.prototype);switch(s){case d.buffer:return!1;case d.promise:return t===r;case d.regex:return t.toString()===r.toString();case h.mismatched:return!1}for(let e=i.length-1;0<=e;--e)if(i[e].isSame(t,r))return!0;i.push(new h.SeenEntry(t,r));try{return!!h.isDeepEqualObj(s,t,r,e,i)}finally{i.pop()}},h.getSharedType=function(e,t,r){return r?Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?h.mismatched:d.getInternalProto(e):(r=d.getInternalProto(e))!==d.getInternalProto(t)?h.mismatched:r},h.valueOf=function(e){var t=e.valueOf;if(void 0===t)return e;try{return t.call(e)}catch(e){return e}},h.hasOwnEnumerableProperty=function(e,t){return Object.prototype.propertyIsEnumerable.call(e,t)},h.isSetSimpleEqual=function(e,t){for(const r of Set.prototype.values.call(e))if(!Set.prototype.has.call(t,r))return!1;return!0},h.isDeepEqualObj=function(t,r,i,s,n){var{isDeepEqual:a,valueOf:e,hasOwnEnumerableProperty:o}=h,{keys:c,getOwnPropertySymbols:l}=Object;if(t===d.array){if(!s.part){if(r.length!==i.length)return!1;for(let e=0;e<r.length;++e)if(!a(r[e],i[e],s,n))return!1;return!0}for(const t of r)for(const r of i)if(a(t,r,s,n))return!0}else if(t===d.set){if(r.size!==i.size)return!1;if(!h.isSetSimpleEqual(r,i)){const t=new Set(Set.prototype.values.call(i));for(const i of Set.prototype.values.call(r))if(!t.delete(i)){let e=!1;for(const d of t)if(a(i,d,s,n)){t.delete(d),e=!0;break}if(!e)return!1}}}else if(t===d.map){if(r.size!==i.size)return!1;for(const[t,d]of Map.prototype.entries.call(r)){if(void 0===d&&!Map.prototype.has.call(i,t))return!1;if(!a(d,Map.prototype.get.call(i,t),s,n))return!1}}else if(t===d.error&&(r.name!==i.name||r.message!==i.message))return!1;t=e(r),e=e(i);if((r!==t||i!==e)&&!a(t,e,s,n))return!1;e=c(r);if(!s.part&&e.length!==c(i).length&&!s.skip)return!1;let u=0;for(const t of e)if(s.skip&&s.skip.includes(t))void 0===i[t]&&++u;else{if(!o(i,t))return!1;if(!a(r[t],i[t],s,n))return!1}if(!s.part&&e.length-u!==c(i).length)return!1;if(!1!==s.symbols){const t=l(r),d=new Set(l(i));for(const h of t){if(!s.skip||!s.skip.includes(h))if(o(r,h)){if(!o(i,h))return!1;if(!a(r[h],i[h],s,n))return!1}else if(o(i,h))return!1;d.delete(h)}for(const t of d)if(o(i,t))return!1}return!0},h.SeenEntry=class{constructor(e,t){this.obj=e,this.ref=t}isSame(e,t){return this.obj===e&&this.ref===t}}},7916:(e,t,r)=>{"use strict";const i=r(8761);e.exports=class extends Error{constructor(e){super(e.filter(e=>""!==e).map(e=>"string"==typeof e?e:e instanceof Error?e.message:i(e)).join(" ")||"Unknown error"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t.assert)}}},5277:e=>{"use strict";const s={};e.exports=function(t){if(!t)return"";let r="";for(let e=0;e<t.length;++e){var i=t.charCodeAt(e);s.isSafe(i)?r+=t[e]:r+=s.escapeHtmlChar(i)}return r},s.escapeHtmlChar=function(e){var t=s.namedHtml[e];return void 0!==t?t:256<=e?"&#"+e+";":(t=e.toString(16).padStart(2,"0"),"&#x".concat(t,";"))},s.isSafe=function(e){return void 0!==s.safeCharCodes[e]},s.namedHtml={38:"&amp;",60:"&lt;",62:"&gt;",34:"&quot;",160:"&nbsp;",162:"&cent;",163:"&pound;",164:"&curren;",169:"&copy;",174:"&reg;"},s.safeCharCodes=function(){var t={};for(let e=32;e<123;++e)(97<=e||65<=e&&e<=90||48<=e&&e<=57||32===e||46===e||44===e||45===e||58===e||95===e)&&(t[e]=null);return t}()},6064:e=>{"use strict";e.exports=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")}},738:e=>{"use strict";e.exports=function(){}},1687:(e,t,r)=>{"use strict";const a=r(375),o=r(8571),c=r(7043),l={};e.exports=l.merge=function(t,r,i){if(a(t&&"object"==typeof t,"Invalid target value: must be an object"),a(null==r||"object"==typeof r,"Invalid source value: must be null, undefined, or an object"),r)if(i=Object.assign({nullOverride:!0,mergeArrays:!0},i),Array.isArray(r)){a(Array.isArray(t),"Cannot merge array onto an object"),i.mergeArrays||(t.length=0);for(let e=0;e<r.length;++e)t.push(o(r[e],{symbols:i.symbols}))}else{var s,n=c.keys(r,i);for(let e=0;e<n.length;++e){const c=n[e];"__proto__"!==c&&Object.prototype.propertyIsEnumerable.call(r,c)&&((s=r[c])&&"object"==typeof s?t[c]!==s&&(!t[c]||"object"!=typeof t[c]||Array.isArray(t[c])!==Array.isArray(s)||s instanceof Date||s instanceof RegExp?t[c]=o(s,{symbols:i.symbols}):l.merge(t[c],s,i)):null==s&&!i.nullOverride||(t[c]=s))}}return t}},9621:(e,t,r)=>{"use strict";const c=r(375),l={};e.exports=function(r,i,s){if(!1===i||null==i)return r;"string"==typeof(s=s||{})&&(s={separator:s});var e=Array.isArray(i),n=(c(!e||!s.separator,"Separator option no valid for array-based chain"),e?i:i.split(s.separator||"."));let a=r;for(let t=0;t<n.length;++t){let e=n[t];var o=s.iterables&&l.iterables(a);if(Array.isArray(a)||"set"===o){const r=Number(e);Number.isInteger(r)&&(e=r<0?a.length+r:r)}if(!a||"function"==typeof a&&!1===s.functions||!o&&void 0===a[e]){c(!s.strict||t+1===n.length,"Missing segment",e,"in reach path ",i),c("object"==typeof a||!0===s.functions||"function"!=typeof a,"Invalid segment",e,"in reach path ",i),a=s.default;break}a=o?"set"===o?[...a][e]:a.get(e):a[e]}return a},l.iterables=function(e){return e instanceof Set?"set":e instanceof Map?"map":void 0}},8761:e=>{"use strict";e.exports=function(...e){try{return JSON.stringify.apply(null,e)}catch(e){return"[Cannot display object: "+e.message+"]"}}},4277:(e,t)=>{"use strict";const r={};t=e.exports={array:Array.prototype,buffer:!1,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype},r.typeMap=new Map([["[object Error]",t.error],["[object Map]",t.map],["[object Promise]",t.promise],["[object Set]",t.set],["[object WeakMap]",t.weakMap],["[object WeakSet]",t.weakSet]]),t.getInternalProto=function(e){return Array.isArray(e)?t.array:e instanceof Date?t.date:e instanceof RegExp?t.regex:e instanceof Error?t.error:(e=Object.prototype.toString.call(e),r.typeMap.get(e)||t.generic)}},7043:(e,t)=>{"use strict";t.keys=function(e,t={}){return!1!==t.symbols?Reflect.ownKeys(e):Object.getOwnPropertyNames(e)}},3652:(e,t,r)=>{"use strict";const a=r(375),i={};t.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(e,t){var r=[].concat((t=t||{}).before||[]),i=[].concat(t.after||[]),s=t.group||"?",n=t.sort||0;a(!r.includes(s),"Item cannot come before itself: ".concat(s)),a(!r.includes("?"),"Item cannot come before unassociated items"),a(!i.includes(s),"Item cannot come after itself: ".concat(s)),a(!i.includes("?"),"Item cannot come after unassociated items");for(const t of e=Array.isArray(e)?e:[e]){const e={seq:this._items.length,sort:n,before:r,after:i,group:s,node:t};this._items.push(e)}if(!t.manual){const e=this._sort();a(e,"item","?"!==s?"added into group ".concat(s):"","created a dependencies error")}return this.nodes}merge(e){for(const t of e=Array.isArray(e)?e:[e])if(t)for(const e of t._items)this._items.push(Object.assign({},e));this._items.sort(i.mergeSort);for(let e=0;e<this._items.length;++e)this._items[e].seq=e;const t=this._sort();return a(t,"merge created a dependencies error"),this.nodes}sort(){var e=this._sort();return a(e,"sort created a dependencies error"),this.nodes}_sort(){const e={},t=Object.create(null),i=Object.create(null);for(const s of this._items){const n=s.seq,r=s.group;i[r]=i[r]||[],i[r].push(n),e[n]=s.before;for(const e of s.after)t[e]=t[e]||[],t[e].push(n)}for(const t in e){const s=[];for(const n in e[t]){const r=e[t][n];i[r]=i[r]||[],s.push(...i[r])}e[t]=s}for(const s in t)if(i[s])for(const n of i[s])e[n].push(...t[s]);const s={};for(const t in e){const i=e[t];for(const e of i)s[e]=s[e]||[],s[e].push(t)}const n={},r=[];for(let t=0;t<this._items.length;++t){let e=t;if(s[t]){e=null;for(let r=0;r<this._items.length;++r)if(!0!==n[r]){s[r]||(s[r]=[]);const i=s[r].length;let t=0;for(let e=0;e<i;++e)n[s[r][e]]&&++t;if(t===i){e=r;break}}}null!==e&&(n[e]=!0,r.push(e))}if(r.length!==this._items.length)return!1;var a={};for(const e of this._items)a[e.seq]=e;this._items=[],this.nodes=[];for(const e of r){const t=a[e];this.nodes.push(t.node),this._items.push(t)}return!0}},i.mergeSort=(e,t)=>e.sort===t.sort?0:e.sort<t.sort?-1:1},5380:(e,r,t)=>{"use strict";const i=t(443),s=t(2178),n={minDomainSegments:2,nonAsciiRx:/[^\x00-\x7f]/,domainControlRx:/[\x00-\x20@\:\/\\#!\$&\'\(\)\*\+,;=\?]/,tldSegmentRx:/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,domainSegmentRx:/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL:i.URL||URL};r.analyze=function(e,t={}){if(!e)return s.code("DOMAIN_NON_EMPTY_STRING");if("string"!=typeof e)throw new Error("Invalid input: domain must be a string");if(256<e.length)return s.code("DOMAIN_TOO_LONG");if(n.nonAsciiRx.test(e)){if(!1===t.allowUnicode)return s.code("DOMAIN_INVALID_UNICODE_CHARS");e=e.normalize("NFC")}if(n.domainControlRx.test(e))return s.code("DOMAIN_INVALID_CHARS");e=n.punycode(e),t.allowFullyQualified&&"."===e[e.length-1]&&(e=e.slice(0,-1));var r=t.minDomainSegments||n.minDomainSegments,i=e.split(".");if(i.length<r)return s.code("DOMAIN_SEGMENTS_COUNT");if(t.maxDomainSegments&&i.length>t.maxDomainSegments)return s.code("DOMAIN_SEGMENTS_COUNT_MAX");r=t.tlds;if(r){const e=i[i.length-1].toLowerCase();if(r.deny&&r.deny.has(e)||r.allow&&!r.allow.has(e))return s.code("DOMAIN_FORBIDDEN_TLDS")}for(let e=0;e<i.length;++e){const t=i[e];if(!t.length)return s.code("DOMAIN_EMPTY_SEGMENT");if(63<t.length)return s.code("DOMAIN_LONG_SEGMENT");if(e<i.length-1){if(!n.domainSegmentRx.test(t))return s.code("DOMAIN_INVALID_CHARS")}else if(!n.tldSegmentRx.test(t))return s.code("DOMAIN_INVALID_TLDS_CHARS")}return null},r.isValid=function(e,t){return!r.analyze(e,t)},n.punycode=function(t){t.includes("%")&&(t=t.replace(/%/g,"%25"));try{return new n.URL("http://".concat(t)).host}catch(e){return t}}},1745:(e,t,r)=>{"use strict";const i=r(9848),n=r(5380),a=r(2178),o={nonAsciiRx:/[^\x00-\x7f]/,encoder:new(i.TextEncoder||TextEncoder)};t.analyze=function(e,t){return o.email(e,t)},t.isValid=function(e,t){return!o.email(e,t)},o.email=function(e,t={}){if("string"!=typeof e)throw new Error("Invalid input: email must be a string");if(!e)return a.code("EMPTY_STRING");var r=!o.nonAsciiRx.test(e);if(!r){if(!1===t.allowUnicode)return a.code("FORBIDDEN_UNICODE");e=e.normalize("NFC")}var i=e.split("@");if(2!==i.length)return 2<i.length?a.code("MULTIPLE_AT_CHAR"):a.code("MISSING_AT_CHAR");var[i,s]=i;if(!i)return a.code("EMPTY_LOCAL");if(!t.ignoreLength){if(254<e.length)return a.code("ADDRESS_TOO_LONG");if(64<o.encoder.encode(i).length)return a.code("LOCAL_TOO_LONG")}return o.local(i,r)||n.analyze(s,t)},o.local=function(e,t){var r=e.split(".");for(const e of r){if(!e.length)return a.code("EMPTY_LOCAL_SEGMENT");if(t){if(!o.atextRx.test(e))return a.code("INVALID_LOCAL_CHARS")}else for(const t of e)if(!o.atextRx.test(t)){const e=o.binary(t);if(!o.atomRx.test(e))return a.code("INVALID_LOCAL_CHARS")}}},o.binary=function(e){return Array.from(o.encoder.encode(e)).map(e=>String.fromCharCode(e)).join("")},o.atextRx=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/,o.atomRx=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"))},2178:(e,t)=>{"use strict";t.codes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_SEGMENTS_COUNT_MAX:"Domain contains too many segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"},t.code=function(e){return{code:e,error:t.codes[e]}}},9959:(e,t,r)=>{"use strict";const s=r(375),n=r(5752);t.regex=function(e={}){s(void 0===e.cidr||"string"==typeof e.cidr,"options.cidr must be a string");const r=e.cidr?e.cidr.toLowerCase():"optional";s(["required","optional","forbidden"].includes(r),"options.cidr must be one of required, optional, forbidden"),s(void 0===e.version||"string"==typeof e.version||Array.isArray(e.version),"options.version must be a string or an array of string");let t=e.version||["ipv4","ipv6","ipvfuture"];Array.isArray(t)||(t=[t]),s(1<=t.length,"options.version must have at least 1 version specified");for(let e=0;e<t.length;++e)s("string"==typeof t[e],"options.version must only contain strings"),t[e]=t[e].toLowerCase(),s(["ipv4","ipv6","ipvfuture"].includes(t[e]),"options.version contains unknown version "+t[e]+" - must be one of ipv4, ipv6, ipvfuture");var e=(t=Array.from(new Set(t))).map(e=>{var t;return"forbidden"===r?n.ip[e]:(t="\\/".concat("ipv4"===e?n.ip.v4Cidr:n.ip.v6Cidr),"required"===r?"".concat(n.ip[e]).concat(t):"".concat(n.ip[e],"(?:").concat(t,")?"))}),e="(?:".concat(e.join("|"),")"),i=new RegExp("^".concat(e,"$"));return{cidr:r,versions:t,regex:i,raw:e}}},5752:(e,t,r)=>{"use strict";const a=r(375),o=r(6064),c={generate:function(){var e={},t="!\\$&'\\(\\)\\*\\+,;=",r="\\w-\\.~%\\dA-Fa-f"+t+":@",i="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])",i=(e.ipv4address="(?:"+i+"\\.){3}"+i,"[\\dA-Fa-f]{1,4}"),s="(?:"+i+":"+i+"|"+e.ipv4address+")",n="(?:"+i+":){6}"+s,a="::(?:"+i+":){5}"+s,o="(?:"+i+")?::(?:"+i+":){4}"+s,c="(?:(?:"+i+":){0,1}"+i+")?::(?:"+i+":){3}"+s,l="(?:(?:"+i+":){0,2}"+i+")?::(?:"+i+":){2}"+s,u="(?:(?:"+i+":){0,3}"+i+")?::"+i+":"+s,i="(?:(?:"+i+":){0,4}"+i+")?::"+s,s=(e.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",e.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",e.ipv6address="(?:"+n+"|"+a+"|"+o+"|"+c+"|"+l+"|"+u+"|"+i+"|(?:(?:[\\dA-Fa-f]{1,4}:){0,5}[\\dA-Fa-f]{1,4})?::[\\dA-Fa-f]{1,4}|(?:(?:[\\dA-Fa-f]{1,4}:){0,6}[\\dA-Fa-f]{1,4})?::)",e.ipvFuture="v[\\dA-Fa-f]+\\.[\\w-\\.~"+t+":]+",e.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",e.schemeRegex=new RegExp(e.scheme),"[\\w-\\.~%\\dA-Fa-f"+t+":]*"),n="(?:\\[(?:"+e.ipv6address+"|"+e.ipvFuture+")\\]|"+e.ipv4address+"|[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=]{1,255})",a="(?:"+s+"@)?"+n+"(?::\\d*)?",o="(?:"+s+"@)?("+n+")(?::\\d*)?",c="[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]+",l="(?:\\/[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*",u="\\/(?:"+c+l+")?",i=c+l,t="[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=@]+"+l;return e.hierPart="(?:(?:\\/\\/"+a+l+")|"+u+"|"+i+"|(?:\\/\\/\\/[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*(?:\\/[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*))",e.hierPartCapture="(?:(?:\\/\\/"+o+l+")|"+u+"|"+i+")",e.relativeRef="(?:(?:\\/\\/"+a+l+")|"+u+"|"+t+"|)",e.relativeRefCapture="(?:(?:\\/\\/"+o+l+")|"+u+"|"+t+"|)",e.query="["+r+"\\/\\?]*(?=#|$)",e.queryWithSquareBrackets="["+r+"\\[\\]\\/\\?]*(?=#|$)",e.fragment="["+r+"\\/\\?]*",e}};c.rfc3986=c.generate(),t.ip={v4Cidr:c.rfc3986.ipv4Cidr,v6Cidr:c.rfc3986.ipv6Cidr,ipv4:c.rfc3986.ipv4address,ipv6:c.rfc3986.ipv6address,ipvfuture:c.rfc3986.ipvFuture},c.createRegex=function(e){const t=c.rfc3986,r="(?:\\?"+(e.allowQuerySquareBrackets?t.queryWithSquareBrackets:t.query)+")?(?:#"+t.fragment+")?",i=e.domain?t.relativeRefCapture:t.relativeRef;if(e.relativeOnly)return c.wrap(i+r);let s="";if(e.scheme){a(e.scheme instanceof RegExp||"string"==typeof e.scheme||Array.isArray(e.scheme),"scheme must be a RegExp, String, or Array");const r=[].concat(e.scheme),c=(a(1<=r.length,"scheme must have at least 1 scheme specified"),[]);for(let e=0;e<r.length;++e){const i=r[e];a(i instanceof RegExp||"string"==typeof i,"scheme at position "+e+" must be a RegExp or String"),i instanceof RegExp?c.push(i.source.toString()):(a(t.schemeRegex.test(i),"scheme at position "+e+" must be a valid scheme"),c.push(o(i)))}s=c.join("|")}var n="(?:"+(s?"(?:"+s+")":t.scheme)+":"+(e.domain?t.hierPartCapture:t.hierPart)+")",e=e.allowRelative?"(?:"+n+"|"+i+")":n;return c.wrap(e+r,s)},c.wrap=function(e,t){return{raw:e="(?=.)(?!https?:/(?:$|[^/]))(?!https?:///)(?!https?:[^/])".concat(e),regex:new RegExp("^".concat(e,"$")),scheme:t}},c.uriRegex=c.createRegex({}),t.regex=function(e={}){return e.scheme||e.allowRelative||e.relativeOnly||e.allowQuerySquareBrackets||e.domain?c.createRegex(e):c.uriRegex}},1447:(e,o)=>{"use strict";const c={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*\.?[0-9]*){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};o.Parser=class{constructor(e,t={}){if(!t[c.settings]&&t.constants)for(const e in t.constants){const c=t.constants[e];if(null!==c&&!["boolean","number","string"].includes(typeof c))throw new Error("Formula constant ".concat(e," contains invalid ").concat(typeof c," value type"))}this.settings=t[c.settings]?t:Object.assign({[c.settings]:!0,constants:{},functions:{}},t),this.single=null,this._parts=null,this._parse(e)}_parse(e){let r=[],i="",s=0,n=!1;var t=e=>{if(s)throw new Error("Formula missing closing parenthesis");var t=r.length?r[r.length-1]:null;if(n||i||e){if(t&&"reference"===t.type&&")"===e)t.type="function",t.value=this._subFormula(i,t.value);else if(")"===e){const e=new o.Parser(i,this.settings);r.push({type:"segment",value:e})}else if(n){if("]"===n)return r.push({type:"reference",value:i}),void(i="");r.push({type:"literal",value:i})}else if(c.operatorCharacters.includes(i))t&&"operator"===t.type&&c.operators.includes(t.value+i)?t.value+=i:r.push({type:"operator",value:i});else if(i.match(c.numberRx))r.push({type:"constant",value:parseFloat(i)});else if(void 0!==this.settings.constants[i])r.push({type:"constant",value:this.settings.constants[i]});else{if(!i.match(c.tokenRx))throw new Error("Formula contains invalid token: ".concat(i));r.push({type:"reference",value:i})}i=""}};for(const o of e)n?o===n?(t(),n=!1):i+=o:s?"("===o?(i+=o,++s):")"!==o||(--s,s)?i+=o:t(o):o in c.literals?n=c.literals[o]:"("===o?(t(),++s):c.operatorCharacters.includes(o)?(t(),i=o,t()):" "!==o?i+=o:t();t();let a=!1;for(const e of r=r.map((e,t)=>"operator"!==e.type||"-"!==e.value||t&&"operator"!==r[t-1].type?e:{type:"operator",value:"n"})){if("operator"===e.type){if(c.operatorsPrefix.includes(e.value))continue;if(!a)throw new Error("Formula contains an operator in invalid position");if(!c.operators.includes(e.value))throw new Error("Formula contains an unknown operator ".concat(e.value))}else if(a)throw new Error("Formula missing expected operator");a=!a}if(!a)throw new Error("Formula contains invalid trailing operator");1===r.length&&["reference","literal","constant"].includes(r[0].type)&&(this.single={type:"reference"===r[0].type?"reference":"value",value:r[0].value}),this._parts=r.map(e=>{if("operator"===e.type)return c.operatorsPrefix.includes(e.value)?e:e.value;if("reference"!==e.type)return e.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(e.value))throw new Error("Formula contains invalid reference ".concat(e.value));return(this.settings.reference?this.settings:c).reference(e.value)})}_subFormula(s,e){const i=this.settings.functions[e];if("function"!=typeof i)throw new Error("Formula contains unknown function ".concat(e));let n=[];if(s){let t="",r=0,i=!1;var a=()=>{if(!t)throw new Error("Formula contains function ".concat(e," with invalid arguments ").concat(s));n.push(t),t=""};for(let e=0;e<s.length;++e){const n=s[e];i?(t+=n,n===i&&(i=!1)):n in c.literals&&!r?(t+=n,i=c.literals[n]):","!==n||r?(t+=n,"("===n?++r:")"===n&&--r):a()}a()}return n=n.map(e=>new o.Parser(e,this.settings)),function(e){var t=[];for(const r of n)t.push(r.evaluate(e));return i.call(e,...t)}}evaluate(n){const a=this._parts.slice();for(let e=a.length-2;0<=e;--e){var t,r=a[e];r&&"operator"===r.type&&(t=a[e+1],a.splice(e+1,1),t=c.evaluate(t,n),a[e]=c.single(r.value,t))}return c.operatorsOrder.forEach(t=>{for(let e=1;e<a.length-1;)if(t.includes(a[e])){const t=a[e],i=c.evaluate(a[e-1],n),s=c.evaluate(a[e+1],n);a.splice(e,2);var r=c.calculate(t,i,s);a[e-1]=0===r?0:r}else e+=2}),c.evaluate(a[0],n)}},o.Parser.prototype[c.symbol]=!0,c.reference=function(t){return function(e){return e&&void 0!==e[t]?e[t]:null}},c.evaluate=function(e,t){return null===e?null:"function"==typeof e?e(t):e[c.symbol]?e.evaluate(t):e},c.single=function(e,t){return"!"===e?!t:0==(e=-t)?0:e},c.calculate=function(e,t,r){if("??"===e)return c.exists(t)?t:r;if("string"==typeof t||"string"==typeof r){if("+"===e)return(t=c.exists(t)?t:"")+(c.exists(r)?r:"")}else switch(e){case"^":return Math.pow(t,r);case"*":return t*r;case"/":return t/r;case"%":return t%r;case"+":return t+r;case"-":return t-r}switch(e){case"<":return t<r;case"<=":return t<=r;case">":return r<t;case">=":return r<=t;case"==":return t===r;case"!=":return t!==r;case"&&":return t&&r;case"||":return t||r}return null},c.exists=function(e){return null!=e}},9926:()=>{},5688:()=>{},9708:()=>{},1152:()=>{},443:()=>{},9848:()=>{}},s={},function e(t){var r=s[t];return void 0!==r||(r=s[t]={exports:{}},i[t](r,r.exports,e)),r.exports}(5107))},520:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PersistentMemoryService=void 0;t.PersistentMemoryService=class{constructor(){this.data={}}init(){}set(e){this.data=Object.assign(Object.assign({},this.data),e)}get(){return this.data}}},521:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="persistent-memory"},522:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.ChainsService=void 0;const i=r(523),s=r(27),a=r(3),o=r(229),c=r(16),l=r(525);t.ChainsService=class{constructor(e,t,r={}){this.kvStore=e,this.embedChainInfos=t,this.experimentalOptions=r,this.onChainRemovedHandlers=[],this.getChainInfos=s.Debouncer.promise(()=>n(this,void 0,void 0,function*(){if(this.cachedChainInfos)return this.cachedChainInfos;var e=this.embedChainInfos.map(e=>Object.assign(Object.assign({},e),{embeded:!0}));const t=new Map;for(const s of e)t.set(c.ChainIdHelper.parse(s.chainId).identifier,!0);var r=(yield this.getSuggestedChainInfos()).filter(e=>!t.get(c.ChainIdHelper.parse(e.chainId).identifier)).map(e=>Object.assign(Object.assign({},e),{embeded:!1}));let i=e.concat(r);return i=yield Promise.all(i.map(t=>n(this,void 0,void 0,function*(){var e=yield this.chainUpdaterService.putUpdatedPropertyToChainInfo(t);return Object.assign(Object.assign({},e),{embeded:t.embeded})}))),this.cachedChainInfos=i})),null!=r&&r.useMemoryKVStoreForSuggestChain?this.kvStoreForSuggestChain=new s.MemoryKVStore("suggest-chain"):this.kvStoreForSuggestChain=e}init(e,t,r){this.chainUpdaterService=e,this.interactionService=t,this.permissionService=r}clearCachedChainInfos(){this.cachedChainInfos=void 0}getChainInfo(t){return n(this,void 0,void 0,function*(){var e=(yield this.getChainInfos()).find(e=>c.ChainIdHelper.parse(e.chainId).identifier===c.ChainIdHelper.parse(t).identifier);if(e)return e;throw new a.KeplrError("chains",411,"There is no chain info for "+t)})}getChainCoinType(t){return n(this,void 0,void 0,function*(){var e=yield this.getChainInfo(t);if(e)return e.bip44.coinType;throw new a.KeplrError("chains",411,"There is no chain info for "+t)})}hasChainInfo(t){return n(this,void 0,void 0,function*(){return null!=(yield this.getChainInfos()).find(e=>c.ChainIdHelper.parse(e.chainId).identifier===c.ChainIdHelper.parse(t).identifier)})}suggestChainInfo(e,t,r){return n(this,void 0,void 0,function*(){t=yield i.ChainInfoSchema.validateAsync(t,{stripUnknown:!0}),yield this.interactionService.waitApprove(e,"/suggest-chain",o.SuggestChainInfoMsg.type(),Object.assign(Object.assign({},t),{origin:r})),yield this.permissionService.addPermission([t.chainId],l.getBasicAccessPermissionType(),[r]),yield this.addChainInfo(t)})}getSuggestedChainInfos(){var e;return n(this,void 0,void 0,function*(){return null!=(e=yield this.kvStoreForSuggestChain.get("chain-infos"))?e:[]})}addChainInfo(t){var r;return n(this,void 0,void 0,function*(){if(yield this.hasChainInfo(t.chainId))throw new a.KeplrError("chains",121,"Same chain is already registered");var e=null!=(r=yield this.kvStoreForSuggestChain.get("chain-infos"))?r:[];e.push(t),yield this.kvStoreForSuggestChain.set("chain-infos",e),this.clearCachedChainInfos()})}removeChainInfo(r){var i;return n(this,void 0,void 0,function*(){if(!(yield this.hasChainInfo(r)))throw new a.KeplrError("chains",120,"Chain is not registered");if((yield this.getChainInfo(r)).embeded)throw new a.KeplrError("chains",122,"Can't remove the embedded chain");var e=(null!=(i=yield this.kvStoreForSuggestChain.get("chain-infos"))?i:[]).filter(e=>c.ChainIdHelper.parse(e.chainId).identifier!==c.ChainIdHelper.parse(r).identifier);yield this.kvStoreForSuggestChain.set("chain-infos",e),yield this.chainUpdaterService.clearUpdatedProperty(r);for(const t of this.onChainRemovedHandlers)t(r,c.ChainIdHelper.parse(r).identifier);this.clearCachedChainInfos()})}getChainEthereumKeyFeatures(t){var r;return n(this,void 0,void 0,function*(){var e=yield this.getChainInfo(t);return{address:null!=(r=null==(r=e.features)?void 0:r.includes("eth-address-gen"))&&r,signing:null!=(r=null==(r=e.features)?void 0:r.includes("eth-key-sign"))&&r}})}addChainRemovedHandler(e){this.onChainRemovedHandlers.push(e)}}},523:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChainInfoSchema=t.SuggestingBIP44Schema=t.Bech32ConfigSchema=t.FeeCurrencySchema=t.Secret20CurrencySchema=t.CW20CurrencySchema=t.CurrencySchema=void 0;const s=r(3);i=i(r(41)),t.CurrencySchema=i.default.object({coinDenom:i.default.string().required(),coinMinimalDenom:i.default.string().required(),coinDecimals:i.default.number().integer().min(0).max(18).required(),coinGeckoId:i.default.string(),coinImageUrl:i.default.string().uri()}),t.CW20CurrencySchema=t.CurrencySchema.keys({type:i.default.string().equal("cw20").required(),contractAddress:i.default.string().required()}).custom(e=>e.coinMinimalDenom.startsWith(`${e.type}:${e.contractAddress}:`)?e:Object.assign(Object.assign({},e),{coinMinimalDenom:`${e.type}:${e.contractAddress}:`+e.coinMinimalDenom})),t.Secret20CurrencySchema=t.CurrencySchema.keys({type:i.default.string().equal("secret20").required(),contractAddress:i.default.string().required(),viewingKey:i.default.string().required()}).custom(e=>e.coinMinimalDenom.startsWith(`${e.type}:${e.contractAddress}:`)?e:Object.assign(Object.assign({},e),{coinMinimalDenom:`${e.type}:${e.contractAddress}:`+e.coinMinimalDenom})),r=i.default.object({low:i.default.number().required(),average:i.default.number().required(),high:i.default.number().required()}).custom(e=>{if(e.low>e.average)throw new Error("Low gas price step can not be greater than average");if(e.average>e.high)throw new Error("Average gas price step can not be greater than high");return e});t.FeeCurrencySchema=t.CurrencySchema.keys({gasPriceStep:r}),t.Bech32ConfigSchema=i.default.object({bech32PrefixAccAddr:i.default.string().required(),bech32PrefixAccPub:i.default.string().required(),bech32PrefixValAddr:i.default.string().required(),bech32PrefixValPub:i.default.string().required(),bech32PrefixConsAddr:i.default.string().required(),bech32PrefixConsPub:i.default.string().required()}),t.SuggestingBIP44Schema=i.default.object({coinType:i.default.number().integer().min(0).required()}).unknown(!0),t.ChainInfoSchema=i.default.object({rpc:i.default.string().required().uri(),rest:i.default.string().required().uri(),chainId:i.default.string().required().min(1).max(30),chainName:i.default.string().required().min(1).max(30),stakeCurrency:t.CurrencySchema.required(),walletUrl:i.default.string().uri(),walletUrlForStaking:i.default.string().uri(),bip44:t.SuggestingBIP44Schema.required(),bech32Config:t.Bech32ConfigSchema.required(),currencies:i.default.array().min(1).items(t.CurrencySchema,t.CW20CurrencySchema,t.Secret20CurrencySchema).custom(e=>{var t={};for(const r of e){if(t[r.coinMinimalDenom])throw new Error(r.coinMinimalDenom+" is duplicated");t[r.coinMinimalDenom]=!0}return e}).required(),feeCurrencies:i.default.array().min(1).items(t.FeeCurrencySchema).custom(e=>{var t={};for(const r of e){if(t[r.coinMinimalDenom])throw new Error(r.coinMinimalDenom+" is duplicated");t[r.coinMinimalDenom]=!0}return e}).required(),coinType:i.default.number().integer(),beta:i.default.boolean(),features:i.default.array().items(i.default.string().valid("stargate","cosmwasm","wasmd_0.24+","secretwasm","ibc-transfer","no-legacy-stdTx","ibc-go","eth-address-gen","eth-key-sign","query:/cosmos/bank/v1beta1/spendable_balances","axelar-evm-bridge","osmosis-txfees")).unique().custom(e=>{if(0<=e.indexOf("cosmwasm")&&0<=e.indexOf("secretwasm"))throw new s.KeplrError("chains",430,"cosmwasm and secretwasm are not compatible");return e})})},524:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="chains"},525:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(526),t),s(r(527),t),s(r(334),t)},526:function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.PermissionService=void 0;const s=r(3),o=r(527),c=r(16);t.PermissionService=class{constructor(e,t){this.kvStore=e,this.permissionMap={},this.privilegedOrigins=new Map,this.onChainRemoved=e=>{this.removeAllPermissions(e)};for(const r of t)this.privilegedOrigins.set(r,!0);this.restore()}init(e,t,r){this.interactionService=e,this.chainsService=t,this.keyRingService=r,this.chainsService.addChainRemovedHandler(this.onChainRemoved)}checkOrGrantBasicAccessPermission(r,i,s){return a(this,void 0,void 0,function*(){yield this.keyRingService.enable(r);var e=[];for(const t of i="string"==typeof i?[i]:i)this.hasPermisson(t,o.getBasicAccessPermissionType(),s)||e.push(t);0<e.length&&(yield this.grantBasicAccessPermission(r,e,[s])),yield this.checkBasicAccessPermission(r,i,s)})}grantPermission(t,r,i,s,n){return a(this,void 0,void 0,function*(){var e;t.isInternalMsg||(e={chainIds:i,type:s,origins:n},yield this.interactionService.waitApprove(t,r,o.INTERACTION_TYPE_PERMISSION,e),yield this.addPermission(i,s,n))})}grantBasicAccessPermission(t,r,i){return a(this,void 0,void 0,function*(){for(const e of r)yield this.chainsService.getChainInfo(e);yield this.grantPermission(t,"/access",r,o.getBasicAccessPermissionType(),i)})}checkPermission(e,t,r,i){if(!e.isInternalMsg&&!this.hasPermisson(t,r,i))throw new s.KeplrError("permission",130,i+" is not permitted")}checkBasicAccessPermission(t,r,i){return a(this,void 0,void 0,function*(){for(const e of r)yield this.chainsService.getChainInfo(e),this.checkPermission(t,e,o.getBasicAccessPermissionType(),i)})}hasPermisson(e,t,r){return!!this.privilegedOrigins.get(r)||!!(e=this.permissionMap[c.ChainIdHelper.parse(e).identifier])&&!(!(e=e[t])||!e[r])}getPermissionOrigins(e,t){var r=[],e=this.permissionMap[c.ChainIdHelper.parse(e).identifier];if(!e)return[];var i=e[t];if(!i)return[];for(const s of Object.keys(i))i[s]&&r.push(s);return r}getOriginPermittedChains(e,t){var r=[];for(const n of Object.keys(this.permissionMap)){var i=this.permissionMap[n],s=null!=(i=i?i[t]:void 0)?i:{};for(const a of Object.keys(s))a===e&&s[a]&&r.push(n)}return r}addPermission(e,s,n){return a(this,void 0,void 0,function*(){for(const r of e){let e=this.permissionMap[c.ChainIdHelper.parse(r).identifier],t=(e||(e={},this.permissionMap[c.ChainIdHelper.parse(r).identifier]=e),e[s]);t||(t={},e[s]=t);for(const i of n)t[i]=!0}yield this.save()})}removePermission(i,s,n){return a(this,void 0,void 0,function*(){var e=this.permissionMap[c.ChainIdHelper.parse(i).identifier];if(e){var t=e[s];if(t){for(const r of n)delete t[r];yield this.save()}}})}removeAllPermissions(e){return a(this,void 0,void 0,function*(){this.permissionMap[c.ChainIdHelper.parse(e).identifier]=void 0,yield this.save()})}restore(){return a(this,void 0,void 0,function*(){var e=yield this.kvStore.get("permissionMap");e&&(this.permissionMap=e)})}save(){return a(this,void 0,void 0,function*(){yield this.kvStore.set("permissionMap",this.permissionMap)})}}},527:function(e,t,r){"use strict";function i(){return"basic-access"}Object.defineProperty(t,"__esModule",{value:!0}),t.isBasicAccessPermissionType=t.getBasicAccessPermissionType=t.INTERACTION_TYPE_PERMISSION=void 0,t.INTERACTION_TYPE_PERMISSION="permission",t.getBasicAccessPermissionType=i,t.isBasicAccessPermissionType=function(e){return e===i()}},528:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="permission"},529:function(e,t,r){"use strict";var f=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.KeyRingService=void 0;const s=r(230),g=r(16),m=r(27),d=r(96),y=r(3),h=r(100),p=i(r(7)),v=r(4),b=r(1041);t.KeyRingService=class{constructor(e,t,r){this.kvStore=e,this.embedChainInfos=t,this.crypto=r,this.onChainRemoved=e=>{this.keyRing.removeAllKeyStoreCoinType(e)}}init(e,t,r,i){this.interactionService=e,this.chainsService=t,this.permissionService=r,this.keyRing=new s.KeyRing(this.embedChainInfos,this.kvStore,this.crypto,i),this.chainsService.addChainRemovedHandler(this.onChainRemoved)}restore(){return f(this,void 0,void 0,function*(){return yield this.keyRing.restore(),{status:this.keyRing.status,multiKeyStoreInfo:this.keyRing.getMultiKeyStoreInfo()}})}enable(e){return f(this,void 0,void 0,function*(){return this.keyRing.status===s.KeyRingStatus.EMPTY?yield this.interactionService.waitApprove(e,"/register","register",{}):(this.keyRing.status===s.KeyRingStatus.NOTLOADED&&(yield this.keyRing.restore()),[s.KeyRingStatus.LOCKED,s.KeyRingStatus.MIGRATOR].includes(this.keyRing.status)&&(yield this.interactionService.waitApprove(e,"/unlock","unlock",{}))),this.keyRing.status})}get keyRingStatus(){return this.keyRing.status}deleteKeyRing(r,i){return f(this,void 0,void 0,function*(){let e=!1;try{var t=yield this.keyRing.deleteKeyRing(r,i);return e=t.keyStoreChanged,{multiKeyStoreInfo:t.multiKeyStoreInfo,status:this.keyRing.status}}finally{e&&this.interactionService.dispatchEvent(y.WEBPAGE_PORT,"keystore-changed",{})}})}updateNameKeyRing(e,t){return f(this,void 0,void 0,function*(){return{multiKeyStoreInfo:yield this.keyRing.updateNameKeyRing(e,t)}})}showKeyRing(e,t){return f(this,void 0,void 0,function*(){return yield this.keyRing.showKeyRing(e,t)})}createMnemonicKey(e,t,r,i,s){return f(this,void 0,void 0,function*(){return yield this.keyRing.createMnemonicKey(e,t,r,i,s)})}createPrivateKey(e,t,r,i){return f(this,void 0,void 0,function*(){return yield this.keyRing.createPrivateKey(e,t,r,i)})}lock(){return this.keyRing.lock(),this.keyRing.status}unlock(e){return f(this,void 0,void 0,function*(){return yield this.keyRing.unlock(e),this.keyRing.status})}getKey(t){return f(this,void 0,void 0,function*(){var e=yield this.chainsService.getChainEthereumKeyFeatures(t);return(e.address||e.signing)&&this.keyRing.throwErrorIfEthermintWithLedgerButNotEvmos(t),this.keyRing.getKey(t,yield this.chainsService.getChainCoinType(t),e.address)})}getKeyStoreMeta(e){return this.keyRing.getKeyStoreMeta(e)}getKeyRingType(){return this.keyRing.type}requestSignAmino(c,l,u,d,h,p){return f(this,void 0,void 0,function*(){h=Object.assign(Object.assign({},h),{memo:m.escapeHTML(h.memo)}),h=b.trimAminoSignDoc(h),h=m.sortObjectByKey(h);var e=yield this.chainsService.getChainCoinType(u),t=yield this.chainsService.getChainEthereumKeyFeatures(u),r=((t.address||t.signing)&&this.keyRing.throwErrorIfEthermintWithLedgerButNotEvmos(u),yield this.keyRing.getKey(u,e,t.address)),i=(yield this.chainsService.getChainInfo(u)).bech32Config.bech32PrefixAccAddr,s=new g.Bech32Address(r.address).toBech32(i);if(d!==s)throw new y.KeplrError("keyring",231,"Signer mismatched");s=g.checkAndValidateADR36AminoSignDoc(h,i);if(s&&h.msgs[0].value.signer!==d)throw new y.KeplrError("keyring",233,"Unmatched signer in sign doc");if(null!=p.isADR36WithString&&!s)throw new y.KeplrError("keyring",236,'Sign doc is not for ADR-36. But, "isADR36WithString" option is defined');if(p.ethSignType&&!s)throw new Error("Eth sign type can be requested with only ADR-36 amino sign doc");var n=yield this.interactionService.waitApprove(c,"/sign","request-sign",{msgOrigin:l,chainId:u,mode:"amino",signDoc:h,signer:d,signOptions:p,isADR36SignDoc:s,isADR36WithString:p.isADR36WithString,ethSignType:p.ethSignType}),n=Object.assign(Object.assign({},n),{memo:m.escapeHTML(n.memo)});if(s){if(!g.checkAndValidateADR36AminoSignDoc(h,i))throw new y.KeplrError("keyring",237,"Signing request was for ADR-36. But, accidentally, new sign doc is not for ADR-36");if(h.msgs[0].value.signer!==d)throw new y.KeplrError("keyring",232,"Unmatched signer in new sign doc")}if(p.ethSignType){if(1!==n.msgs.length)throw new Error("Invalid number of messages for Ethereum sign request");s=v.Buffer.from(n.msgs[0].value.data,"base64");try{var a=yield this.keyRing.signEthereum(c,u,e,s,p.ethSignType);return{signed:n,signature:{pub_key:g.encodeSecp256k1Pubkey(r.pubKey),signature:v.Buffer.from(a).toString("base64")}}}finally{this.interactionService.dispatchEvent(y.APP_PORT,"request-sign-end",{})}}try{var o=yield this.keyRing.sign(c,u,e,g.serializeSignDoc(n),t.signing);return{signed:n,signature:g.encodeSecp256k1Signature(r.pubKey,o)}}finally{this.interactionService.dispatchEvent(y.APP_PORT,"request-sign-end",{})}})}requestSignEIP712CosmosTx_v0(s,n,a,o,c,l,u){return f(this,void 0,void 0,function*(){l=Object.assign(Object.assign({},l),{memo:m.escapeHTML(l.memo)}),l=b.trimAminoSignDoc(l),l=m.sortObjectByKey(l);var e=yield this.chainsService.getChainCoinType(a),t=yield this.chainsService.getChainEthereumKeyFeatures(a),t=((t.address||t.signing)&&this.keyRing.throwErrorIfEthermintWithLedgerButNotEvmos(a),yield this.keyRing.getKey(a,e,t.address)),r=(yield this.chainsService.getChainInfo(a)).bech32Config.bech32PrefixAccAddr,r=new g.Bech32Address(t.address).toBech32(r);if(o!==r)throw new y.KeplrError("keyring",231,"Signer mismatched");r=yield this.interactionService.waitApprove(s,"/sign","request-sign",{msgOrigin:n,chainId:a,mode:"amino",signDoc:l,signer:o,signOptions:u,isADR36SignDoc:!1,ethSignType:d.EthSignType.EIP712}),r=Object.assign(Object.assign({},r),{memo:m.escapeHTML(r.memo)});try{var i=yield this.keyRing.signEthereum(s,a,e,v.Buffer.from(JSON.stringify({types:c.types,domain:c.domain,primaryType:c.primaryType,message:r})),d.EthSignType.EIP712);return{signed:r,signature:{pub_key:g.encodeSecp256k1Pubkey(t.pubKey),signature:v.Buffer.from(i).toString("base64")}}}finally{this.interactionService.dispatchEvent(y.APP_PORT,"request-sign-end",{})}})}requestSignDirect(a,o,c,l,u,d){return f(this,void 0,void 0,function*(){var e=yield this.chainsService.getChainCoinType(c),t=yield this.chainsService.getChainEthereumKeyFeatures(c),r=((t.address||t.signing)&&this.keyRing.throwErrorIfEthermintWithLedgerButNotEvmos(c),yield this.keyRing.getKey(c,e,t.address)),i=new g.Bech32Address(r.address).toBech32((yield this.chainsService.getChainInfo(c)).bech32Config.bech32PrefixAccAddr);if(l!==i)throw new y.KeplrError("keyring",231,"Signer mismatched");var i=yield this.interactionService.waitApprove(a,"/sign","request-sign",{msgOrigin:o,chainId:c,mode:"direct",signDocBytes:h.SignDoc.encode(u).finish(),signer:l,signOptions:d}),s=h.SignDoc.decode(i);try{var n=yield this.keyRing.sign(a,c,e,i,t.signing);return{signed:Object.assign(Object.assign({},s),{accountNumber:p.default.fromString(s.accountNumber)}),signature:g.encodeSecp256k1Signature(r.pubKey,n)}}finally{this.interactionService.dispatchEvent(y.APP_PORT,"request-sign-end",{})}})}verifyADR36AminoSignDoc(i,s,n,a){return f(this,void 0,void 0,function*(){var e=yield this.chainsService.getChainCoinType(i),t=yield this.chainsService.getChainEthereumKeyFeatures(i),e=yield this.keyRing.getKey(i,e,t.address),t=(yield this.chainsService.getChainInfo(i)).bech32Config.bech32PrefixAccAddr,r=new g.Bech32Address(e.address).toBech32(t);if(s!==r)throw new y.KeplrError("keyring",231,"Signer mismatched");if("tendermint/PubKeySecp256k1"!==a.pub_key.type)throw new y.KeplrError("keyring",211,"Unsupported type of pub key: "+a.pub_key.type);if(v.Buffer.from(e.pubKey).toString("base64")!==a.pub_key.value)throw new y.KeplrError("keyring",210,"Pub key unmatched");r=g.makeADR36AminoSignDoc(s,n);return g.verifyADR36AminoSignDoc(t,r,v.Buffer.from(a.pub_key.value,"base64"),v.Buffer.from(a.signature,"base64"))})}sign(e,t,r){return f(this,void 0,void 0,function*(){return this.keyRing.sign(e,t,yield this.chainsService.getChainCoinType(t),r,(yield this.chainsService.getChainEthereumKeyFeatures(t)).signing)})}addMnemonicKey(e,t,r,i){return f(this,void 0,void 0,function*(){return this.keyRing.addMnemonicKey(e,t,r,i)})}addPrivateKey(e,t,r){return f(this,void 0,void 0,function*(){return this.keyRing.addPrivateKey(e,t,r)})}changeKeyStoreFromMultiKeyStore(e){return f(this,void 0,void 0,function*(){try{return yield this.keyRing.changeKeyStoreFromMultiKeyStore(e)}finally{this.interactionService.dispatchEvent(y.WEBPAGE_PORT,"keystore-changed",{})}})}checkPassword(e){return this.keyRing.checkPassword(e)}getMultiKeyStoreInfo(){return this.keyRing.getMultiKeyStoreInfo()}isKeyStoreCoinTypeSet(e){return this.keyRing.isKeyStoreCoinTypeSet(e)}setKeyStoreCoinType(t,r){return f(this,void 0,void 0,function*(){var e=this.keyRing.computeKeyStoreCoinType(t,yield this.chainsService.getChainCoinType(t));yield this.keyRing.setKeyStoreCoinType(t,r),e!==r&&this.interactionService.dispatchEvent(y.WEBPAGE_PORT,"keystore-changed",{})})}getKeyStoreBIP44Selectables(s,n){return f(this,void 0,void 0,function*(){if(this.isKeyStoreCoinTypeSet(s))return[];var e=[],t=yield this.chainsService.getChainInfo(s);for(const i of n){var r=yield this.keyRing.getKeyFromCoinType(i.coinType,(yield this.chainsService.getChainEthereumKeyFeatures(s)).address),r=new g.Bech32Address(r.address).toBech32(t.bech32Config.bech32PrefixAccAddr);e.push({path:i,bech32Address:r})}return e})}exportKeyRingDatas(e){return f(this,void 0,void 0,function*(){return yield this.keyRing.exportKeyRingDatas(e)})}addAccount(e,t){return f(this,void 0,void 0,function*(){return yield this.keyRing.addAccount(e,t)})}migratorKeyRing(e){return f(this,void 0,void 0,function*(){return yield this.keyRing.migratorKeyRing(e)})}restoreKeyStore(){return f(this,void 0,void 0,function*(){return yield this.keyRing.restoreKeyStore()})}}},530:function(e,t){var r=Math.pow(2,30)-1;e.exports=function(e,t){if("number"!=typeof e)throw new TypeError("Iterations not a number");if(e<0)throw new TypeError("Bad iterations");if("number"!=typeof t)throw new TypeError("Key length not a number");if(t<0||r<t||t!=t)throw new TypeError("Bad key length")}},531:function(r,e,t){!function(e,t){e=e.process&&e.process.browser||!e.process||!e.process.version||6<=parseInt(t.version.split(".")[0].slice(1),10)?"utf-8":"binary",r.exports=e}.call(this,t(11),t(28))},532:function(e,t,r){var l=r(291),u=r(145),d=r(125),m=r(22).Buffer,y=r(530),v=r(531),b=r(533),h=m.alloc(128),w={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function _(e,t,r){for(var i,s="rmd160"===(i=e)||"ripemd160"===i?function(e){return(new u).update(e).digest()}:"md5"===i?l:function(e){return d(i).update(e).digest()},n="sha512"===e||"sha384"===e?128:64,a=(t.length>n?t=s(t):t.length<n&&(t=m.concat([t,h],n)),m.allocUnsafe(n+w[e])),o=m.allocUnsafe(n+w[e]),c=0;c<n;c++)a[c]=54^t[c],o[c]=92^t[c];r=m.allocUnsafe(n+r+4);a.copy(r,0,0,n),this.ipad1=r,this.ipad2=a,this.opad=o,this.alg=e,this.blocksize=n,this.hash=s,this.size=w[e]}_.prototype.run=function(e,t){return e.copy(t,this.blocksize),this.hash(t).copy(this.opad,this.blocksize),this.hash(this.opad)},e.exports=function(e,t,r,i,s){y(r,i);for(var n=new _(s=s||"sha1",e=b(e,v,"Password"),(t=b(t,v,"Salt")).length),a=m.allocUnsafe(i),o=m.allocUnsafe(t.length+4),c=(t.copy(o,0,0,t.length),0),l=w[s],u=Math.ceil(i/l),d=1;d<=u;d++){o.writeUInt32BE(d,t.length);for(var h=n.run(o,n.ipad1),p=h,f=1;f<r;f++)for(var p=n.run(p,n.ipad2),g=0;g<l;g++)h[g]^=p[g];h.copy(a,c),c+=l}return a}},533:function(e,t,r){var i=r(22).Buffer;e.exports=function(e,t,r){if(i.isBuffer(e))return e;if("string"==typeof e)return i.from(e,t);if(ArrayBuffer.isView(e))return i.from(e.buffer);throw new TypeError(r+" must be a string, a Buffer, a typed array or a DataView")}},534:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.EIP712MessageValidator=t.EIP712DomainTypeValidator=t.EIP712PropertyFieldValidator=void 0,i(r(41)));t.EIP712PropertyFieldValidator=i.default.object({name:i.default.string().min(1).required(),type:i.default.string().min(1).required()}),t.EIP712DomainTypeValidator=i.default.array().items(i.default.object({name:i.default.string().valid("name").required(),type:i.default.string().valid("string").required()}),i.default.object({name:i.default.string().valid("version").required(),type:i.default.string().valid("string").required()}),i.default.object({name:i.default.string().valid("chainId").required(),type:i.default.string().valid("uint256").required()}),i.default.object({name:i.default.string().valid("verifyingContract").required(),type:i.default.string().valid("address","string").required()}),i.default.object({name:i.default.string().valid("salt").required(),type:i.default.string().valid("bytes32","string").required()})).unique().min(1).custom(e=>{const r=["name","version","chainId","verifyingContract","salt"];return e.sort((e,t)=>r.indexOf(e.name)-r.indexOf(t.name))}),t.EIP712MessageValidator=i.default.object({types:i.default.object({EIP712Domain:t.EIP712DomainTypeValidator.required()}).unknown(!0).required(),primaryType:i.default.string().min(1).required(),domain:i.default.object().required(),message:i.default.object().required()})},535:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="keyring"},536:function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundTxService=void 0;const s=r(4);class n{constructor(e,t){this.notification=e,this.misesService=t}init(e,t){this.chainsService=e,this.permissionService=t}sendTx(e,r,t){return i(this,void 0,void 0,function*(){this.notification.create({iconRelativeUrl:"assets/logo-256.png",title:"Tx is pending...",message:"Wait a second"});try{var e=yield this.misesService.broadcastTx(r),t=s.Buffer.from(e,"hex");return this.misesService.pollForTx(e).then(e=>{n.processTxResultNotification(this.notification,e)}),t}catch(e){throw n.processTxErrorNotification(this.notification,e),e}})}static processTxResultNotification(t,e){var r,i;try{if("commit"===e.mode){if(void 0!==e.checkTx.code&&0!==e.checkTx.code)throw new Error(e.checkTx.log);if(void 0!==e.deliverTx.code&&0!==e.deliverTx.code)throw new Error(e.deliverTx.log)}else if(null!=e.code&&0!==e.code)throw i=null!=(r=e.log)?r:e.rawLog,new Error(i);t.create({iconRelativeUrl:"assets/logo-256.png",title:"Tx succeeds",message:"Congratulations!"})}catch(e){n.processTxErrorNotification(t,e)}}static processTxErrorNotification(e,t){let r=t.message;var i=/code:\s*(-?\d+),\s*message:\s*(.+),\sdata:\s(.+)/g.exec(t.message);i&&4===i.length&&(r=i[3]);try{var s=JSON.parse(t.message);null!=s&&s.message&&(r=s.message)}catch(e){}try{var n=JSON.parse(t.message);if(n&&0<n.length)for(const o of n)if(!o.success){var a=JSON.parse(o.log);if(null!=a&&a.message){r=a.message;break}}}catch(e){}e.create({iconRelativeUrl:"assets/logo-256.png",title:"Tx failed",message:r})}}t.BackgroundTxService=n},537:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="background-tx"},538:function(e,t,r){"use strict";var h=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChainUpdaterService=void 0;const p=i(r(60)),f=r(16),u=r(3);class l{constructor(e){this.kvStore=e}init(e){this.chainsService=e}putUpdatedPropertyToChainInfo(s){var n;return h(this,void 0,void 0,function*(){var e=yield this.getUpdatedChainProperty(s.chainId),t=f.ChainIdHelper.parse(s.chainId);if(f.ChainIdHelper.parse(e.chainId||s.chainId).version<t.version)return s;var r=null!=(n=s.features)?n:[];for(const i of null!=(n=e.features)?n:[])r.includes(i)||r.push(i);return Object.assign(Object.assign({},s),{chainId:e.chainId||s.chainId,rpc:e.rpc||s.rpc,rest:e.rest||s.rest,features:r})})}clearUpdatedProperty(e){return h(this,void 0,void 0,function*(){yield this.kvStore.set(f.ChainIdHelper.parse(e).identifier,null),this.chainsService.clearCachedChainInfos()})}tryUpdateChain(o){var c;return h(this,void 0,void 0,function*(){var e=yield this.chainsService.getChainInfo(o);if(f.ChainIdHelper.hasChainVersion(e.chainId)){var t=yield l.checkChainUpdate(e);if(t.explicit||t.slient){var r,i=f.ChainIdHelper.parse(e.chainId);if(t.chainId&&(r=t.chainId,s=f.ChainIdHelper.parse(r),i.identifier===s.identifier)&&i.version<s.version&&(yield this.saveChainProperty(i.identifier,{chainId:r})),t.features&&0<t.features.length){var s=yield this.getUpdatedChainProperty(e.chainId),n=null!=(c=s.features)?c:[];for(const a of t.features)n.includes(a)||n.push(a);yield this.saveChainProperty(i.identifier,{features:n})}}}})}getUpdatedChainProperty(t){return h(this,void 0,void 0,function*(){var e=f.ChainIdHelper.parse(t);return yield this.loadChainProperty(e.identifier)})}saveChainProperty(t,r){return h(this,void 0,void 0,function*(){var e=yield this.loadChainProperty(t);yield this.kvStore.set(t,Object.assign(Object.assign({},e),r)),this.chainsService.clearCachedChainInfos()})}loadChainProperty(t){return h(this,void 0,void 0,function*(){var e=yield this.kvStore.get(t);return e||{}})}static checkChainUpdate(u){var d;return h(this,void 0,void 0,function*(){var e=u.chainId;if(!f.ChainIdHelper.hasChainVersion(e))return{explicit:!1,slient:!1};const t=yield p.default.create({baseURL:u.rpc}).get("/status");var r=t.data.result.node_info.network,e=f.ChainIdHelper.parse(e),i=f.ChainIdHelper.parse(r);if(e.identifier!==i.identifier)return{explicit:!1,slient:!1};var s=p.default.create({baseURL:u.rest});let n=!1;try{if(!u.features||!u.features.includes("ibc-go")){const t=yield s.get("/ibc/apps/transfer/v1/params");200===t.status&&(n=!0)}}catch(e){}let a=!1;try{if(!u.features||!u.features.includes("ibc-transfer")){var o=n||u.features&&u.features.includes("ibc-go");const t=yield s.get(o?"/ibc/apps/transfer/v1/params":"/ibc/applications/transfer/v1beta1/params");t.data.params.receive_enabled&&t.data.params.send_enabled&&(a=!0)}}catch(e){}let c=!1;try{if(null!=(d=u.features)&&d.includes("cosmwasm")&&!u.features.includes("wasmd_0.24+")){const t=yield s.get("/cosmwasm/wasm/v1/contract/test/smart/test",{validateStatus:e=>400===e||501===e});400===t.status&&(c=!0)}}catch(e){}let l=!1;try{if(!u.features||!u.features.includes("query:/cosmos/bank/v1beta1/spendable_balances")){const t=yield s.get("/cosmos/bank/v1beta1/spendable_balances/test",{validateStatus:e=>400===e||501===e});400===t.status&&(l=!0)}}catch(e){}o=[];return n&&o.push("ibc-go"),a&&o.push("ibc-transfer"),c&&o.push("wasmd_0.24+"),l&&o.push("query:/cosmos/bank/v1beta1/spendable_balances"),{explicit:e.version<i.version,slient:0<o.length,chainId:r,features:o}})}setChainEndpoints(r,i,s){return h(this,void 0,void 0,function*(){var e={},t=(i&&(e.rpc=i),s&&(e.rest=s),f.ChainIdHelper.parse(r));return yield this.saveChainProperty(t.identifier,e),yield this.chainsService.getChainInfos()})}resetChainEndpoints(t){return h(this,void 0,void 0,function*(){var e=f.ChainIdHelper.parse(t);return yield this.saveChainProperty(e.identifier,{rpc:void 0,rest:void 0}),yield this.chainsService.getChainInfos()})}static checkEndpointsConnectivity(a,o,c,l){return h(this,void 0,void 0,function*(){var e=p.default.create({baseURL:o});let t;try{t=yield e.get("/status")}catch(e){throw new Error("Failed to get response /status from rpc endpoint")}var e=f.ChainIdHelper.parse(a),r=f.ChainIdHelper.parse(t.data.result.node_info.network);if(r.identifier!==e.identifier)throw new u.KeplrError("updater",8001,`RPC endpoint has different chain id (expected: ${a}, actual: ${t.data.result.node_info.network})`);if(r.version!==e.version)throw new u.KeplrError("updater",8002,`RPC endpoint has different chain id (expected: ${a}, actual: ${t.data.result.node_info.network})`);let i=o;i=(i=i.startsWith("http")?i.replace("http","ws"):i).endsWith("/")?i+"websocket":i+"/websocket";var s=new(l||WebSocket)(i);for(let e=0;e<15;e++){if(0!==s.readyState){if(1===s.readyState)break;throw new Error("Failed to connect websocket to /websocket rpc")}yield new Promise(e=>setTimeout(e,1e3))}r=p.default.create({baseURL:c});let n;try{n=yield r.get("/cosmos/base/tendermint/v1beta1/node_info")}catch(e){throw new Error("Failed to get response /cosmos/base/tendermint/v1beta1/node_info from lcd endpoint")}r=f.ChainIdHelper.parse(n.data.default_node_info.network);if(r.identifier!==e.identifier)throw new u.KeplrError("updater",8101,`LCD endpoint has different chain id (expected: ${a}, actual: ${t.data.result.node_info.network})`);if(r.version!==e.version)throw new u.KeplrError("updater",8102,`LCD endpoint has different chain id (expected: ${a}, actual: ${t.data.result.node_info.network})`)})}}t.ChainUpdaterService=l},539:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="chain-updator"},54:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t},a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const h=n(r(1020)),p=n(r(1023)),f=n(r(1026)),g=n(r(1044)),m=n(r(1047)),y=n(r(1050)),v=n(r(1054)),b=n(r(1061)),w=n(r(1064)),_=n(r(1067)),S=n(r(1088));a(r(1091),t),a(r(541),t),a(r(339),t),a(r(1092),t),a(r(1093),t),a(r(1094),t),a(r(1177),t),a(r(1179),t),a(r(1180),t),a(r(1181),t),a(r(525),t),a(r(1183),t),t.init=function(e,t,r,i,s,n,a,o={}){var r=new v.InteractionService(r,n.rng),c=new h.PersistentMemoryService,s=new b.PermissionService(t("permission"),s),l=new m.ChainUpdaterService(t("updator")),u=new y.TokensService(t("tokens")),o=new p.ChainsService(t("chains"),i,{useMemoryKVStoreForSuggestChain:null==(o=o.suggestChain)?void 0:o.useMemoryKVStore}),i=new f.KeyRingService(t("keyring"),i,n),n=new _.MisesService(t("mises")),d=new S.MisesSafeService(t("misesSafe")),a=new g.BackgroundTxService(a,n),t=new w.AutoLockAccountService(t("auto-lock-account"));r.init(),c.init(),s.init(r,o,i),l.init(o),u.init(r,s,o,i),o.init(l,r,s),i.init(r,o,s,n),n.init(),d.init(),a.init(o,s),t.init(i),v.init(e,r),h.init(e,c),b.init(e,s),m.init(e,l),y.init(e,u),p.init(e,o),f.init(e,i),g.init(e,a),w.init(e,t),_.init(e,n),S.init(e,d)}},540:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.TokensService=void 0;const i=r(3),s=r(541),a=r(16),c=r(339),l=r(4),u=r(231),n=r(543);class d{constructor(e){this.kvStore=e,this.onChainRemoved=e=>{this.clearTokens(e)}}init(e,t,r,i){this.interactionService=e,this.permissionService=t,this.chainsService=r,this.keyRingService=i,this.chainsService.addChainRemovedHandler(this.onChainRemoved)}suggestToken(r,i,s,n){return o(this,void 0,void 0,function*(){var e=yield this.chainsService.getChainInfo(i),t=(yield this.getTokens(i)).find(e=>"contractAddress"in e&&e.contractAddress===s);if(t)return n?void("type"in t&&"secret20"===t.type&&(yield this.addToken(i,Object.assign(Object.assign({},t),{viewingKey:n})))):void 0;a.Bech32Address.validate(s,e.bech32Config.bech32PrefixAccAddr);t={chainId:i,contractAddress:s,viewingKey:n},e=yield this.interactionService.waitApprove(r,"/setting/token/add",u.SuggestTokenMsg.type(),t);yield this.addToken(i,e)})}addToken(n,a){return o(this,void 0,void 0,function*(){var e,t=yield this.chainsService.getChainInfo(n),t=(a=yield d.validateCurrency(t,a),yield this.getTokens(n)),r="type"in a&&"secret20"===a.type;let i=!1;for(const s of t)if(a.coinMinimalDenom===s.coinMinimalDenom){if(!r)return;i=!0}r?(t=yield this.getTokensFromChainAndAccount(n),i?0<=(e=t.findIndex(e=>e.coinMinimalDenom===a.coinMinimalDenom))&&(t[e]=a,yield this.saveTokensToChainAndAccount(n,t)):(t.push(a),yield this.saveTokensToChainAndAccount(n,t))):((e=yield this.getTokensFromChain(n)).push(a),yield this.saveTokensToChain(n,e))})}removeToken(s,n){return o(this,void 0,void 0,function*(){var e=yield this.chainsService.getChainInfo(s),e=(n=yield d.validateCurrency(e,n),yield this.getTokens(s)),t="type"in n&&"secret20"===n.type;let r=!1;for(const i of e)if(n.coinMinimalDenom===i.coinMinimalDenom){r=!0;break}r&&(t?(e=(yield this.getTokensFromChainAndAccount(s)).filter(e=>e.coinMinimalDenom!==n.coinMinimalDenom),yield this.saveTokensToChainAndAccount(s,e)):(t=(yield this.getTokensFromChain(s)).filter(e=>e.coinMinimalDenom!==n.coinMinimalDenom),yield this.saveTokensToChain(s,t)))})}getTokens(s){var n;return o(this,void 0,void 0,function*(){var e,t=a.ChainIdHelper.parse(s),r=null!=(n=yield this.kvStore.get(t.identifier))?n:[];let i=[];return this.keyRingService.keyRingStatus===c.KeyRingStatus.UNLOCKED&&(e=yield this.keyRingService.getKey(s),i=null!=(n=yield this.kvStore.get(t.identifier+"-"+l.Buffer.from(e.address).toString("hex")))?n:[]),r.concat(i)})}clearTokens(i){return o(this,void 0,void 0,function*(){var e=a.ChainIdHelper.parse(i),t=(yield this.kvStore.set(e.identifier,null),yield this.getTokensToAccountReverse(i));for(const r of t)yield this.kvStore.set(e.identifier+"-"+r,null);yield this.setTokensToAccountReverse(i,[])})}getTokensFromChain(t){var r;return o(this,void 0,void 0,function*(){var e=a.ChainIdHelper.parse(t);return null!=(r=yield this.kvStore.get(e.identifier))?r:[]})}saveTokensToChain(t,r){return o(this,void 0,void 0,function*(){var e=a.ChainIdHelper.parse(t);yield this.kvStore.set(e.identifier,r)})}getTokensFromChainAndAccount(r){var i;return o(this,void 0,void 0,function*(){var e=a.ChainIdHelper.parse(r),t=yield this.keyRingService.getKey(r);return null!=(i=yield this.kvStore.get(e.identifier+"-"+l.Buffer.from(t.address).toString("hex")))?i:[]})}saveTokensToChainAndAccount(r,i){return o(this,void 0,void 0,function*(){var e=a.ChainIdHelper.parse(r),t=yield this.keyRingService.getKey(r),t=l.Buffer.from(t.address).toString("hex");yield this.kvStore.set(e.identifier+"-"+t,i),yield this.insertTokensToAccountReverse(r,t)})}getTokensToAccountReverse(t){var r;return o(this,void 0,void 0,function*(){var e=a.ChainIdHelper.parse(t);return null!=(r=yield this.kvStore.get(e.identifier+"-addresses"))?r:[]})}setTokensToAccountReverse(t,r){return o(this,void 0,void 0,function*(){var e=a.ChainIdHelper.parse(t);yield this.kvStore.set(e.identifier+"-addresses",r)})}insertTokensToAccountReverse(t,r){return o(this,void 0,void 0,function*(){var e=yield this.getTokensToAccountReverse(t);e.indexOf(r)<0&&(e.push(r),yield this.setTokensToAccountReverse(t,e))})}getSecret20ViewingKey(t,r){return o(this,void 0,void 0,function*(){for(const e of yield this.getTokens(t))if("type"in e&&"secret20"===e.type&&e.contractAddress===r)return e.viewingKey;throw new i.KeplrError("tokens",111,"There is no matched secret20")})}checkOrGrantSecret20ViewingKeyPermission(t,r,i,s){return o(this,void 0,void 0,function*(){yield this.getSecret20ViewingKey(r,i);var e=n.getSecret20ViewingKeyPermissionType(i);this.permissionService.hasPermisson(r,e,s)||(yield this.permissionService.grantPermission(t,"/access/viewing-key",[r],e,[s])),this.permissionService.checkPermission(t,r,e,s)})}static validateCurrency(e,t){return o(this,void 0,void 0,function*(){if("type"in t)switch(t.type){case"cw20":t=yield d.validateCW20Currency(e,t);break;case"secret20":t=yield d.validateSecret20Currency(e,t);break;default:throw new i.KeplrError("tokens",110,"Unknown type of currency")}else t=yield s.CurrencySchema.validateAsync(t);return t})}static validateCW20Currency(e,t){return o(this,void 0,void 0,function*(){return t=yield s.CW20CurrencySchema.validateAsync(t),a.Bech32Address.validate(t.contractAddress,e.bech32Config.bech32PrefixAccAddr),t})}static validateSecret20Currency(e,t){return o(this,void 0,void 0,function*(){return t=yield s.Secret20CurrencySchema.validateAsync(t),a.Bech32Address.validate(t.contractAddress,e.bech32Config.bech32PrefixAccAddr),t})}}t.TokensService=d},541:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(522),t),s(r(229),t),s(r(523),t)},542:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="tokens"},543:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.splitSecret20ViewingKeyPermissionType=t.isSecret20ViewingKeyPermissionType=t.getSecret20ViewingKeyPermissionType=void 0,t.getSecret20ViewingKeyPermissionType=function(e){return"viewing-key/"+e},t.isSecret20ViewingKeyPermissionType=function(e){return e.startsWith("viewing-key/")},t.splitSecret20ViewingKeyPermissionType=function(e){return e.replace("viewing-key/","")}},544:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.InteractionService=void 0;const c=r(3),l=r(545);t.InteractionService=class{constructor(e,t){this.eventMsgRequester=e,this.rng=t,this.waitingMap=new Map,this.resolverMap=new Map}init(){}dispatchEvent(e,t,r){if(!t)throw new c.KeplrError("interaction",101,"Type should not be empty");const i=new l.PushEventDataMsg({type:t,data:r});this.eventMsgRequester.sendMessage(e,i).then(()=>{}).catch(e=>{})}waitApprove(r,i,s,n,a){return o(this,void 0,void 0,function*(){if(!s)throw new c.KeplrError("interaction",101,"Type should not be empty");var e=yield this.addDataToMap(s,r.isInternalMsg,n);const t=new l.PushInteractionDataMsg(e);return yield this.wait(t.data.id,()=>{r.requestInteraction(i,t,a)})})}wait(r,i){return o(this,void 0,void 0,function*(){if(this.resolverMap.has(r))throw new c.KeplrError("interaction",100,"Id is aleady in use");return new Promise((e,t)=>{this.resolverMap.set(r,{onApprove:e,onReject:t}),i()})})}approve(e,t){this.resolverMap.has(e)&&(this.resolverMap.get(e).onApprove(t),this.resolverMap.delete(e)),this.removeDataFromMap(e)}reject(e){this.resolverMap.has(e)&&(this.resolverMap.get(e).onReject(new Error("Request rejected")),this.resolverMap.delete(e)),this.removeDataFromMap(e)}addDataToMap(r,i,s){return o(this,void 0,void 0,function*(){var e=new Uint8Array(8),e=Array.from(yield this.rng(e)).map(e=>e.toString(16)).join(""),t={id:e,type:r,isInternal:i,data:s};if(this.waitingMap.has(e))throw new c.KeplrError("interaction",100,"Id is aleady in use");return this.waitingMap.set(e,t),t})}removeDataFromMap(e){this.waitingMap.delete(e)}}},545:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(1055),t),s(r(340),t),s(r(1056),t),s(r(1057),t)},546:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="interaction-foreground"},547:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="interaction"},548:function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.AutoLockAccountService=void 0;const s=r(339);t.AutoLockAccountService=class{constructor(e,t={monitoringInterval:1e4}){this.kvStore=e,this.opts=t,this.autoLockDuration=9e5,this.appStateCheckTimer=null,this.autoLockTimer=null}init(e){return i(this,void 0,void 0,function*(){this.keyringService=e,browser.idle.onStateChanged.addListener(e=>{this.stateChangedHandler(e)}),yield this.loadDuration()})}stateChangedHandler(e){0<this.autoLockDuration&&"locked"===e&&(this.stopAppStateCheckTimer(),this.stopAutoLockTimer(),this.lock())}startAppStateCheckTimer(){0<this.autoLockDuration&&this.keyRingIsUnlocked&&(this.stopAutoLockTimer(),this.startAutoLockTimer())}stopAppStateCheckTimer(){null!=this.appStateCheckTimer&&(clearTimeout(this.appStateCheckTimer),this.appStateCheckTimer=null)}checkAppIsActive(){return!1}startAutoLockTimer(){if(!this.keyRingIsUnlocked)throw new Error("Keyring is not unlocked");this.autoLockDuration<=0||(this.autoLockTimer=setTimeout(()=>{this.stopAppStateCheckTimer(),this.stopAutoLockTimer(),this.lock()},this.autoLockDuration))}stopAutoLockTimer(){null!=this.autoLockTimer&&(clearTimeout(this.autoLockTimer),this.autoLockTimer=null)}lock(){return i(this,void 0,void 0,function*(){if(this.keyRingIsUnlocked){this.keyringService.lock();let e=yield browser.tabs.query({discarded:!1,status:"complete"});for(const t of e=e.filter(e=>e.url&&-1<e.url.indexOf(browser.runtime.id)))browser.tabs.reload(t.id)}})}get keyRingIsUnlocked(){if(null==this.keyringService)throw new Error("Keyring service is null");return this.keyringService.keyRingStatus===s.KeyRingStatus.UNLOCKED}getAutoLockDuration(){return this.autoLockDuration}setDuration(e){return(this.autoLockDuration=e)<=0&&(this.stopAppStateCheckTimer(),this.stopAutoLockTimer()),this.kvStore.set("autoLockDuration",e)}loadDuration(){return i(this,void 0,void 0,function*(){var e=yield this.kvStore.get("autoLockDuration");this.autoLockDuration=null==e?9e5:e})}}},549:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="auto-lock-account"},557:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="mises"},558:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,a,o,c){return new(o=o||Promise)(function(r,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(i,s)}n((c=c.apply(e,a||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.MisesSafeService=void 0;const i=r(232),n={mVerifyDomain:"verifyDomain",mVerifyContract:"verifyContract"},a={ContractTrust:"v3_contract_trust_",DomainRisk:"v3_domain_risk_"},o={Safe:"safe",Danger:"danger"},c={Ignore:"IGNOR",Block:"BLOCK"},l="isShouldVerify";t.MisesSafeService=class{constructor(e){this.kvStore=e,this.isShouldVerify=!0,this.domainWhiteListMap=new Map,this.localShouldVerify(),this.getDomainwhiteList()}getDomainwhiteList(){i.misesRequest({url:"https://web3.mises.site/website/whitesites.json"}).then(e=>{e&&e.forEach(e=>{var t=this.parseDomainUntilSecondLevel(e);""!=e&&this.domainWhiteListMap.set(t,"1")})})}init(){this.messageClient()}messageClient(){}localShouldVerify(){this.kvStore.get(l).then(e=>{this.isShouldVerify=!e||!!e})}setIsShouldVerifyState(e){this.isShouldVerify=e,this.save()}parseDomainUntilSecondLevel(e){let t=e;var r,e=(t=t.match(/^[a-zA-Z0-9-]+:\/\/.+$/)?t.replace(/^[a-zA-Z0-9-]+:\/\//,""):t).indexOf("/"),e=(t=0<=e?t.slice(0,e):t).indexOf("?"),e=(t=0<=e?t.slice(0,e):t).split(".").map(e=>e.trim()).filter(e=>0<e.length);return e.length<2?"":(0<=(r=e[e.length-1].indexOf(":"))&&(e[e.length-1]=e[e.length-1].slice(0,r)),e[e.length-2]+"."+e[e.length-1])}save(){this.kvStore.set(l,this.isShouldVerify)}initMessageClient(e){return s(this,void 0,void 0,function*(){if(!this.isShouldVerify)return!1;if(null==e||!e.params||void 0!==e.params.method)switch(e.params.method){case n.mVerifyDomain:return this.apiVerifyDomain(e.params.params.domain);case n.mVerifyContract:return this.verifyContract(e.params.params.contractAddress,e.params.params.domain)}})}getDomainCacheKey(e){return a.DomainRisk+e.replace(".","-")}getContractCacheKey(e){return a.ContractTrust+e.replace(".","-")}apiVerifyDomain(e){return s(this,void 0,void 0,function*(){return yield i.misesRequest({url:"/phishing_site/check",data:{domain_name:e}})})}isDomainWhitelisted(e){return""!==(e=this.parseDomainUntilSecondLevel(e))&&this.domainWhiteListMap.has(e)}verifyContract(r,i){return s(this,void 0,void 0,function*(){var e=yield this.isIgnoreDomain(i);if(e){const t={address:r,trust_percentage:100,level:o.Safe,tag:"ignore"};return t}const t=yield this.apiVerifyContract(r,i);return t&&t.level===o.Danger&&(yield this.notifyPhishingDetected(r))===c.Ignore&&this.setIgnorDomain(i),t})}setIgnoreContract(e){this.kvStore.set(this.getContractCacheKey(e),"1")}isIgnoreContract(e){return s(this,void 0,void 0,function*(){return yield this.kvStore.get(this.getContractCacheKey(e))})}setIgnorDomain(e){this.kvStore.set(this.getDomainCacheKey(e),"1")}isIgnoreDomain(e){return s(this,void 0,void 0,function*(){return yield this.kvStore.get(this.getDomainCacheKey(e))})}notifyPhishingDetected(t){return new Promise(e=>{browser.misesPrivate&&browser.misesPrivate.notifyPhishingDetected?browser.misesPrivate.notifyPhishingDetected(t,e):e("mises")})}apiVerifyContract(t,r){return s(this,void 0,void 0,function*(){var e;return this.isDomainWhitelisted(r)?{address:t,trust_percentage:100,level:o.Safe,tag:"white"}:(yield this.kvStore.get(t))||((e=yield i.misesRequest({url:"/web3safe/verify_contract",data:{address:t,domain:r}}))&&e.level!==o.Danger&&this.kvStore.set(t,e),e)})}}},559:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROUTE=void 0,t.ROUTE="mises-safe"}}]);